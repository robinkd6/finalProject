function md5cycle(t,e){var o=t[0],r=t[1],i=t[2],n=t[3];o=ff(o,r,i,n,e[0],7,-680876936),n=ff(n,o,r,i,e[1],12,-389564586),i=ff(i,n,o,r,e[2],17,606105819),r=ff(r,i,n,o,e[3],22,-1044525330),o=ff(o,r,i,n,e[4],7,-176418897),n=ff(n,o,r,i,e[5],12,1200080426),i=ff(i,n,o,r,e[6],17,-1473231341),r=ff(r,i,n,o,e[7],22,-45705983),o=ff(o,r,i,n,e[8],7,1770035416),n=ff(n,o,r,i,e[9],12,-1958414417),i=ff(i,n,o,r,e[10],17,-42063),r=ff(r,i,n,o,e[11],22,-1990404162),o=ff(o,r,i,n,e[12],7,1804603682),n=ff(n,o,r,i,e[13],12,-40341101),i=ff(i,n,o,r,e[14],17,-1502002290),r=ff(r,i,n,o,e[15],22,1236535329),o=gg(o,r,i,n,e[1],5,-165796510),n=gg(n,o,r,i,e[6],9,-1069501632),i=gg(i,n,o,r,e[11],14,643717713),r=gg(r,i,n,o,e[0],20,-373897302),o=gg(o,r,i,n,e[5],5,-701558691),n=gg(n,o,r,i,e[10],9,38016083),i=gg(i,n,o,r,e[15],14,-660478335),r=gg(r,i,n,o,e[4],20,-405537848),o=gg(o,r,i,n,e[9],5,568446438),n=gg(n,o,r,i,e[14],9,-1019803690),i=gg(i,n,o,r,e[3],14,-187363961),r=gg(r,i,n,o,e[8],20,1163531501),o=gg(o,r,i,n,e[13],5,-1444681467),n=gg(n,o,r,i,e[2],9,-51403784),i=gg(i,n,o,r,e[7],14,1735328473),r=gg(r,i,n,o,e[12],20,-1926607734),o=hh(o,r,i,n,e[5],4,-378558),n=hh(n,o,r,i,e[8],11,-2022574463),i=hh(i,n,o,r,e[11],16,1839030562),r=hh(r,i,n,o,e[14],23,-35309556),o=hh(o,r,i,n,e[1],4,-1530992060),n=hh(n,o,r,i,e[4],11,1272893353),i=hh(i,n,o,r,e[7],16,-155497632),r=hh(r,i,n,o,e[10],23,-1094730640),o=hh(o,r,i,n,e[13],4,681279174),n=hh(n,o,r,i,e[0],11,-358537222),i=hh(i,n,o,r,e[3],16,-722521979),r=hh(r,i,n,o,e[6],23,76029189),o=hh(o,r,i,n,e[9],4,-640364487),n=hh(n,o,r,i,e[12],11,-421815835),i=hh(i,n,o,r,e[15],16,530742520),r=hh(r,i,n,o,e[2],23,-995338651),o=ii(o,r,i,n,e[0],6,-198630844),n=ii(n,o,r,i,e[7],10,1126891415),i=ii(i,n,o,r,e[14],15,-1416354905),r=ii(r,i,n,o,e[5],21,-57434055),o=ii(o,r,i,n,e[12],6,1700485571),n=ii(n,o,r,i,e[3],10,-1894986606),i=ii(i,n,o,r,e[10],15,-1051523),r=ii(r,i,n,o,e[1],21,-2054922799),o=ii(o,r,i,n,e[8],6,1873313359),n=ii(n,o,r,i,e[15],10,-30611744),i=ii(i,n,o,r,e[6],15,-1560198380),r=ii(r,i,n,o,e[13],21,1309151649),o=ii(o,r,i,n,e[4],6,-145523070),n=ii(n,o,r,i,e[11],10,-1120210379),i=ii(i,n,o,r,e[2],15,718787259),r=ii(r,i,n,o,e[9],21,-343485551),t[0]=add32(o,t[0]),t[1]=add32(r,t[1]),t[2]=add32(i,t[2]),t[3]=add32(n,t[3])}function cmn(t,e,o,r,i,n){return e=add32(add32(e,t),add32(r,n)),add32(e<<i|e>>>32-i,o)}function ff(t,e,o,r,i,n,s){return cmn(e&o|~e&r,t,e,i,n,s)}function gg(t,e,o,r,i,n,s){return cmn(e&r|o&~r,t,e,i,n,s)}function hh(t,e,o,r,i,n,s){return cmn(e^o^r,t,e,i,n,s)}function ii(t,e,o,r,i,n,s){return cmn(o^(e|~r),t,e,i,n,s)}function md51(t){txt="";var e,o=t.length,r=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=t.length;e+=64)md5cycle(r,md5blk(t.substring(e-64,e)));t=t.substring(e-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<t.length;e++)i[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(i[e>>2]|=128<<(e%4<<3),e>55)for(md5cycle(r,i),e=0;16>e;e++)i[e]=0;return i[14]=8*o,md5cycle(r,i),r}function md5blk(t){var e,o=[];for(e=0;64>e;e+=4)o[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return o}function rhex(t){for(var e="",o=0;4>o;o++)e+=hex_chr[t>>8*o+4&15]+hex_chr[t>>8*o&15];return e}function hex(t){for(var e=0;e<t.length;e++)t[e]=rhex(t[e]);return t.join("")}function md5(t){return hex(md51(t))}function add32(t,e){return t+e&4294967295}function add32(t,e){var o=(65535&t)+(65535&e),r=(t>>16)+(e>>16)+(o>>16);return r<<16|65535&o}(function(){var t,e,o={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=App.module("Models"),t.Photo=function(t){function o(){return e=o.__super__.constructor.apply(this,arguments)}return r(o,t),o.prototype.initialize=function(){return o.__super__.initialize.apply(this,arguments),this.imagesDownloadPromises={},this.imagesDownloaded={}},o.prototype.url=function(){return"https://api.500px.com/v1/photos/"+this.id},o.prototype._imageDownloadKey=function(t){return"size:"+t.size+"-https:"+t.https},o.prototype.prefetchImage=function(t){var e;return _.defaults(t,{size:4,https:!0}),e=this._imageDownloadKey(t),this.imagesDownloaded[e]||null!=this.imagesDownloadPromises[e]?void 0:this.downloadImage(t)},o.prototype.isImageDownloaded=function(t){return _.defaults(t,{size:4,https:!0}),this.imagesDownloaded[this._imageDownloadKey(t)]},o.prototype.downloadImage=function(t){var e,o,r,i,n=this;return _.defaults(t,{size:4,https:!0}),r=this._imageDownloadKey(t),this.imagesDownloadPromises[r]?this.imagesDownloadPromises[r]:(e=$.Deferred(),i=this.imagesDownloadPromises[r]=e.promise(),o=new Image,o.onload=function(){return n.imagesDownloaded[r]=!0,e.resolve(o.src,t),n.imagesDownloadPromises[r]=null},o.onerror=function(){return e.reject(t),n.imagesDownloadPromises[r]=null},o.src=this.getImagePath(t),i)},o.prototype.getImagePathAndSize=function(t){var e,o;return _.defaults(t,{size:4,https:!0,ignoresConverting:!0}),e=this.getInternalImagePathAndSize(t),null==e&&(3===(o=t.size)||600===o?3!==t.size&&(t.size=3,e=this.getInternalImagePathAndSize(t)):4!==t.size&&(t.size=4,e=this.getInternalImagePathAndSize(t))),null==e&&(t.size=null,e=this.getInternalImagePathAndSize(t)),e},o.prototype.getInternalImagePathAndSize=function(t){var e,o,r,i,n,s;n=this.get("images");for(e in n)if(o=n[e],t.size===o.size||null==t.size)return r=t.https?null!=(s=o.https_url)?s:o.secure_url:o.url,i=o.size,t.ignoresConverting?r.match(/\/placeholder\//)?null:{path:r,size:i}:{path:r,size:i};return null},o.prototype.getImagePath=function(t){var e;return e=this.getImagePathAndSize(t),null!=e?e.path:void 0},o.prototype.getInternalImagePath=function(t){var e;return e=this.getInternalImagePathAndSize(t),null!=e?e.path:void 0},o.prototype.parse=function(t){var e;return null!=(e=t.photo)?e:t},o.prototype.isPublic=function(){return this.get("privacy")===!1},o.prototype.isPrivate=function(){return this.get("privacy")===!0},o.prototype.imageUrl=function(){var t;return t=this.getInternalImagePath({size:4,https:!0}),null!=t?t:this.get("images")[0].secure_url},o.prototype.isConverting=function(){return null!=this.get("converted")&&0===this.get("converted")||this.imageUrl().indexOf("/placeholder/")>=0},o.prototype.dimensionsForImageSize=function(t){var e,o,r,i;return i=this.get("width"),r=this.get("height"),null!=i&&null!=r?(i>r?(o=Math.min(i,t),e=Math.round(r*o/i)):(e=Math.min(r,t),o=Math.round(i*e/r)),{width:o,height:e}):void 0},o}(Backbone.Model)}).call(this),function(){var t,e,o={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1};t=App.module("Organizer.Models"),t.Photo=function(t){function o(){return e=o.__super__.constructor.apply(this,arguments)}return r(o,t),o.prototype.url=function(){return"https://api.500px.com/v1/photos/"+this.id+"?"+$.param({include_licensing:!0,image_size:[3]})},o.prototype.inMarketplace=function(){var t,e,o;return t=[8,1,0],null!=(e=this.get("marketplace"))?e:null!=this.get("licensing_id")&&(o=this.get("licensing_status"),i.call(t,o)<0)},o}(App.Models.Photo)}.call(this),function(){var t,e,o=function(t,e){return function(){return t.apply(e,arguments)}},r={}.hasOwnProperty,i=function(t,e){function o(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};t=null!=(e="undefined"!=typeof App&&null!==App?App.module("Models"):void 0)?e:PxApp,t.UploadedFile=function(t){function e(t){var r,i;if(this.file=t,this._timeoutUpload=o(this._timeoutUpload,this),this._fakeCompleteUpload=o(this._fakeCompleteUpload,this),this._updateProgress=o(this._updateProgress,this),!this.file||null==(null!=(r=null!=(i=this.file.url)?i:this.file.type)?r:this.file.photo_id))throw new Error("UploadedPhoto requires a file arguments");e.__super__.constructor.call(this)}return i(e,t),e.prototype.baseUrl=function(){return PxConfig.endpoints.media_service_upload_url},e.prototype.initialize=function(){return this.set("name",this.file.name),this.set("upload_status","not_started")},e.prototype.url=function(){return""+this.baseUrl()+"?"+$.param({authenticity_token:PxApp.csrf_token})},e.prototype.beginUpload=function(){var t=this;return this.set("upload_status","in_progress"),this.set("upload_finished",!1),this._createParent().then(function(){return t._uploadFile()}).fail(function(){return t.set("upload_status","error")})},e.prototype.abort=function(){var t;return null!=(t=this.api)&&t.xhr.abort(),this.set("upload_status","aborted")},e.prototype._createParent=function(){return $.Deferred().resolve()},e.prototype._uploadFile=function(){var t,e,o,r=this;return e=$.Deferred(),t=new FormData,this.file.url?t.append("remote_url",this.file.url):this.file.photo_id?t.append("source_photo_id",this.file.photo_id):t.append("file",this.file),o=_.result(this,"url"),this.api=PxApp.api.post(o,t,{api_url:PxApp.api.upload_url,processData:!1,contentType:!1,cache:!1,xhr:function(){var t;return t=$.ajaxSettings.xhr(),t.upload.addEventListener("progress",r._updateProgress),t}}),this.api.error(function(t){var o,i;return 4===t.readyState?(o=JSON.parse(t.responseText),i="server_error",void 0!==o.error_key&&(i=o.error_key)):i="connection_error",r.set("upload_status","error"),e.reject()}),this.api.success(function(){return r.set("upload_status","success"),e.resolve()}),this.api.complete(function(){return r._realUploadFinished=!0,r.set("upload_finished",!0)}),e},e.prototype._updateProgress=function(t){var e;return e=t.lengthComputable?t.loaded/t.total*100:50,100===Math.round(e)&&_.delay(this._fakeCompleteUpload,5e3),this.set("upload_progress",e)},e.prototype._fakeCompleteUpload=function(){var t;if(this.get("upload_finished")!==!0)return t=new Error("Possible hanging upload: "+this.get("id")),"undefined"!=typeof NREUM&&null!==NREUM&&NREUM.noticeError(t),this.set({upload_finished:!0,upload_status:"success"}),_.delay(this._timeoutUpload,5e3)},e.prototype._timeoutUpload=function(){var t;if(!this._realUploadFinished)return t=new Error("Aborting hanging upload: "+this.get("id")),"undefined"!=typeof NREUM&&null!==NREUM&&NREUM.noticeError(t),this.api.xhr.abort()},e}(Backbone.Model)}.call(this),function(){var t,e={}.hasOwnProperty,o=function(t,o){function r(){this.constructor=t}for(var i in o)e.call(o,i)&&(t[i]=o[i]);return r.prototype=o.prototype,t.prototype=new r,t.__super__=o.prototype,t};t=App.module("Models"),t.UploadedPhoto=function(t){function e(t,o){this.file=t,this.autoActivate=null!=o?o:!0,e.__super__.constructor.call(this,this.file)}return o(e,t),e.prototype.url=function(){return""+e.__super__.url.call(this)+"&"+$.param({upload_key:this._uploadKey,photo_id:this.get("id")})},e.prototype.initialize=function(){return e.__super__.initialize.call(this),this.set("images",[])},e.prototype._createParent=function(){var t,e=this;return t=$.Deferred(),this.api=PxApp.api.post("/photos",{auto_activate:this.autoActivate}),this.api.success(function(o){return e._uploadKey=o.upload_key,e.set(_.omit(o.photo,"name","images")),t.resolve()}),this.api.error(function(){return e.set("upload_status","error"),e.set("upload_error",!0),e.set("upload_finished",!0),t.reject()}),t},e}(App.Models.UploadedFile)}.call(this);/*
 * Binary Ajax 0.1.10
 * Copyright (c) 2008 Jacob Seidelin, cupboy@gmail.com, http://blog.nihilogic.dk/
 * Licensed under the MPL License [http://www.nihilogic.dk/licenses/mpl-license.txt]
 */
var BinaryFile=function(t,e){var o=t.byteLength,r=new DataView(t);this.getRawData=function(){return r},this.getByteAt=function(t){if(t>o)throw"Tried to read past the end of the file";return r.getUint8(t)},this.getBytesAt=function(t,e){var o,i=t+e,n=[];for(o=t;i>=o;o++)n.push(r.getInt8(o));return n},this.getLength=function(){return o},this.getSByteAt=function(t){var e=this.getByteAt(t);return e>127?e-256:e},this.getShortAt=function(t,e){var o=e?(this.getByteAt(t)<<8)+this.getByteAt(t+1):(this.getByteAt(t+1)<<8)+this.getByteAt(t);return 0>o&&(o+=65536),o},this.getSShortAt=function(t,e){var o=this.getShortAt(t,e);return o>32767?o-65536:o},this.getLongAt=function(t,e){var o=this.getByteAt(t),r=this.getByteAt(t+1),i=this.getByteAt(t+2),n=this.getByteAt(t+3),s=e?(((o<<8)+r<<8)+i<<8)+n:(((n<<8)+i<<8)+r<<8)+o;return 0>s&&(s+=4294967296),s},this.getSLongAt=function(t,e){var o=this.getLongAt(t,e);return o>2147483647?o-4294967296:o},this.getStringAt=function(t,e){for(var o=[],r=this.getBytesAt(t,e),i=0;e>i;i++)o[i]=String.fromCharCode(r[i]);return o.join("")},this.getCharAt=function(t){return String.fromCharCode(this.getByteAt(t))},this.toBase64=function(){return window.btoa(r)},this.fromBase64=function(t){r=window.atob(t)}},EXIF={};!function(){function t(t){for(var e,o,r,i,n,s,a=2,l=t.getLength();l>a&&!(a+4>l)&&(e=t.getByteAt(a++),255==e);){if(o=t.getByteAt(a++),r=t.getShortAt(a,!0),200!=o&&192==(240&o)&&l>=a+7){a+=3,s=t.getShortAt(a,!0),a+=2,n=t.getShortAt(a,!0);break}for(a+=r;l>a;)if(e=t.getByteAt(a++),255==e&&l>a&&(i=t.getByteAt(a++),0!=i)){a-=2;break}}return{Width:n,Height:s}}function e(e){var o=function(t){for(var e={},o=0;o<t.length;o++)$.extend(e,t[o]);return e};try{var i=[];if(255!=e.getByteAt(0)||216!=e.getByteAt(1))return i;i.push(t(e));for(var n=2,l=e.getLength();l>n;){if(255!=e.getByteAt(n))return a&&console.log("Not a valid marker at offset "+n+", found: "+e.getByteAt(n)),o(i);var p=e.getByteAt(n+1);22400==p?(a&&console.log("Found 0xFFE1 marker"),i.push(s(e,n+4,e.getShortAt(n+2,!0)-2)),n+=2+e.getShortAt(n+2,!0)):225==p?(a&&console.log("Found 0xFFE1 marker"),i.push(s(e,n+4,e.getShortAt(n+2,!0)-2))):237==p&&(a&&console.log("Found 0xFFED marker"),i.push(r(e,n+4,e.getShortAt(n+2,!0)-2))),n+=2+e.getShortAt(n+2,!0)}}catch(u){}return o(i)}function o(t){try{return decodeURIComponent(escape(t))}catch(e){try{return decodeURIComponent(UTF8.decode(t))}catch(e){return null}}}function r(t,e,r){var i={};if("Photoshop"!=t.getStringAt(e,9))return a&&console.log("Not valid Photoshop data! "+t.getStringAt(e,9)),!1;var n,s,l,p,u,h=[];for(u=0;r>u;u++){var c=t.getByteAt(e+u);if(!(28!=c||u+1>=r)){var d=t.getByteAt(e+u+1);if(2==d){u+=1;var g=String(t.getByteAt(e+u))+":"+String(t.getByteAt(e+u+1)),_=t.getShortAt(e+u+2,!0);if(0!=_){var f=null;try{f=o(t.getStringAt(e+u+4,_))}catch(m){}if(!f)continue;"2:120"==g?i.ImageDescription=f:"2:15"==g?n=f:"2:20"==g?s=f:"2:25"==g?h.push(f):"2:5"==g?l=f:"2:105"==g?p=f:"2:80"==g&&(i.Artist=f),u+=_+3}}}}return i.ImageTitle=l||p,i.ImageKeywords=h.join(","),i.ImageCategory=n||s,i}function i(t,e,o,r,i){for(var s=t.getShortAt(o,i),l={},p=0;s>p;p++){var u=o+12*p+2,h=r[t.getShortAt(u,i)];!h&&a&&console.log("Unknown tag: "+t.getShortAt(u,i)),l[h]=n(t,u,e,o,i)}return l}function n(t,e,o,r,i){var n=t.getShortAt(e+2,i),s=t.getLongAt(e+4,i),a=t.getLongAt(e+8,i)+o;switch(n){case 1:case 7:if(1==s)return t.getByteAt(e+8,i);for(var l=s>4?a:e+8,p=[],u=0;s>u;u++)p[u]=t.getByteAt(l+u);return p;case 2:var h=s>4?a:e+8;return t.getStringAt(h,s-1);case 3:if(1==s)return t.getShortAt(e+8,i);for(var l=s>2?a:e+8,p=[],u=0;s>u;u++)p[u]=t.getShortAt(l+2*u,i);return p;case 4:if(1==s)return t.getLongAt(e+8,i);for(var p=[],u=0;s>u;u++)p[u]=t.getLongAt(a+4*u,i);return p;case 5:if(1==s)return t.getLongAt(a,i)/t.getLongAt(a+4,i);for(var p=[],u=0;s>u;u++)p[u]=t.getLongAt(a+8*u,i)/t.getLongAt(a+4+8*u,i);return p;case 9:if(1==s)return t.getSLongAt(e+8,i);for(var p=[],u=0;s>u;u++)p[u]=t.getSLongAt(a+4*u,i);return p;case 10:if(1==s)return t.getSLongAt(a,i)/t.getSLongAt(a+4,i);for(var p=[],u=0;s>u;u++)p[u]=t.getSLongAt(a+8*u,i)/t.getSLongAt(a+4+8*u,i);return p}}function s(t,e){if("Exif"!=t.getStringAt(e,4))return a&&console.log("Not valid EXIF data! "+t.getStringAt(e,4)),!1;var o,r=e+6;if(18761==t.getShortAt(r))o=!1;else{if(19789!=t.getShortAt(r))return a&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;o=!0}if(42!=t.getShortAt(r+2,o))return a&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var n=t.getLongAt(r+4,o),s=i(t,r,r+n,EXIF.TiffTags,o);if(s.ExifIFDPointer){var l=i(t,r,r+s.ExifIFDPointer,EXIF.Tags,o);for(var p in l){switch(p){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":l[p]=EXIF.StringValues[p][l[p]];break;case"ExifVersion":case"FlashpixVersion":l[p]=String.fromCharCode(l[p][0],l[p][1],l[p][2],l[p][3]);break;case"ComponentsConfiguration":l[p]=EXIF.StringValues.Components[l[p][0]]+EXIF.StringValues.Components[l[p][1]]+EXIF.StringValues.Components[l[p][2]]+EXIF.StringValues.Components[l[p][3]]}s[p]=l[p]}}if(s.GPSInfoIFDPointer){var u=i(t,r,r+s.GPSInfoIFDPointer,EXIF.GPSTags,o);for(var p in u){switch(p){case"GPSVersionID":u[p]=u[p][0]+"."+u[p][1]+"."+u[p][2]+"."+u[p][3]}s[p]=u[p]}}return s}var a=!1;EXIF.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID",42036:"LensModel"},EXIF.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},EXIF.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},EXIF.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},EXIF.readFromBinaryFile=function(t){return e(t)}}(),UTF8={encode:function(t){for(var e,o=-1,r=(t=t.split("")).length,i=String.fromCharCode;++o<r;t[o]=(e=t[o].charCodeAt(0))>=127?i(192|e>>>6)+i(128|63&e):t[o]);return t.join("")},decode:function(t){for(var e,o,r=-1,i=(t=t.split("")).length,n=String.fromCharCode,s="charCodeAt";++r<i;128&(e=t[r][s](0))&&(t[r]=192==(252&e)&&128==(192&(o=t[r+1][s](0)))?n(((3&e)<<6)+(63&o)):n(128),t[++r]=""));return t.join("")}},function t(e,o,r){function i(s,a){if(!o[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(n)return n(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var u=o[s]={exports:{}};e[s][0].call(u.exports,function(t){var o=e[s][1][t];return i(o?o:t)},u,u.exports,t,e,o,r)}return o[s].exports}for(var n="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t){var e=t("./index"),o=function(){return this}();o.ExifParser=e},{"./index":2}],2:[function(t,e){function o(){return this}var r=t("./lib/parser");e.exports={create:function(e,i){if(i=i||o(),e instanceof i.ArrayBuffer){var n=t("./lib/dom-bufferstream");return new r(new n(e,0,e.byteLength,!0,i))}var s=t("./lib/bufferstream");return new r(new s(e,0,e.length,!0))}}},{"./lib/bufferstream":3,"./lib/dom-bufferstream":5,"./lib/parser":9}],3:[function(t,e){function o(t,e,o,r){this.buffer=t,this.offset=e||0,o="number"==typeof o?o:t.length,this.endPosition=this.offset+o,this.setBigEndian(r)}o.prototype={setBigEndian:function(t){this.bigEndian=!!t},nextUInt8:function(){var t=this.buffer.readUInt8(this.offset);return this.offset+=1,t},nextInt8:function(){var t=this.buffer.readInt8(this.offset);return this.offset+=1,t},nextUInt16:function(){var t=this.bigEndian?this.buffer.readUInt16BE(this.offset):this.buffer.readUInt16LE(this.offset);return this.offset+=2,t},nextUInt32:function(){var t=this.bigEndian?this.buffer.readUInt32BE(this.offset):this.buffer.readUInt32LE(this.offset);return this.offset+=4,t},nextInt16:function(){var t=this.bigEndian?this.buffer.readInt16BE(this.offset):this.buffer.readInt16LE(this.offset);return this.offset+=2,t},nextInt32:function(){var t=this.bigEndian?this.buffer.readInt32BE(this.offset):this.buffer.readInt32LE(this.offset);return this.offset+=4,t},nextFloat:function(){var t=this.bigEndian?this.buffer.readFloatBE(this.offset):this.buffer.readFloatLE(this.offset);return this.offset+=4,t},nextDouble:function(){var t=this.bigEndian?this.buffer.readDoubleBE(this.offset):this.buffer.readDoubleLE(this.offset);return this.offset+=8,t},nextBuffer:function(t){var e=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e},remainingLength:function(){return this.endPosition-this.offset},nextString:function(t){var e=this.buffer.toString("ascii",this.offset,this.offset+t);return this.offset+=t,e},mark:function(){var t=this;return{openWithOffset:function(e){return e=(e||0)+this.offset,new o(t.buffer,e,t.endPosition-e,t.bigEndian)},offset:this.offset}},offsetFrom:function(t){return this.offset-t.offset},skip:function(t){this.offset+=t},branch:function(t,e){return e="number"==typeof e?e:this.endPosition-(this.offset+t),new o(this.buffer,this.offset+t,e,this.bigEndian)}},e.exports=o},{}],4:[function(t,e){function o(t){return parseInt(t,10)}function r(t,e){t=t.map(o),e=e.map(o);var r=new Date;r.setUTCFullYear(t[0]),r.setUTCMonth(t[1]-1),r.setUTCDate(t[2]),r.setUTCHours(e[0]),r.setUTCMinutes(e[1]),r.setUTCSeconds(e[2]),r.setUTCMilliseconds(0);var i=r.getTime()/1e3;return i}function i(t){var e=t.substr(0,10).split("-"),i=t.substr(11,8).split(":"),n=t.substr(19,6),s=n.split(":").map(o),p=s[0]*a+s[1]*l,u=r(e,i);return u-=p,"number"!=typeof u||isNaN(u)?void 0:u}function n(t){var e=t.split(" "),o=e[0].split(":"),i=e[1].split(":"),n=r(o,i);return"number"!=typeof n||isNaN(n)?void 0:n}function s(t){var e=19===t.length&&":"===t.charAt(4),o=25===t.length&&"T"===t.charAt(10);return o?i(t):e?n(t):void 0}var a=3600,l=60;e.exports={parseDateWithSpecFormat:n,parseDateWithTimezoneFormat:i,parseExifDate:s}},{}],5:[function(t,e){function o(t,e,o,r,i,n){this.global=i,e=e||0,o=o||t.byteLength-e,this.arrayBuffer=t.slice(e,e+o),this.view=new i.DataView(this.arrayBuffer,0,this.arrayBuffer.byteLength),this.setBigEndian(r),this.offset=0,this.parentOffset=(n||0)+e}o.prototype={setBigEndian:function(t){this.littleEndian=!t},nextUInt8:function(){var t=this.view.getUint8(this.offset);return this.offset+=1,t},nextInt8:function(){var t=this.view.getInt8(this.offset);return this.offset+=1,t},nextUInt16:function(){var t=this.view.getUint16(this.offset,this.littleEndian);return this.offset+=2,t},nextUInt32:function(){var t=this.view.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},nextInt16:function(){var t=this.view.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},nextInt32:function(){var t=this.view.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},nextFloat:function(){var t=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},nextDouble:function(){var t=this.view.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},nextBuffer:function(t){var e=this.arrayBuffer.slice(this.offset,this.offset+t);return this.offset+=t,e},remainingLength:function(){return this.arrayBuffer.byteLength-this.offset},nextString:function(t){var e=this.arrayBuffer.slice(this.offset,this.offset+t);return e=String.fromCharCode.apply(null,new this.global.Uint8Array(e)),this.offset+=t,e},mark:function(){var t=this;return{openWithOffset:function(e){return e=(e||0)+this.offset,new o(t.arrayBuffer,e,t.arrayBuffer.byteLength-e,!t.littleEndian,t.global,t.parentOffset)},offset:this.offset,getParentOffset:function(){return t.parentOffset}}},offsetFrom:function(t){return this.parentOffset+this.offset-(t.offset+t.getParentOffset())},skip:function(t){this.offset+=t},branch:function(t,e){return e="number"==typeof e?e:this.arrayBuffer.byteLength-(this.offset+t),new o(this.arrayBuffer,this.offset+t,e,!this.littleEndian,this.global,this.parentOffset)}},e.exports=o},{}],6:[function(t,e){e.exports={exif:{1:"InteropIndex",2:"InteropVersion",11:"ProcessingSoftware",254:"SubfileType",255:"OldSubfileType",256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Thresholding",264:"CellWidth",265:"CellLength",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",292:"T4Options",293:"T6Options",296:"ResolutionUnit",297:"PageNumber",300:"ColorResponseUnit",301:"TransferFunction",305:"Software",306:"ModifyDate",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFD",332:"InkSet",333:"InkNames",334:"NumberofInks",336:"DotRange",337:"TargetPrinter",338:"ExtraSamples",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",435:"T82Options",437:"JPEGTables",512:"JPEGProc",513:"ThumbnailOffset",514:"ThumbnailLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"ApplicationNotes",999:"USPTOMiscellaneous",4096:"RelatedImageFileFormat",4097:"RelatedImageWidth",4098:"RelatedImageHeight",18246:"Rating",18247:"XP_DIP_XML",18248:"StitchInfo",18249:"RatingPercent",32781:"ImageID",32931:"WangTag1",32932:"WangAnnotation",32933:"WangTag3",32934:"WangTag4",32995:"Matteing",32996:"DataType",32997:"ImageDepth",32998:"TileDepth",33405:"Model2",33421:"CFARepeatPatternDim",33422:"CFAPattern2",33423:"BatteryLevel",33424:"KodakIFD",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"PixelScale",33589:"AdventScale",33590:"AdventRevision",33628:"UIC1Tag",33629:"UIC2Tag",33630:"UIC3Tag",33631:"UIC4Tag",33723:"IPTC-NAA",33918:"IntergraphPacketData",33919:"IntergraphFlagRegisters",33920:"IntergraphMatrix",33921:"INGRReserved",33922:"ModelTiePoint",34016:"Site",34017:"ColorSequence",34018:"IT8Header",34019:"RasterPadding",34020:"BitsPerRunLength",34021:"BitsPerExtendedRunLength",34022:"ColorTable",34023:"ImageColorIndicator",34024:"BackgroundColorIndicator",34025:"ImageColorValue",34026:"BackgroundColorValue",34027:"PixelIntensityRange",34028:"TransparencyIndicator",34029:"ColorCharacterization",34030:"HCUsage",34031:"TrapIndicator",34032:"CMYKEquivalent",34118:"SEMInfo",34152:"AFCP_IPTC",34232:"PixelMagicJBIGOptions",34264:"ModelTransform",34306:"WB_GRGBLevels",34310:"LeafData",34377:"PhotoshopSettings",34665:"ExifOffset",34675:"ICC_Profile",34687:"TIFF_FXExtensions",34688:"MultiProfiles",34689:"SharedData",34690:"T88Options",34732:"ImageLayer",34735:"GeoTiffDirectory",34736:"GeoTiffDoubleParams",34737:"GeoTiffAsciiParams",34850:"ExposureProgram",34852:"SpectralSensitivity",34853:"GPSInfo",34855:"ISO",34856:"Opto-ElectricConvFactor",34857:"Interlace",34858:"TimeZoneOffset",34859:"SelfTimerMode",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",34908:"FaxRecvParams",34909:"FaxSubAddress",34910:"FaxRecvTime",34954:"LeafSubIFD",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"CreateDate",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureCompensation",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37387:"FlashEnergy",37388:"SpatialFrequencyResponse",37389:"Noise",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37394:"SecurityClassification",37395:"ImageHistory",37396:"SubjectArea",37397:"ExposureIndex",37398:"TIFF-EPStandardID",37399:"SensingMethod",37434:"CIP3DataFile",37435:"CIP3Sheet",37436:"CIP3Side",37439:"StoNits",37500:"MakerNote",37510:"UserComment",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",37679:"MSDocumentText",37680:"MSPropertySetStorage",37681:"MSDocumentTextPosition",37724:"ImageSourceData",40091:"XPTitle",40092:"XPComment",40093:"XPAuthor",40094:"XPKeywords",40095:"XPSubject",40960:"FlashpixVersion",40961:"ColorSpace",40962:"ExifImageWidth",40963:"ExifImageHeight",40964:"RelatedSoundFile",40965:"InteropOffset",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41485:"Noise",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41489:"ImageNumber",41490:"SecurityClassification",41491:"ImageHistory",41492:"SubjectLocation",41493:"ExposureIndex",41494:"TIFF-EPStandardID",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFormat",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"OwnerName",42033:"SerialNumber",42034:"LensInfo",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42112:"GDALMetadata",42113:"GDALNoData",42240:"Gamma",44992:"ExpandSoftware",44993:"ExpandLens",44994:"ExpandFilm",44995:"ExpandFilterLens",44996:"ExpandScanner",44997:"ExpandFlashLamp",48129:"PixelFormat",48130:"Transformation",48131:"Uncompressed",48132:"ImageType",48256:"ImageWidth",48257:"ImageHeight",48258:"WidthResolution",48259:"HeightResolution",48320:"ImageOffset",48321:"ImageByteCount",48322:"AlphaOffset",48323:"AlphaByteCount",48324:"ImageDataDiscard",48325:"AlphaDataDiscard",50215:"OceScanjobDesc",50216:"OceApplicationSelector",50217:"OceIDNumber",50218:"OceImageLogic",50255:"Annotations",50341:"PrintIM",50560:"USPTOOriginalContentType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"DNGLensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50752:"RawImageSegmentation",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50784:"AliasLayerMetadata",50827:"OriginalRawFileName",50828:"OriginalRawFileData",50829:"ActiveArea",50830:"MaskedAreas",50831:"AsShotICCProfile",50832:"AsShotPreProfileMatrix",50833:"CurrentICCProfile",50834:"CurrentPreProfileMatrix",50879:"ColorimetricReference",50898:"PanasonicTitle",50899:"PanasonicTitle2",50931:"CameraCalibrationSig",50932:"ProfileCalibrationSig",50933:"ProfileIFD",50934:"AsShotProfileName",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50968:"PreviewSettingsName",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",50973:"OriginalRawFileDigest",50974:"SubTileBlockSize",50975:"RowInterleaveFactor",50981:"ProfileLookTableDims",50982:"ProfileLookTableData",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51043:"TimeCodes",51044:"FrameRate",51058:"TStop",51081:"ReelName",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualitySize",51091:"OriginalDefaultCropSize",51105:"CameraLabel",51107:"ProfileHueSatMapEncoding",51108:"ProfileLookTableEncoding",51109:"BaselineExposureOffset",51110:"DefaultBlackRender",51111:"NewRawImageDigest",51112:"RawToPreviewGain",51125:"DefaultUserCrop",59932:"Padding",59933:"OffsetSchema",65e3:"OwnerName",65001:"SerialNumber",65002:"Lens",65024:"KDC_IFD",65100:"RawFile",65101:"Converter",65102:"WhiteBalance",65105:"Exposure",65106:"Shadows",65107:"Brightness",65108:"Contrast",65109:"Saturation",65110:"Sharpness",65111:"Smoothness",65112:"MoireFilter"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"}}},{}],7:[function(t,e){function o(t,e){switch(t){case 1:return e.nextUInt8();case 3:return e.nextUInt16();case 4:return e.nextUInt32();case 5:return[e.nextUInt32(),e.nextUInt32()];case 6:return e.nextInt8();case 8:return e.nextUInt16();case 9:return e.nextUInt32();case 10:return[e.nextInt32(),e.nextInt32()];case 11:return e.nextFloat();case 12:return e.nextDouble();default:throw new Error("Invalid format while decoding: "+t)}}function r(t){switch(t){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:return 0}}function i(t,e){var i,n,s=e.nextUInt16(),a=e.nextUInt16(),l=r(a),p=e.nextUInt32(),u=l*p;if(u>4&&(e=t.openWithOffset(e.nextUInt32())),2===a){i=e.nextString(p);var h=i.indexOf("\x00");-1!==h&&(i=i.substr(0,h))}else if(7===a)i=e.nextBuffer(p);else if(0!==a)for(i=[],n=0;p>n;++n)i.push(o(a,e));return 4>u&&e.skip(4-u),[s,i,a]}function n(t,e,o){var r,n,s=e.nextUInt16();for(n=0;s>n;++n)r=i(t,e),o(r[0],r[1],r[2])}function s(t){var e=t.nextString(6);if("Exif\x00\x00"!==e)throw new Error("Invalid EXIF header");var o=t.mark(),r=t.nextUInt16();if(18761===r)t.setBigEndian(!1);else{if(19789!==r)throw new Error("Invalid TIFF header");t.setBigEndian(!0)}if(42!==t.nextUInt16())throw new Error("Invalid TIFF data");return o}e.exports={IFD0:1,IFD1:2,GPSIFD:3,SubIFD:4,InteropIFD:5,parseTags:function(t,e){var o;try{o=s(t)}catch(r){return!1}var i,a,l,p=o.openWithOffset(t.nextUInt32()),u=this.IFD0;n(o,p,function(t,o,r){switch(t){case 34853:a=o[0];break;case 34665:i=o[0];break;default:e(u,t,o,r)}});var h=p.nextUInt32();if(0!==h){var c=o.openWithOffset(h);n(o,c,e.bind(null,this.IFD1))}if(a){var d=o.openWithOffset(a);n(o,d,e.bind(null,this.GPSIFD))}if(i){var g=o.openWithOffset(i),_=this.InteropIFD;n(o,g,function(t,o,r){40965===t?l=o[0]:e(_,t,o,r)})}if(l){var f=o.openWithOffset(l);n(o,f,e.bind(null,this.InteropIFD))}return!0}}},{}],8:[function(t,e){e.exports={parseSections:function(t,e){var o,r;for(t.setBigEndian(!0);t.remainingLength()>0&&218!==r;){if(255!==t.nextUInt8())throw new Error("Invalid JPEG section offset");r=t.nextUInt8(),o=r>=208&&217>=r||218===r?0:t.nextUInt16()-2,e(r,t.branch(0,o)),t.skip(o)}},getSizeFromSOFSection:function(t){return t.skip(1),{height:t.nextUInt16(),width:t.nextUInt16()}},getSectionName:function(t){var e,o;switch(t){case 216:e="SOI";break;case 196:e="DHT";break;case 219:e="DQT";break;case 221:e="DRI";break;case 218:e="SOS";break;case 254:e="COM";break;case 217:e="EOI";break;default:t>=224&&239>=t?(e="APP",o=t-224):t>=192&&207>=t&&196!==t&&200!==t&&204!==t?(e="SOF",o=t-192):t>=208&&215>=t&&(e="RST",o=t-208)}var r={name:e};return"number"==typeof o&&(r.index=o),r}}},{}],9:[function(t,e){function o(t,e,o,r,i,n,s){this.startMarker=t,this.tags=e,this.imageSize=o,this.thumbnailOffset=r,this.thumbnailLength=i,this.thumbnailType=n,this.app1Offset=s}function r(t){this.stream=t,this.flags={readBinaryTags:!1,resolveTagNames:!0,simplifyValues:!0,imageSize:!0,hidePointers:!0,returnTags:!0}}var i=t("./jpeg"),n=t("./exif"),s=t("./simplify");o.prototype={hasThumbnail:function(t){return this.thumbnailOffset&&this.thumbnailLength?"string"!=typeof t?!0:"image/jpeg"===t.toLowerCase().trim()?6===this.thumbnailType:"image/tiff"===t.toLowerCase().trim()?1===this.thumbnailType:!1:!1},getThumbnailOffset:function(){return this.app1Offset+6+this.thumbnailOffset},getThumbnailLength:function(){return this.thumbnailLength},getThumbnailBuffer:function(){return this._getThumbnailStream().nextBuffer(this.thumbnailLength)},_getThumbnailStream:function(){return this.startMarker.openWithOffset(this.getThumbnailOffset())},getImageSize:function(){return this.imageSize},getThumbnailSize:function(){var t,e=this._getThumbnailStream();return i.parseSections(e,function(e,o){"SOF"===i.getSectionName(e).name&&(t=i.getSizeFromSOFSection(o))}),t}},r.prototype={enableBinaryFields:function(t){return this.flags.readBinaryTags=!!t,this},enablePointers:function(t){return this.flags.hidePointers=!t,this},enableTagNames:function(t){return this.flags.resolveTagNames=!!t,this},enableImageSize:function(t){return this.flags.imageSize=!!t,this},enableReturnTags:function(t){return this.flags.returnTags=!!t,this},enableSimpleValues:function(t){return this.flags.simplifyValues=!!t,this},parse:function(){var e,r,a,l,p,u,h,c,d,g=this.stream.mark(),_=g.openWithOffset(0),f=this.flags;return f.resolveTagNames&&(h=t("./exif-tags")),f.resolveTagNames?(e={},c=function(t){return e[t.name]},d=function(t,o){e[t.name]=o}):(e=[],c=function(t){var o;for(o=0;o<e.length;++o)if(e[o].type===t.type&&e[o].section===t.section)return e.value},d=function(t,o){var r;for(r=0;r<e.length;++r)if(e[r].type===t.type&&e[r].section===t.section)return e.value=o,void 0}),i.parseSections(_,function(t,o){var c,d=o.offsetFrom(g);225===t?(c=n.parseTags(o,function(t,o,r,i){if(f.readBinaryTags||7!==i){if(513===o){if(a=r[0],f.hidePointers)return}else if(514===o){if(l=r[0],f.hidePointers)return}else if(259===o&&(p=r[0],f.hidePointers))return;if(f.returnTags)if(f.simplifyValues&&(r=s.simplifyValue(r,i)),f.resolveTagNames){var u=t===n.GPSIFD?h.gps:h.exif,c=u[o];c||(c=h.exif[o]),e[c]=r}else e.push({section:t,type:o,value:r})}}),c&&(u=d)):f.imageSize&&"SOF"===i.getSectionName(t).name&&(r=i.getSizeFromSOFSection(o))}),f.simplifyValues&&(s.castDegreeValues(c,d),s.castDateValues(c,d)),new o(g,e,r,a,l,p,u)}},e.exports=r},{"./exif":7,"./exif-tags":6,"./jpeg":8,"./simplify":10}],10:[function(t,e){var o=t("./exif"),r=t("./date"),i=[{section:o.GPSIFD,type:2,name:"GPSLatitude",refType:1,refName:"GPSLatitudeRef",posVal:"N"},{section:o.GPSIFD,type:4,name:"GPSLongitude",refType:3,refName:"GPSLongitudeRef",posVal:"E"}],n=[{section:o.SubIFD,type:36867,name:"DateTimeOriginal"},{section:o.SubIFD,type:36868,name:"CreateDate"}];
e.exports={castDegreeValues:function(t,e){i.forEach(function(o){var r=t(o);if(r){var i=t({section:o.section,type:o.refType,name:o.refName}),n=i===o.posVal?1:-1,s=(r[0]+r[1]/60+r[2]/3600)*n;e(o,s)}})},castDateValues:function(t,e){n.forEach(function(o){var i=t(o);if(i){var n=r.parseExifDate(i);"undefined"!=typeof n&&e(o,n)}})},simplifyValue:function(t,e){return Array.isArray(t)&&(t=t.map(function(t){return 10===e||5===e?t[0]/t[1]:t}),1===t.length&&(t=t[0])),t}}},{"./date":4,"./exif":7}]},{},[1]),function(){var t,e,o;t=null!=(o="undefined"!=typeof App&&null!==App?App.module("Models"):void 0)?o:PxApp,t.ExifParser=function(){function o(t){this.setFile(t)}return o.prototype.setFile=function(t){return this.file=t},o.prototype.getFile=function(){return this.file},o.prototype.extractExif=function(){var e,o=this;return e=$.Deferred(),this._loadExifFromFile(this.file).done(function(r){return o.cleanedAttributes=t.ExifParser.cleanExif(r,o.file),e.resolve(o.cleanedAttributes)}),e},o.cleanExif=function(t,e){var o;return null==t&&(t=this.exifData),null==e&&(e=null),o={},_.extend(o,this.extractTakenAt(t)),_.extend(o,this.extractShutterSpeed(t)),_.extend(o,this.extractCameraAndLens(t)),_.extend(o,this.extractTitleAndDescription(t,null!=e?e.name:void 0)),_.extend(o,this.extractTags(t)),_.extend(o,this.extractLatLng(t)),_.extend(o,this.extractOrientation(t)),o},o.extractTakenAt=function(t){return void 0!==t.DateTimeOriginal?{taken_at:t.DateTimeOriginal}:t.DateTimeDigitized?{taken_at:t.DateTimeDigitized}:{}},o.extractShutterSpeed=function(t){return void 0!==t.ExposureTime?t.ExposureTime<1?{shutter_speed:"1/"+Math.round(1/t.ExposureTime)}:{shutter_speed:Math.floor(t.ExposureTime)}:{}},o.extractCameraAndLens=function(t){var e;return e={},t.Model&&(e.camera=t.Model),t.FocalLength&&(e.focal_length=t.FocalLength),t.ISOSpeedRatings&&(e.iso=t.ISOSpeedRatings),t.FNumber&&(e.aperture=t.FNumber),t.LensModel&&(e.lens=t.LensModel),e},o.extractTitleAndDescription=function(t,e){var o,r,i,n;return null==e&&(e=null),i={},r=(t.ImageTitle||"").trim(),o=(t.ImageDescription||"").trim(),r&&o?(i.name=r,i.description=o):r||o?i.name=r||o:e&&(n=this.extractTitleFromFilename(e),n&&(i.name=n)),i},o.extractTags=function(t){var e;return void 0!==t.ImageKeywords&&(e=_.unique(t.ImageKeywords.split(/\s*(?:;|,)\s*/)),e.length>0&&""!==e[0])?{tags:e}:{}},o.extractLatLng=function(t){var e;return e={},_.extend(e,this.extractLat(t)),_.extend(e,this.extractLng(t)),e},o.extractLat=function(t){var e,o;return t.GPSLatitude&&t.GPSLongitude?(o="S"===t.GPSLatitudeRef?-1:1,e=(t.GPSLatitude[0]||0)+(t.GPSLatitude[1]||0)/60+(t.GPSLatitude[2]||0)/3600,e*=o,{latitude:Math.round(1e6*e)/1e6}):{}},o.extractLng=function(t){var e,o;return t.GPSLatitude&&t.GPSLongitude?(o="W"===t.GPSLongitudeRef?-1:1,e=(t.GPSLongitude[0]||0)+(t.GPSLongitude[1]||0)/60+(t.GPSLongitude[2]||0)/3600,e*=o,{longitude:Math.round(1e6*e)/1e6}):{}},o.extractOrientation=function(t){var e;return!t.Orientation||1!==(e=parseInt(t.Orientation,10))&&2!==e&&3!==e&&4!==e&&5!==e&&6!==e&&7!==e&&8!==e?{}:{orientation:parseInt(t.Orientation,10)}},o.extractTitleFromFilename=function(t){var e;for(t=t.trim(),t=t.replace(/\.[A-Za-z]{1,4}$/," "),e="";e!==t;)e=t,t=t.replace(/([_A-Z0-9]{4}[0-9]{4,8})([^0-9].*)/,"$2");return t=t.replace(/[_:,\-\.\s\\\/]+/g," "),t=t.replace(/([0-9]+\s?)*/g,""),t.trim()},o.prototype.hasThumbnail=function(){var t;return t=this._getExifResult(),t.hasThumbnail("image/jpeg")||t.hasThumbnail("image/png")},o.prototype.getThumbnail=function(){var t,o;if(!this.arrayBuffer)throw new Error("Cannot extract until _loadExifFromFile");return t=$.Deferred(),o=this._getExifResult(),o.hasThumbnail("image/jpeg")?t.resolve("data:image/jpeg;base64,"+e(o.getThumbnailBuffer())):o.hasThumbnail("image/png")?t.resolve("data:image/png;base64,"+e(o.getThumbnailBuffer())):t.reject(),t},o.prototype._getExifResult=function(){var t;return null!=this._exifResult?this._exifResult:(t=window.ExifParser.create(this.arrayBuffer),this._exifResult=t.parse())},o.prototype._loadExifFromFile=function(t){var e,o=this;return e=$.Deferred(),App.Lib.FileReader.readAsArrayBuffer(t).done(function(t){var r,i;return o.arrayBuffer=t,r=new BinaryFile(o.arrayBuffer),i=EXIF.readFromBinaryFile(r),e.resolve(i)}),e},o}(),e=function(t){return btoa(String.fromCharCode.apply(null,new Uint8Array(t)))}}.call(this),function(){var t,e,o,r,i;i=App.module("Models"),e=1,t=8,o=6,r=3,i.FileThumbnailer=function(){function i(t,o){var r,i,n,s;null==o&&(o={}),this.file=t,this.maxWidth=null!=(r=o.maxWidth)?r:256,this.maxHeight=null!=(i=o.maxHeight)?i:256,this.exif=o.exif,this.orientation=null!=(n=null!=(s=this.exif)?s.cleanedAttributes.orientation:void 0)?n:e}return i.prototype.generateThumbnail=function(){var t,e,o,r,i=this;if(t=$.Deferred(),this.file.type.match("image.*")){try{o=null!=(r=this.exif)?r.hasThumbnail():void 0}catch(n){e=n,"undefined"!=typeof NREUM&&null!==NREUM&&NREUM.noticeError(e),this._makeThumbnail(t)}o?this.exif.getThumbnail().done(function(e){return i._dataUrlToImage(e,function(e){return e.width>=.75*i.maxWidth||e.height>=.75*i.maxHeight?i._applyOrientation({image:e}).done(function(e){return t.resolve(e)}):i._makeThumbnail(t)})}):this._makeThumbnail(t)}else t.reject("Invalid file type");return t},i.prototype._makeThumbnail=function(t){var e=this;return this._readFromFile(function(o,r){var i,n,s;return s=[o.width,o.height],n=s[0],i=s[1],n/2>e.maxWidth&&i/2>e.maxHeight?t.resolve(e._scaleByHalf(o)):e._applyOrientation({image:o,dataUrl:r}).done(function(e){return t.resolve(e)})}),t},i.prototype._readFromFile=function(t){var e=this;return App.Lib.FileReader.readAsDataURL(this.file).done(function(o){return e._dataUrlToImage(o,function(e){return t(e,o)})})},i.prototype._imageToCanvas=function(t){var e,o;return e=document.createElement("canvas"),e.width=t.width,e.height=t.height,o=e.getContext("2d"),o.imageSmoothingEnabled=!0,o.drawImage(t,0,0,t.width,t.height),e},i.prototype._scaleByHalf=function(t){var e,o,r,i,n,s,a;for(a=[t.width,t.height],s=a[0],n=a[1],e=document.createElement("canvas"),e.width=s/2,e.height=n/2,r=e.getContext("2d"),r.imageSmoothingEnabled=!0,r.drawImage(t,0,0,s/2,n/2),s/=2,n/=2;s/2>this.maxWidth&&n/2>this.maxHeight;)s=0|s,n=0|n,r.drawImage(e,0,0,s,n,0,0,s/2,n/2),s/=2,n/=2;return s=0|s,n=0|n,o=document.createElement("canvas"),o.width=s,o.height=n,i=o.getContext("2d"),i.imageSmoothingEnabled=!0,i.drawImage(e,0,0,s,n,0,0,s,n),this._applyOrientationToCanvas(o).toDataURL("image/jpeg")},i.prototype._applyOrientation=function(t){var o,r,i=this;return r=$.Deferred(),t.dataUrl&&this.orientation===e?r.resolve(t.dataUrl):(t.image?(o=this._imageToCanvas(t.image),o=this._applyOrientationToCanvas(o),r.resolve(o.toDataURL("image/jpeg"))):this._dataUrlToImage(t.dataUrl,function(t){return o=i._imageToCanvas(t),o=i._applyOrientationToCanvas(o),r.resolve(o.toDataURL("image/jpeg"))}),r)},i.prototype._dataUrlToImage=function(t,e){var o;return o=new Image,o.onload=function(){return e(o)},o.src=t},i.prototype._applyOrientationToCanvas=function(i){var n,s,a,l,p,u,h;return this.orientation===e?i:(a=document.createElement("canvas"),(u=this.orientation)===t||u===o||u===r?(h=this.orientation===t?[-90,i.height,i.width]:this.orientation===r?[180,i.width,i.height]:this.orientation===o?[90,i.height,i.width]:void 0,l=h[0],p=h[1],s=h[2],a.width=p,a.height=s,n=a.getContext("2d"),n.imageSmoothingEnabled=!0,n.translate(p/2,s/2),n.rotate(l/180*Math.PI),n.drawImage(i,-(i.width/2),-(i.height/2)),a):void 0)},i}()}.call(this),function(){var t,e={}.hasOwnProperty,o=function(t,o){function r(){this.constructor=t}for(var i in o)e.call(o,i)&&(t[i]=o[i]);return r.prototype=o.prototype,t.prototype=new r,t.__super__=o.prototype,t};t=App.module("Uploader.Models"),t.Photo=function(t){function e(t){if(this.uploadedPhoto=t,!(this.uploadedPhoto instanceof App.Models.UploadedPhoto))throw new Error("Must pass Uploader.Models.Photo an uploadedPhoto");e.__super__.constructor.call(this),this.set("tags",[]),this.set(this.uploadedPhoto.attributes),this.bindEvents()}return o(e,t),e.prototype.loadExifAndThumbnail=function(){var t=this;return this.parseExif().done(function(){return t.loadThumbnail()})},e.prototype.loadThumbnail=function(t,e){var o,r=this;if(null==t&&(t=256),null==e&&(e=256),!this.exifParsed)throw new Error("Cannot load thumbnails utnil exif is parsed");if(this.thumbLoaded)throw new Error("Thumb already loaded");return o=$.Deferred(),this.uploadedPhoto.file.url?(this._setImageUrl(this.uploadedPhoto.file.url),this.thumbLoaded=!0,o.resolve()):new App.Models.FileThumbnailer(this.uploadedPhoto.file,{exif:this.exifParser,maxWidth:t,maxHeight:e}).generateThumbnail().done(function(t){return r._setImageUrl(t),r.thumbLoaded=!0,o.resolve()}),o},e.prototype.parseExif=function(){var t=this;return this.uploadedPhoto.file.url?(this.exifParsed=!0,$.Deferred().resolve()):(this.exifParser=new App.Models.ExifParser(this.uploadedPhoto.file),this.exifParser.extractExif().done(function(e){return t.exifParsed=!0,null!=e.tags&&(e.tags=e.tags.concat(t.get("tags"))),t.set(e)}))},e.prototype.bindEvents=function(){var t=this;return this.forwardProperties(this.uploadedPhoto,"id","upload_progress","upload_status","upload_finished"),this.on("remove",function(){return t.uploadedPhoto.collection.remove(t.uploadedPhoto)})},e.prototype.abort=function(){return this.uploadedPhoto.abort()},e.prototype.save=function(){var t,o,r=this;return t=this.attributes.images,delete this.attributes.images,o=e.__super__.save.call(this),o?o.always(function(){return r.attributes.images=t}):this.attributes.images=t,o},e.prototype._setImageUrl=function(t){return this.set("images",[{https_url:t,size:4}])},e}(App.Organizer.Models.Photo)}.call(this),function(){var t,e={}.hasOwnProperty,o=function(t,o){function r(){this.constructor=t}for(var i in o)e.call(o,i)&&(t[i]=o[i]);return r.prototype=o.prototype,t.prototype=new r,t.__super__=o.prototype,t};t=App.module("Uploader.Collections"),t.Photos=function(t){function e(t,o,r){this.uploadedPhotos=t,this.uploadDestination=o,this.defaultTag=r,e.__super__.constructor.call(this,!1)}return o(e,t),e.prototype.model=App.Uploader.Models.Photo,e.prototype.initialize=function(){var t,e,o,r,i,n,s=this;for(this.uploadedPhotos.on("add",function(t){var e;return e=new s.model(t),e.set("selected",!0),s._setUploadDestination(e),s._setDefaultTag(e),s.add(e)}),this.uploadedPhotos.on("remove",function(t){return s.remove(new s.model(t))}),i=this.uploadedPhotos.models,n=[],o=0,r=i.length;r>o;o++)e=i[o],t=new this.model(e),t.set("selected",!0),this._setUploadDestination(t),this._setDefaultTag(t),n.push(this.add(t));return n},e.prototype.publish=function(){var t,e,o,r,i,n,s,a;for(e=this.toJSON(),s=0,a=e.length;a>s;s++)r=e[s],null!=r.tags&&(r.tags=r.tags.join(",")),r.sets=function(){var t,e;t=r.sets,e=[];for(o in t)n=t[o],e.push(n);return e}().join(","),delete r.images,null!=r.releases&&(r.releases=function(){var e,o,i,n;for(i=r.releases,n=[],e=0,o=i.length;o>e;e++)t=i[e],32===t.length?n.push(App.Uploader.releases[t].get("id")):n.push(t);return n}(),r.releases=r.releases.join(",")),delete r.upload_status,delete r.upload_percent;return i="https://webapi.500px.com/uploader/publish",$.post(i,{photos:e})},e.prototype.successful=function(){return this.filter(function(t){return"success"===t.uploadedPhoto.get("upload_status")})},e.prototype.finishSelection=function(){return this.trigger("selection:finished")},e.prototype.parseExif=function(){var t,e,o=this;return t=$.Deferred(),e=function(){var r;return r=o.find(function(t){return!t.exifParsed}),r?r.parseExif().done(e):(t.resolve(),o.finishSelection())},e(),t},e.prototype.loadThumbnails=function(){var t,e,o=this;return t=$.Deferred(),e=function(){var r;return r=o.find(function(t){return t.exifParsed&&!t.thumbLoaded}),r?r.loadThumbnail().done(e):t.resolve()},e(),t},e.prototype._setDefaultTag=function(t){return null!=this.defaultTag?t.get("tags").push(this.defaultTag):void 0},e.prototype._setUploadDestination=function(t){return null==this.uploadDestination?t.set("privacy","0"):"public"===this.uploadDestination.get("path")?t.set("privacy","0"):null!=this.uploadDestination.get("id")?"portfolio"!==this.uploadDestination.get("kind")&&3!==this.uploadDestination.get("kind")?t.set("galleries",[this.uploadDestination.get("id")]):t.set("sets",[this.uploadDestination.get("id")]):void 0},e}(Backbone.Collection)}.call(this),function(){var t,e,o=function(t,e){return function(){return t.apply(e,arguments)}},r={}.hasOwnProperty,i=function(t,e){function o(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};t=App.module("Uploader.Collections"),t.Portfolios=function(t){function r(){return this.parse=o(this.parse,this),e=r.__super__.constructor.apply(this,arguments)}return i(r,t),r.prototype.model=Backbone.Model,r.prototype.url="https://webapi.500px.com/organizer/sources",r.prototype.parse=function(t){return t.sources.portfolio},r}(Backbone.Collection)}.call(this),!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.ProgressBar=t()}}(function(){var t;return function e(t,o,r){function i(s,a){if(!o[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(n)return n(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var u=o[s]={exports:{}};t[s][0].call(u.exports,function(e){var o=t[s][1][e];return i(o?o:e)},u,u.exports,e,t,o,r)}return o[s].exports}for(var n="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,o,r){!function(e){"undefined"==typeof SHIFTY_DEBUG_NOW&&(SHIFTY_DEBUG_NOW=function(){return+new Date});var i=function(){"use strict";function i(){}function n(t,e){var o;for(o in t)Object.hasOwnProperty.call(t,o)&&e(o)}function s(t,e){return n(e,function(o){t[o]=e[o]}),t}function a(t,e){n(e,function(o){"undefined"==typeof t[o]&&(t[o]=e[o])})}function l(t,e,o,r,i,n,s){var a,l=(t-n)/i;for(a in e)e.hasOwnProperty(a)&&(e[a]=p(o[a],r[a],g[s[a]],l));return e}function p(t,e,o,r){return t+(e-t)*o(r)}function u(t,e){var o=d.prototype.filter,r=t._filterArgs;n(o,function(i){"undefined"!=typeof o[i][e]&&o[i][e].apply(t,r)})}function h(t,e,o,r,i,n,s,a,p){b=e+o,P=Math.min(w(),b),C=P>=b,t.isPlaying()&&!C?(p(t._timeoutHandler,y),u(t,"beforeTween"),l(P,r,i,n,o,e,s),u(t,"afterTween"),a(r)):C&&(a(n),t.stop(!0))}function c(t,e){var o={};return"string"==typeof e?n(t,function(t){o[t]=e}):n(t,function(t){o[t]||(o[t]=e[t]||f)}),o}function d(t,e){this._currentState=t||{},this._configured=!1,this._scheduleFunction=_,"undefined"!=typeof e&&this.setConfig(e)}var g,_,f="linear",m=500,y=1e3/60,v=Date.now?Date.now:function(){return+new Date},w=SHIFTY_DEBUG_NOW?SHIFTY_DEBUG_NOW:v;_="undefined"!=typeof window?window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||window.mozCancelRequestAnimationFrame&&window.mozRequestAnimationFrame||setTimeout:setTimeout;var b,P,C;return d.prototype.tween=function(t){return this._isTweening?this:(void 0===t&&this._configured||this.setConfig(t),this._start(this.get()),this.resume())},d.prototype.setConfig=function(t){t=t||{},this._configured=!0,this._pausedAtTime=null,this._start=t.start||i,this._step=t.step||i,this._finish=t.finish||i,this._duration=t.duration||m,this._currentState=t.from||this.get(),this._originalState=this.get(),this._targetState=t.to||this.get(),this._timestamp=w();var e=this._currentState,o=this._targetState;return a(o,e),this._easing=c(e,t.easing||f),this._filterArgs=[e,this._originalState,o,this._easing],u(this,"tweenCreated"),this},d.prototype.get=function(){return s({},this._currentState)},d.prototype.set=function(t){this._currentState=t},d.prototype.pause=function(){return this._pausedAtTime=w(),this._isPaused=!0,this},d.prototype.resume=function(){this._isPaused&&(this._timestamp+=w()-this._pausedAtTime),this._isPaused=!1,this._isTweening=!0;var t=this;return this._timeoutHandler=function(){h(t,t._timestamp,t._duration,t._currentState,t._originalState,t._targetState,t._easing,t._step,t._scheduleFunction)},this._timeoutHandler(),this},d.prototype.stop=function(t){return this._isTweening=!1,this._isPaused=!1,this._timeoutHandler=i,t&&(s(this._currentState,this._targetState),u(this,"afterTweenEnd"),this._finish.call(this,this._currentState)),this},d.prototype.isPlaying=function(){return this._isTweening&&!this._isPaused},d.prototype.setScheduleFunction=function(t){this._scheduleFunction=t},d.prototype.dispose=function(){var t;for(t in this)this.hasOwnProperty(t)&&delete this[t]},d.prototype.filter={},d.prototype.formula={linear:function(t){return t}},g=d.prototype.formula,s(d,{now:w,each:n,tweenProps:l,tweenProp:p,applyFilter:u,shallowCopy:s,defaults:a,composeEasingObject:c}),"function"==typeof SHIFTY_DEBUG_NOW&&(e.timeoutHandler=h),"object"==typeof r?o.exports=d:"function"==typeof t&&t.amd?t(function(){return d}):"undefined"==typeof e.Tweenable&&(e.Tweenable=d),d}();!function(){i.shallowCopy(i.prototype.formula,{easeInQuad:function(t){return Math.pow(t,2)},easeOutQuad:function(t){return-(Math.pow(t-1,2)-1)},easeInOutQuad:function(t){return(t/=.5)<1?.5*Math.pow(t,2):-.5*((t-=2)*t-2)},easeInCubic:function(t){return Math.pow(t,3)},easeOutCubic:function(t){return Math.pow(t-1,3)+1},easeInOutCubic:function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)},easeInQuart:function(t){return Math.pow(t,4)},easeOutQuart:function(t){return-(Math.pow(t-1,4)-1)},easeInOutQuart:function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},easeInQuint:function(t){return Math.pow(t,5)},easeOutQuint:function(t){return Math.pow(t-1,5)+1},easeInOutQuint:function(t){return(t/=.5)<1?.5*Math.pow(t,5):.5*(Math.pow(t-2,5)+2)},easeInSine:function(t){return-Math.cos(t*(Math.PI/2))+1},easeOutSine:function(t){return Math.sin(t*(Math.PI/2))},easeInOutSine:function(t){return-.5*(Math.cos(Math.PI*t)-1)},easeInExpo:function(t){return 0===t?0:Math.pow(2,10*(t-1))},easeOutExpo:function(t){return 1===t?1:-Math.pow(2,-10*t)+1},easeInOutExpo:function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*--t)+2)},easeInCirc:function(t){return-(Math.sqrt(1-t*t)-1)},easeOutCirc:function(t){return Math.sqrt(1-Math.pow(t-1,2))},easeInOutCirc:function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},easeOutBounce:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},easeInBack:function(t){var e=1.70158;return t*t*((e+1)*t-e)},easeOutBack:function(t){var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack:function(t){var e=1.70158;return(t/=.5)<1?.5*t*t*(((e*=1.525)+1)*t-e):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},elastic:function(t){return-1*Math.pow(4,-8*t)*Math.sin(2*(6*t-1)*Math.PI/2)+1},swingFromTo:function(t){var e=1.70158;return(t/=.5)<1?.5*t*t*(((e*=1.525)+1)*t-e):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},swingFrom:function(t){var e=1.70158;return t*t*((e+1)*t-e)},swingTo:function(t){var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},bounce:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bouncePast:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?2-(7.5625*(t-=1.5/2.75)*t+.75):2.5/2.75>t?2-(7.5625*(t-=2.25/2.75)*t+.9375):2-(7.5625*(t-=2.625/2.75)*t+.984375)},easeFromTo:function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},easeFrom:function(t){return Math.pow(t,4)},easeTo:function(t){return Math.pow(t,.25)}})}(),function(){function t(t,e,o,r,i,n){function s(t){return((d*t+g)*t+_)*t}function a(t){return((f*t+m)*t+y)*t}function l(t){return(3*d*t+2*g)*t+_}function p(t){return 1/(200*t)}function u(t,e){return a(c(t,e))}function h(t){return t>=0?t:0-t}function c(t,e){var o,r,i,n,a,p;for(i=t,p=0;8>p;p++){if(n=s(i)-t,h(n)<e)return i;if(a=l(i),h(a)<1e-6)break;i-=n/a}if(o=0,r=1,i=t,o>i)return o;if(i>r)return r;for(;r>o;){if(n=s(i),h(n-t)<e)return i;t>n?o=i:r=i,i=.5*(r-o)+o}return i}var d=0,g=0,_=0,f=0,m=0,y=0;return _=3*e,g=3*(r-e)-_,d=1-_-g,y=3*o,m=3*(i-o)-y,f=1-y-m,u(t,p(n))}function e(e,o,r,i){return function(n){return t(n,e,o,r,i,1)}}i.setBezierFunction=function(t,o,r,n,s){var a=e(o,r,n,s);return a.x1=o,a.y1=r,a.x2=n,a.y2=s,i.prototype.formula[t]=a},i.unsetBezierFunction=function(t){delete i.prototype.formula[t]}}(),function(){function t(t,e,o,r,n){return i.tweenProps(r,e,t,o,1,0,n)}var e=new i;e._filterArgs=[],i.interpolate=function(o,r,n,s){var a=i.shallowCopy({},o),l=i.composeEasingObject(o,s||"linear");e.set({});var p=e._filterArgs;p.length=0,p[0]=a,p[1]=o,p[2]=r,p[3]=l,i.applyFilter(e,"tweenCreated"),i.applyFilter(e,"beforeTween");var u=t(o,a,r,n,l);return i.applyFilter(e,"afterTween"),u}}(),function(t){function e(t,e){x.length=0;var o,r=t.length;for(o=0;r>o;o++)x.push("_"+e+"_"+o);return x}function o(t){var e=t.match(b);return e?(1===e.length||t[0].match(w))&&e.unshift(""):e=["",""],e.join(k)}function r(e){t.each(e,function(t){var o=e[t];"string"==typeof o&&o.match(S)&&(e[t]=i(o))})}function i(t){return l(S,t,n)}function n(t){var e=s(t);return"rgb("+e[0]+","+e[1]+","+e[2]+")"}function s(t){return t=t.replace(/#/,""),3===t.length&&(t=t.split(""),t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),E[0]=a(t.substr(0,2)),E[1]=a(t.substr(2,2)),E[2]=a(t.substr(4,2)),E}function a(t){return parseInt(t,16)}function l(t,e,o){var r=e.match(t),i=e.replace(t,k);if(r)for(var n,s=r.length,a=0;s>a;a++)n=r.shift(),i=i.replace(k,o(n));return i}function p(t){return l(C,t,u)}function u(t){for(var e=t.match(P),o=e.length,r=t.match(A)[0],i=0;o>i;i++)r+=parseInt(e[i],10)+",";return r=r.slice(0,-1)+")"}function h(r){var i={};return t.each(r,function(t){var n=r[t];if("string"==typeof n){var s=m(n);i[t]={formatString:o(n),chunkNames:e(s,t)}}}),i}function c(e,o){t.each(o,function(t){for(var r=e[t],i=m(r),n=i.length,s=0;n>s;s++)e[o[t].chunkNames[s]]=+i[s];delete e[t]})}function d(e,o){t.each(o,function(t){var r=e[t],i=g(e,o[t].chunkNames),n=_(i,o[t].chunkNames);r=f(o[t].formatString,n),e[t]=p(r)})}function g(t,e){for(var o,r={},i=e.length,n=0;i>n;n++)o=e[n],r[o]=t[o],delete t[o];return r}function _(t,e){T.length=0;for(var o=e.length,r=0;o>r;r++)T.push(t[e[r]]);return T}function f(t,e){for(var o=t,r=e.length,i=0;r>i;i++)o=o.replace(k,+e[i].toFixed(4));return o}function m(t){return t.match(P)}function y(e,o){t.each(o,function(t){for(var r=o[t],i=r.chunkNames,n=i.length,s=e[t].split(" "),a=s[s.length-1],l=0;n>l;l++)e[i[l]]=s[l]||a;delete e[t]})}function v(e,o){t.each(o,function(t){for(var r=o[t],i=r.chunkNames,n=i.length,s="",a=0;n>a;a++)s+=" "+e[i[a]],delete e[i[a]];e[t]=s.substr(1)})}var w=/(\d|\-|\.)/,b=/([^\-0-9\.]+)/g,P=/[0-9.\-]+/g,C=new RegExp("rgb\\("+P.source+/,\s*/.source+P.source+/,\s*/.source+P.source+"\\)","g"),A=/^.*\(/,S=/#([0-9]|[a-f]){3,6}/gi,k="VAL",x=[],E=[],T=[];t.prototype.filter.token={tweenCreated:function(t,e,o){r(t),r(e),r(o),this._tokenData=h(t)},beforeTween:function(t,e,o,r){y(r,this._tokenData),c(t,this._tokenData),c(e,this._tokenData),c(o,this._tokenData)},afterTween:function(t,e,o,r){d(t,this._tokenData),d(e,this._tokenData),d(o,this._tokenData),v(r,this._tokenData)}}}(i)}(this)},{}],2:[function(t,e){var o=t("./shape"),r=t("./utils"),i=function(){this._pathTemplate="M 50,50 m 0,-{radius} a {radius},{radius} 0 1 1 0,{2radius} a {radius},{radius} 0 1 1 0,-{2radius}",o.apply(this,arguments)};i.prototype=new o,i.prototype.constructor=i,i.prototype._pathString=function(t){var e=t.strokeWidth;t.trailWidth&&t.trailWidth>t.strokeWidth&&(e=t.trailWidth);var o=50-e/2;return r.render(this._pathTemplate,{radius:o,"2radius":2*o})},i.prototype._trailString=function(t){return this._pathString(t)},e.exports=i},{"./shape":6,"./utils":8}],3:[function(t,e){var o=t("./shape"),r=t("./utils"),i=function(){this._pathTemplate="M 0,{center} L 100,{center}",o.apply(this,arguments)};i.prototype=new o,i.prototype.constructor=i,i.prototype._initializeSvg=function(t,e){t.setAttribute("viewBox","0 0 100 "+e.strokeWidth),t.setAttribute("preserveAspectRatio","none")},i.prototype._pathString=function(t){return r.render(this._pathTemplate,{center:t.strokeWidth/2})},i.prototype._trailString=function(t){return this._pathString(t)},e.exports=i},{"./shape":6,"./utils":8}],4:[function(t,e){var o=t("./line"),r=t("./circle"),i=t("./square"),n=t("./path");e.exports={Line:o,Circle:r,Square:i,Path:n}},{"./circle":2,"./line":3,"./path":5,"./square":7}],5:[function(t,e){var o=t("shifty"),r=t("./utils"),i={easeIn:"easeInCubic",easeOut:"easeOutCubic",easeInOut:"easeInOutCubic"},n=function(t,e){e=r.extend({duration:800,easing:"linear",from:{},to:{},step:function(){}},e),this._path=t,this._opts=e,this._tweenable=null;var o=this._path.getTotalLength();this._path.style.strokeDasharray=o+" "+o,this.set(0)};n.prototype.value=function(){var t=this._getComputedDashOffset(),e=this._path.getTotalLength(),o=1-t/e;return parseFloat(o.toFixed(6),10)},n.prototype.set=function(t){this.stop(),this._path.style.strokeDashoffset=this._progressToOffset(t);var e=this._opts.step;if(r.isFunction(e)){var o=this._easing(this._opts.easing),i=this._calculateTo(t,o);e(i,this._opts.attachment||this)}},n.prototype.stop=function(){this._stopTween(),this._path.style.strokeDashoffset=this._getComputedDashOffset()},n.prototype.animate=function(t,e,i){e=e||{},r.isFunction(e)&&(i=e,e={});var n=r.extend({},e),s=r.extend({},this._opts);e=r.extend(s,e);var a=this._easing(e.easing),l=this._resolveFromAndTo(t,a,n);this.stop(),this._path.getBoundingClientRect();var p=this._getComputedDashOffset(),u=this._progressToOffset(t),h=this;this._tweenable=new o,this._tweenable.tween({from:r.extend({offset:p},l.from),to:r.extend({offset:u},l.to),duration:e.duration,easing:a,step:function(t){h._path.style.strokeDashoffset=t.offset,e.step(t,e.attachment)},finish:function(){r.isFunction(i)&&i()}})},n.prototype._getComputedDashOffset=function(){var t=window.getComputedStyle(this._path,null);return parseFloat(t.getPropertyValue("stroke-dashoffset"),10)},n.prototype._progressToOffset=function(t){var e=this._path.getTotalLength();return e-t*e},n.prototype._resolveFromAndTo=function(t,e,o){return o.from&&o.to?{from:o.from,to:o.to}:{from:this._calculateFrom(e),to:this._calculateTo(t,e)}},n.prototype._calculateFrom=function(t){return o.interpolate(this._opts.from,this._opts.to,this.value(),t)},n.prototype._calculateTo=function(t,e){return o.interpolate(this._opts.from,this._opts.to,t,e)},n.prototype._stopTween=function(){null!==this._tweenable&&(this._tweenable.stop(),this._tweenable.dispose(),this._tweenable=null)},n.prototype._easing=function(t){return i.hasOwnProperty(t)?i[t]:t},e.exports=n},{"./utils":8,shifty:1}],6:[function(t,e){var o=t("./path"),r=t("./utils"),i="Object is destroyed",n=function s(t,e){if(!(this instanceof s))throw new Error("Constructor was called without new keyword");if(0!==arguments.length){this._opts=r.extend({color:"#555",strokeWidth:1,trailColor:null,trailWidth:null,fill:null,text:{autoStyle:!0,color:null,value:"",className:"progressbar-text"}},e,!0);var i,n=this._createSvgView(this._opts);if(i=r.isString(t)?document.querySelector(t):t,!i)throw new Error("Container does not exist: "+t);this._container=i,this._container.appendChild(n.svg),this.text=null,this._opts.text.value&&(this.text=this._createTextElement(this._opts,this._container),this._container.appendChild(this.text)),this.svg=n.svg,this.path=n.path,this.trail=n.trail;var a=r.extend({attachment:this},this._opts);this._progressPath=new o(n.path,a)}};n.prototype.animate=function(t,e,o){if(null===this._progressPath)throw new Error(i);this._progressPath.animate(t,e,o)},n.prototype.stop=function(){if(null===this._progressPath)throw new Error(i);void 0!==this._progressPath&&this._progressPath.stop()},n.prototype.destroy=function(){if(null===this._progressPath)throw new Error(i);this.stop(),this.svg.parentNode.removeChild(this.svg),this.svg=null,this.path=null,this.trail=null,this._progressPath=null,null!==this.text&&(this.text.parentNode.removeChild(this.text),this.text=null)},n.prototype.set=function(t){if(null===this._progressPath)throw new Error(i);this._progressPath.set(t)},n.prototype.value=function(){if(null===this._progressPath)throw new Error(i);return void 0===this._progressPath?0:this._progressPath.value()},n.prototype.setText=function(t){if(null===this._progressPath)throw new Error(i);null===this.text&&(this.text=this._createTextElement(this._opts,this._container),this._container.appendChild(this.text)),this.text.removeChild(this.text.firstChild),this.text.appendChild(document.createTextNode(t))},n.prototype._createSvgView=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");this._initializeSvg(e,t);var o=null;(t.trailColor||t.trailWidth)&&(o=this._createTrail(t),e.appendChild(o));var r=this._createPath(t);return e.appendChild(r),{svg:e,path:r,trail:o}},n.prototype._initializeSvg=function(t){t.setAttribute("viewBox","0 0 100 100")},n.prototype._createPath=function(t){var e=this._pathString(t);return this._createPathElement(e,t)},n.prototype._createTrail=function(t){var e=this._trailString(t),o=r.extend({},t);return o.trailColor||(o.trailColor="#eee"),o.trailWidth||(o.trailWidth=o.strokeWidth),o.color=o.trailColor,o.strokeWidth=o.trailWidth,o.fill=null,this._createPathElement(e,o)},n.prototype._createPathElement=function(t,e){var o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("d",t),o.setAttribute("stroke",e.color),o.setAttribute("stroke-width",e.strokeWidth),e.fill?o.setAttribute("fill",e.fill):o.setAttribute("fill-opacity","0"),o},n.prototype._createTextElement=function(t,e){var o=document.createElement("p");return o.appendChild(document.createTextNode(t.text.value)),t.text.autoStyle&&(e.style.position="relative",o.style.position="absolute",o.style.top="50%",o.style.left="50%",o.style.padding=0,o.style.margin=0,r.setStyle(o,"transform","translate(-50%, -50%)"),o.style.color=t.text.color?t.text.color:t.color),o.className=t.text.className,o},n.prototype._pathString=function(){throw new Error("Override this function for each progress bar")},n.prototype._trailString=function(){throw new Error("Override this function for each progress bar")},e.exports=n},{"./path":5,"./utils":8}],7:[function(t,e){var o=t("./shape"),r=t("./utils"),i=function(){this._pathTemplate="M 0,{halfOfStrokeWidth} L {width},{halfOfStrokeWidth} L {width},{width} L {halfOfStrokeWidth},{width} L {halfOfStrokeWidth},{strokeWidth}",this._trailTemplate="M {startMargin},{halfOfStrokeWidth} L {width},{halfOfStrokeWidth} L {width},{width} L {halfOfStrokeWidth},{width} L {halfOfStrokeWidth},{halfOfStrokeWidth}",o.apply(this,arguments)};i.prototype=new o,i.prototype.constructor=i,i.prototype._pathString=function(t){var e=100-t.strokeWidth/2;return r.render(this._pathTemplate,{width:e,strokeWidth:t.strokeWidth,halfOfStrokeWidth:t.strokeWidth/2})},i.prototype._trailString=function(t){var e=100-t.strokeWidth/2;return r.render(this._trailTemplate,{width:e,strokeWidth:t.strokeWidth,halfOfStrokeWidth:t.strokeWidth/2,startMargin:t.strokeWidth/2-t.trailWidth/2})},e.exports=i},{"./shape":6,"./utils":8}],8:[function(t,e){function o(t,e,r){t=t||{},e=e||{},r=r||!1;for(var i in e)if(e.hasOwnProperty(i)){var n=t[i],s=e[i];t[i]=r&&p(n)&&p(s)?o(n,s,r):s}return t}function r(t,e){var o=t;for(var r in e)if(e.hasOwnProperty(r)){var i=e[r],n="\\{"+r+"\\}",s=new RegExp(n,"g");o=o.replace(s,i)}return o}function i(t,e,o){for(var r=0;r<u.length;++r){var i=n(u[r]);t.style[i+n(e)]=o}t.style[e]=o}function n(t){return t.charAt(0).toUpperCase()+t.slice(1)}function s(t){return"string"==typeof t||t instanceof String}function a(t){return"function"==typeof t}function l(t){return"[object Array]"===Object.prototype.toString.call(t)}function p(t){if(l(t))return!1;var e=typeof t;return"object"===e&&!!t}var u="webkit moz o ms".split(" ");e.exports={extend:o,render:r,setStyle:i,capitalize:n,isString:s,isFunction:a,isObject:p}},{}]},{},[4])(4)}),function(){var t,e={}.hasOwnProperty,o=function(t,o){function r(){this.constructor=t}for(var i in o)e.call(o,i)&&(t[i]=o[i]);return r.prototype=o.prototype,t.prototype=new r,t.__super__=o.prototype,t};App.Behaviors.HasProgressBar=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return o(r,e),r.prototype.modelEvents={"change:upload_progress":"changeUploadProgress","change:upload_finished":"changeUploadFinished"},r.prototype.initialize=function(t){var e;return t===!0&&(t={}),this.progressSelector=null!=(e=t.selector)?e:".uploaded_file_progress_bar"
},r.prototype.changeUploadProgress=function(t,e){return this.progressBar.animate(e/100)},r.prototype.changeUploadFinished=function(t,e){return this.$el.toggleClass("upload_finished",e===!0)},r.prototype.onRender=function(){return this.changeUploadFinished(this.view.model,this.view.model.get("upload_finished")),this.view.model.get("upload_finished")!==!0?(this.progressBar=new ProgressBar.Circle(this.$(this.progressSelector)[0],{color:"#1898dd",trailColor:"#c4e3f9",strokeWidth:15,trailWidth:15,duration:0}),this.changeUploadProgress()):void 0},r}(Marionette.Behavior)}.call(this);var hex_chr="0123456789abcdef".split("");"5d41402abc4b2a76b9719d911017c592"!=md5("hello"),function(){var t,e,o={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=App.module("Uploader.Models"),t.Release=function(t){function o(){return e=o.__super__.constructor.apply(this,arguments)}return r(o,t),o.prototype.defaults={same:!0,count:0},o.prototype.initialize=function(t){return t.uploadedRelease?(this.uploadedRelease=t.uploadedRelease,this.set(_.pick(this.uploadedRelease.attributes,"name")),this.forwardProperties(this.uploadedRelease,"id","upload_progress","upload_status","upload_finished")):this.set({upload_progress:100,upload_status:"finished",upload_finished:!0})},o}(Backbone.Model)}.call(this),function(){var t,e,o,r={}.hasOwnProperty,i=function(t,e){function o(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};t=App.module("Uploader.Collections"),e=[],t.Releases=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.url="https://webapi.500px.com/licensing/releases",e.prototype.model=App.Uploader.Models.Release,e.prototype.parse=function(t){return t.licensing_releases},e}(Backbone.Collection)}.call(this),function(){var t,e,o=function(t,e){return function(){return t.apply(e,arguments)}},r={}.hasOwnProperty,i=function(t,e){function o(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};t=App.module("Uploader.Collections"),t.Sets=function(t){function r(){return this.parse=o(this.parse,this),e=r.__super__.constructor.apply(this,arguments)}return i(r,t),r.prototype.model=Backbone.Model,r.prototype.url="https://webapi.500px.com/organizer/sources",r.prototype.parse=function(t){return t.sources.profile},r}(Backbone.Collection)}.call(this),function(){var t,e,o={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=App.module("Uploader.Models"),t.Set=function(t){function o(){return e=o.__super__.constructor.apply(this,arguments)}return r(o,t),o.prototype.baseUrl=function(){return"https://webapi.500px.com/organizer/sets"},o.prototype.url=function(){return this.isNew()?this.baseUrl():""+this.baseUrl()+"/"+this.get("id")},o.prototype.parse=function(t){return t.set},o.generatePath=function(t){var e,o,r;for(r=e=t.trim().toLowerCase().replace(/[^a-z0-9_ -]/g," ").replace(/\s+/g,"-"),o=0;App.Uploader.sets.findWhere({path:r})||App.Uploader.portfolios.findWhere({path:r});)o+=1,r=""+e+"-"+o;return r},o}(Backbone.Model)}.call(this),function(){var t,e,o={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=App.module("Organizer.Models"),t.Tag=function(t){function o(){return e=o.__super__.constructor.apply(this,arguments)}return r(o,t),o.prototype.idAttribute="name",o.prototype.url=function(){var t,e;return t=this.taggableModel.url().split("?"),e=t.length>1?t[1]:"",""+t[0]+"/tags?"+e+"tags="+this.attributes.name},o.prototype.initialize=function(t,e){return this.taggableModel=e.taggableModel},o.prototype.isNew=function(){return!1},o}(Backbone.Model)}.call(this),function(){var t,e,o,r={}.hasOwnProperty,i=function(t,e){function o(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};t=App.module("Organizer.Collections"),t.Photos=function(t){function o(){return e=o.__super__.constructor.apply(this,arguments)}return i(o,t),o.prototype.model=App.Organizer.Models.Photo,o}(Backbone.Collection),t.PhotoTags=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.model=App.Organizer.Models.Tag,e}(Backbone.Collection)}.call(this),function(){var t,e={}.hasOwnProperty,o=function(t,o){function r(){this.constructor=t}for(var i in o)e.call(o,i)&&(t[i]=o[i]);return r.prototype=o.prototype,t.prototype=new r,t.__super__=o.prototype,t},r=[].slice;t=App.module("Organizer.Models"),t.BatchEditablePhoto=function(t){function e(t,o){var r,i,n;for(null==o&&(o={}),this.photos=t,i=0,n=t.length;n>i;i++)r=t[i],this.listenTo(r,"change:name",this.onNameChange);this._createEditableFields(),this.on("sync",this.onSync),e.__super__.constructor.call(this,{},o)}return o(e,t),e.prototype.editableFields=["name","description","category","nsfw","camera","lens","focal_length","shutter_speed","aperture","iso","taken_at","license_type","releases","licensing_status","licensing_id","licensing_type","licensing_errors","exclusive_use","licensing_usage","watermark","marketplace"],e.prototype.exifFields=["camera","lens","focal_length","shutter_speed","aperture","iso","taken_at"],e.prototype.discoverabilityWeights={category:2,tags:2,name:2,description:1,geolocation:3},e.prototype.photos_with_max_tags=[],e.prototype.sameTags={},e.prototype.tags=[],e.prototype.initialize=function(){return this.previousTagsToAdd=[]},e.prototype.defaults=function(){return{add_galleries:[],remove_galleries:[],add_sets:[],remove_sets:[],add_releases:[],remove_releases:[]}},e.prototype.onNameChange=function(){return this.editableAttributes.name=this._createEditableRegularField("name"),this.trigger("updatedName")},e.prototype._createEditableFields=function(){var t;return t=this._createEditableRegularFields(),t.geolocation=this._createEditableGeoInfo(),t.tags=this._createEditableTags(),t.sets=this._createEditableSets(),t.releases=this._createEditableReleases(),t.marketplace=this._createEditableMarketplace(),t.exclusive_use=this._createEditableExclusiveUse(),this.editableAttributes=t},e.prototype._createEditableMarketplace=function(){var t,e,o,r;return o=function(){var e,o,r,i;for(r=this.photos,i=[],e=0,o=r.length;o>e;e++)t=r[e],i.push(t.inMarketplace());return i}.call(this),o=_.uniq(o),e=o.length<=1,{same:e,values:o,uniqueValue:e?null!=(r=o[0])?r:"":""}},e.prototype._createEditableExclusiveUse=function(){var t,e,o,r;return o=_.uniq(function(){var e,o,r,i;for(r=this.photos,i=[],e=0,o=r.length;o>e;e++)t=r[e],i.push("exclusive"===t.get("licensing_type"));return i}.call(this)),e=o.length<=1,{same:e,values:o,uniqueValue:e?null!=(r=o[0])?r:"":""}},e.prototype._createEditableRegularFields=function(){var t,e,o,r,i;for(t={},i=this.editableFields,o=0,r=i.length;r>o;o++)e=i[o],t[e]=this._createEditableRegularField(e);return t},e.prototype._createEditableRegularField=function(t){var e,o,r,i;return r=_.uniq(function(){var o,r,i,n;for(i=this.photos,n=[],o=0,r=i.length;r>o;o++)e=i[o],n.push(e.get(t));return n}.call(this)),o=r.length<=1,{same:o,values:r,uniqueValue:o?null!=(i=r[0])?i:"":""}},e.prototype._createEditableGeoInfo=function(){var t,e,o,r,i,n,s,a,l,p,u,h,c;for(t={},u=this.photos,l=0,p=u.length;p>l;l++)i=u[l],o=i.get("latitude"),r=i.get("longitude"),e=""+o+","+r,null==t[e]?(n={latitude:o,longitude:r,count:1},t[e]=n):t[e].count+=1;return a=_.values(t),s=a.length<=1,{same:s,values:a,uniqueValue:s&&null!=(null!=(h=a[0])?h.latitude:void 0)&&null!=(null!=(c=a[0])?c.longitude:void 0)?a[0]:null}},e.prototype._createEditableTags=function(){var t,e,o,r,i,n,s,a,l,p,u,h;for(i={},u=this.photos,s=0,l=u.length;l>s;s++)for(e=u[s],o=null!=(h=e.get("tags"))?h:[],a=0,p=o.length;p>a;a++)r=o[a],null!=i[r]?(i[r].count+=1,i[r].photo_ids.push(e.id)):i[r]={same:!1,count:1,photo_ids:[e.id]};for(t in i)n=i[t],n.same=n.count===this.photos.length;return this.updateMaxedKeywordPhotos(),i},e.prototype._createEditableRelation=function(t){var e,o,r,i,n,s,a,l,p,u,h,c,d,g;for(n={},c=this.photos,l=0,u=c.length;u>l;l++)for(r=c[l],g=null!=(d=r.get(t))?d:[],p=0,h=g.length;h>p;p++)i=g[p],e=$.isPlainObject(i)?i.id:i,null==n[e]&&(n[e]={count:0}),n[e].count+=1,i.id&&null==(a=n[e]).record&&(a.record=i);for(o in n)s=n[o],s.same=s.count===this.photos.length;return n},e.prototype._createEditableSets=function(){return this._createEditableRelation("sets")},e.prototype._createEditableReleases=function(){return this._createEditableRelation("releases")},e.prototype.isNew=function(){return!1},e.prototype.hasGeoCoords=function(){return!0},e.prototype.reconcileGalleryMemberships=function(t){var e,o,r,i,n;for(i=this.photos,n=[],o=0,r=i.length;r>o;o++)e=i[o],null==e.get("upload_status")?n.push(t.reconcileMembershipOfPhoto(e.id)):n.push(void 0);return n},e.prototype.checkGalleryMembership=function(t){var e,o,r,i,n;if(e={},_.contains(this.get("add_galleries"),t.get("id")))e.containsAllPhotos=e.containsSomePhotos=!0;else if(_.contains(this.get("remove_galleries"),t.get("id")))e.containsAllPhotos=e.containsSomePhotos=!1;else for(e.containsAllPhotos=!0,e.containsSomePhotos=!1,n=this.photos,r=0,i=n.length;i>r;r++)o=n[r],t.containsPhoto(o)?e.containsSomePhotos=!0:e.containsAllPhotos=!1;return e},e.prototype.addGallery=function(t){return this.get("add_galleries").push(t),this.set("remove_galleries",_.without(this.get("remove_galleries"),t))},e.prototype.removeGallery=function(t){return this.get("remove_galleries").push(t),this.set("add_galleries",_.without(this.get("add_galleries"),t))},e.prototype.addSet=function(t){return this.get("add_sets").push(t),this.set("remove_sets",_.without(this.get("remove_sets"),t))},e.prototype.removeSet=function(t){return this.get("remove_sets").push(t),this.set("add_sets",_.without(this.get("add_sets"),t))},e.prototype.addRelease=function(t){return null==this.attributes.add_releases&&this.set("add_releases",[]),this.get("add_releases").push(t),this.set("remove_releases",_.without(this.get("remove_releases"),t))},e.prototype.removeRelease=function(t){return null==this.attributes.remove_releases&&this.set("remove_releases",[]),this.get("remove_releases").push(t),this.set("add_releases",_.without(this.get("add_releases"),t))},e.prototype.hasGalleries=function(){var t,e,o,r;for(r=this.photos,e=0,o=r.length;o>e;e++)if(t=r[e],!_.isEmpty(t.get("galleries")))return!0;return!1},e.prototype.allHaveGalleries=function(){var t,e,o,r;if(_.isEmpty(this.photos))return!1;for(r=this.photos,e=0,o=r.length;o>e;e++)if(t=r[e],_.isEmpty(t.get("galleries")))return!1;return!0},e.prototype.hasSets=function(){var t,e,o,r,i,n;for(e=null!=(i=App.Uploader.sets)?i.map(function(t){var e;return null!=(e=t.get("id"))?e:[]}):void 0,n=this.photos,o=0,r=n.length;r>o;o++)if(t=n[o],!_.isEmpty(_.intersection(t.get("sets"),e)))return!0;return!1},e.prototype.allHaveSets=function(){var t,e,o,r,i,n;if(e=null!=(i=App.Uploader.sets)?i.map(function(t){var e;return null!=(e=t.get("id"))?e:[]}):void 0,_.isEmpty(this.photos))return!1;for(n=this.photos,o=0,r=n.length;r>o;o++)if(t=n[o],_.isEmpty(_.intersection(t.get("sets"),e)))return!1;return!0},e.prototype.hasPortfolios=function(){var t,e,o,r,i,n;for(e=null!=(i=App.Uploader.portfolios)?i.map(function(t){var e;return null!=(e=t.get("id"))?e:[]}):void 0,n=this.photos,o=0,r=n.length;r>o;o++)if(t=n[o],!_.isEmpty(_.intersection(t.get("sets"),e)))return!0;return!1},e.prototype.allHavePortfolios=function(){var t,e,o,r,i,n;if(e=null!=(i=App.Uploader.portfolios)?i.map(function(t){var e;return null!=(e=t.get("id"))?e:[]}):void 0,_.isEmpty(this.photos))return!1;for(n=this.photos,o=0,r=n.length;r>o;o++)if(t=n[o],_.isEmpty(_.intersection(t.get("sets"),e)))return!1;return!0},e.prototype.geoCoords=function(){var t,e;return null!=(e=this.get("longitude"))&&null!=(t=this.get("latitude"))?{longitude:e,latitude:t}:null!=this.editableAttributes.geolocation.uniqueValue?this.editableAttributes.geolocation.uniqueValue:null},e.prototype.setGeoCoords=function(t,e){if(null==e&&(e={}),null==t)return this.clearGeoCoords(e);if(this.editableAttributes.geolocation.same&&null!=this.editableAttributes.geolocation.uniqueValue&&t.longitude===this.editableAttributes.geolocation.uniqueValue.longitude&&t.latitude===this.editableAttributes.geolocation.uniqueValue.latitude){if(this.unset("longitude",e),this.unset("latitude",e),!e.silent)return this.trigger("change:geolocation")}else if(t.longitude!==this.get("longitude")&&t.latitude!==this.get("latitude")&&(this.set({longitude:t.longitude,latitude:t.latitude},e),!e.silent))return this.trigger("change:geolocation")},e.prototype.clearGeoCoords=function(t){return null==this.get("longitude")&&null==this.get("latitude")||(this.unset("longitude",t),this.unset("latitude",t),t.silent)?void 0:this.trigger("change:geolocation")},e.prototype.url=function(){var t,e;return t=function(){var t,o,r,i;for(r=this.photos,i=[],t=0,o=r.length;o>t;t++)e=r[t],i.push(e.id);return i}.call(this),"https://webapi.500px.com/photos/update?id="+t.join(",")},e.prototype.jobUrl=function(t){return"https://webapi.500px.com/photos/update?job_id="+t},e.prototype.setBatchedAttributes=function(t,e){var o,r,i,n,s,a,l,p,u,h;for(o={},u=this.editableFields,l=0,p=u.length;p>l;l++)i=u[l],null!=(s=t[i])&&(a=s.toString(),n=this.editableAttributes[i],n.same?n.uniqueValue.toString()===a?this.unset(i,e):o[i]=s:0===a.length||"multi_values"===s&&("category"===i||"nsfw"===i||"license_type"===i||"exclusive_use"===i)?this.unset(i,e):o[i]=s);return r=this._affectedTagAttributes(t.tags),this.previousTagsToAdd=null!=(h=this.previousAttributes().add_tags)?h.split(","):void 0,null!=r.add_tags?o.add_tags=r.add_tags:this.unset("add_tags"),null!=r.remove_tags?o.remove_tags=r.remove_tags:this.unset("remove_tags"),this.set(o,e)},e.prototype.batchedAttributesChanged=function(){return _.keys(this.attributes).length>0},e.prototype.save=function(){var t,o,i,n,s,a,l,p,u,h,c,d,g,f=this;if(o=1<=arguments.length?r.call(arguments,0):[],n=[],t=function(){var e,o,r,n,s;for(n=null!=(r=this.get("add_releases"))?r:[],s=[],e=0,o=n.length;o>e;e++)a=n[e],32===a.length?(l=App.Uploader.allReleases.find(function(t){var e;return(null!=(e=t.uploadedRelease)?e.get("hash"):void 0)===a}),l.get("id")?s.push(l.get("id")):(i=$.Deferred(),l.on("change:id",function(e){return t[_.indexOf(t,e.get("hash"))]=e.id,i.resolve()}),s.push(a))):s.push(a);return s}.call(this),null!=App.myGalleries){for(d=this.get("add_galleries"),p=0,h=d.length;h>p;p++)s=d[p],App.myGalleries.get(s).addPhotos(this.photos);for(g=this.get("remove_galleries"),u=0,c=g.length;c>u;u++)s=g[u],App.myGalleries.get(s).removePhotos(this.photos)}return n.length>0?$.when.apply($,n).then(function(){return f.set("add_releases",t),e.__super__.save.apply(f,o)}):(this.set("add_releases",t),e.__super__.save.apply(this,o))},e.prototype._affectedTagAttributes=function(t){var e,o,r,i,n,s,a,l;return this.newTags=t,l=function(){var e,o,r;for(r=[],e=0,o=t.length;o>e;e++)s=t[e],r.push(s.get("name"));return r}(),r={},n=_.keys(this.editableAttributes.tags),o=_.difference(l,n),e=function(){var e,o,r;for(r=[],e=0,o=t.length;o>e;e++)s=t[e],s.get("same")&&(a=s.get("name"),null!=this.editableAttributes.tags[a]&&(this.editableAttributes.tags[a].same||r.push(a)));return r}.call(this),o=_.union(o,e),o.length>0&&(r.add_tags=o.join(",")),i=_.difference(n,l),i.length>0&&(r.remove_tags=i.join(",")),this.updateMaxedKeywordPhotos(o,i),r},e.prototype.onSync=function(t,e,o){var r,i=this;return null!=e.in_progress?(r=e.in_progress.job_id,_.delay(function(){return $.ajax({url:i.jobUrl(r),type:"PUT",dataType:"json"}).fail(function(t){return i.trigger("error",i.model,t,o)}).done(function(t){return i.onSync(i.model,t,o)})},1e3)):this.propagateBatchedAttributes(e.photos)},e.prototype.propagateBatchedAttributes=function(t){var e,o,r,i,n,s,a,l,p,u,h,c,d;if(r=null!=t,!r)for(t={},c=this.photos,l=0,u=c.length;u>l;l++)i=c[l],t[i.id]={data:this.attributes};for(s={okay:0,error:0,missing:0},d=this.photos,p=0,h=d.length;h>p;p++)i=d[p],n=t[i.id],null!=n?null!=(e=n.data)?(s.okay+=1,a=_.partial(_.pick,e),o=this.editableFields.concat(["longitude","latitude"]),e=a(o),r?this._propagateFromServer(i,n,e):this._propagateLocal(i,n,e)):s.error+=1:s.missing+=1;return this._createEditableFields(),r?(this.clear({silent:!0}),this.trigger("batchedChange",s)):void 0},e.prototype._propagateFromServer=function(t,e,o){var r;return t.set(o),null!=(r=e.data.tags)?t.set({tags:r,silent:!0}):void 0},e.prototype._propagateLocal=function(t,e,o){return null!=o.category&&(o.category=0|o.category),null!=o.license_type&&(o.license_type=0|o.license_type),t.set(o),this._propagateLocalTags(t),this._propagateLocalSets(t),this._propagateLocalGalleries(t),this._propagateLocalReleases(t)},e.prototype._propagateLocalTags=function(t){var e,o,r,i,n,s,a;return i=null!=(n=null!=(s=this.attributes.add_tags)?s.split(","):void 0)?n:[],e=_.difference(this.previousTagsToAdd,i),e.length>0&&t.set("tags",_.union(t.get("tags"),e)),this.attributes.remove_tags||this.attributes.add_tags?(o=null!=(a=t.get("tags"))?a:[],this.attributes.remove_tags&&(o=_.difference(o,this.attributes.remove_tags.split(","))),this.attributes.add_tags&&(i=_.difference(this.attributes.add_tags.split(","),o),r=App.Organizer.Collections.PhotoTags.prototype.MAX_NUMBER_OF_TAGS-o.length,i.length>r&&(i=_.first(i,r)),o=_.union(o,i)),t.set("tags",o)):void 0},e.prototype._propagateLocalGalleries=function(t){var e,o;if(this.attributes.remove_galleries||this.attributes.add_galleries)return e=null!=(o=t.get("galleries"))?o:[],this.attributes.remove_galleries&&(e=_.difference(e,this.attributes.remove_galleries)),this.attributes.add_galleries&&(e=_.union(e,this.attributes.add_galleries)),t.set("galleries",e)},e.prototype._propagateLocalSets=function(t){var e,o;return this.attributes.remove_sets||this.attributes.add_sets?(e=null!=(o=t.get("sets"))?o:[],this.attributes.remove_sets&&(e=_.difference(e,this.attributes.remove_sets)),this.attributes.add_sets&&(e=_.union(e,this.attributes.add_sets)),t.set("sets",e)):void 0},e.prototype._propagateLocalReleases=function(t){var e,o;return this.attributes.remove_releases||this.attributes.add_releases?(e=null!=(o=t.get("releases"))?o:[],this.attributes.remove_releases&&(e=_.difference(e,this.attributes.remove_releases)),this.attributes.add_releases&&(e=_.union(e,this.attributes.add_releases)),t.set("releases",e)):void 0},e.prototype._getTagsCount=function(){return null!=this.newTags?this.newTags.length:this.getInitialTags().length},e.prototype._isFieldQualified=function(t){var e,o,r,i;if(1!==this.photos.length)return!1;switch(t){case"name":case"description":return o=$.trim(null!=(r=this.get(t))?r:this.editableAttributes[t].uniqueValue),!!o&&("name"!==t||"Untitled"!==o);case"category":return e=parseInt(null!=(i=this.get(t))?i:this.editableAttributes[t].uniqueValue),null!=e&&!isNaN(e)&&0!==e;case"geolocation":return null!=this.geoCoords();default:return!1}},e.prototype.getDiscoverability=function(){var t,e;if(1===this.photos.length){null==this.weightsTotal&&(this.weightsTotal=_.reduce(_.values(this.discoverabilityWeights),function(t,e){return t+e},0)),e=0;for(t in this.discoverabilityWeights)"tags"===t?e+=Math.min(this._getTagsCount(),this.discoverabilityWeights.tags):this._isFieldQualified(t)&&(e+=this.discoverabilityWeights[t]);return Math.round(e/this.weightsTotal*100)}},e.prototype.getInitialTags=function(){return _.map(this.editableAttributes.tags,function(t,e){return{name:e,count:t.count,same:t.same}})},e.prototype.clear=function(t){return this.newTags=null,e.__super__.clear.call(this,t)},e.prototype.updateMaxedKeywordPhotos=function(t,e){var o,r,i,n,s;for(null==t&&(t=[]),null==e&&(e=[]),this.photos_with_max_tags=[],s=this.photos,i=0,n=s.length;n>i;i++)r=s[i],o=_.without(_.union(r.get("tags"),t),e).length,o>=App.Organizer.Collections.PhotoTags.prototype.MAX_NUMBER_OF_TAGS&&this.photos_with_max_tags.push(r.id);return this.photos_with_max_tags},e}(Backbone.Model)}.call(this),function(){var t,e,o={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=App.module("Views"),t.WidgetPane=function(t){function o(){return e=o.__super__.constructor.apply(this,arguments)}return r(o,t),o.prototype.onRender=function(){var t,e,o,r,i,n,s;for(e=this.mixinTemplateHelpers(this.serializeData()),s=this.$("ul.fields li"),i=0,n=s.length;n>i;i++)o=s[i],t=$(o),""===t.html()&&(r=o.className,t.html(Marionette.Renderer.render(""+r+"_widget",e,this)));return this.bindUIElements()},o}(Marionette.LayoutView)}.call(this),function(){var t,e,o={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=App.module("Views"),null==window.mapScriptDfd&&(window.mapScriptDfd=$.Deferred(),$.getScript("https://maps.googleapis.com/maps/api/js?key=AIzaSyDJFLGCQOjy2vyHzXNxPGOOc8uuKRNzGQc&libraries=places&async=2&callback=initialize_maps")),window.initialize_maps=function(){return window.mapScriptDfd.resolve()},t.Map=function(t){function o(){return e=o.__super__.constructor.apply(this,arguments)}return r(o,t),o.prototype.DEFAULT_LOCATION_ZOOM_LEVEL=1,o.prototype.ZOOM_LEVEL=8,o.prototype.initialize=function(t){var e,o=this;return this.mapCache=null!=(e=t.mapCache)?e:{},window.mapScriptDfd.done(function(){var e,r,i;if(null==o.mapCache.map?(o.mapCache.mapCanvas=$("<div class='map_canvas' style='width: 100%; height: 100%;'></div>"),o.$el.append(o.mapCache.mapCanvas),o.mapCache.map=new google.maps.Map(o.mapCache.mapCanvas[0])):(o.mapCache.mapCanvas.detach(),o._removeSearch(),o.$el.append(o.mapCache.mapCanvas),o.refresh({zoomLevel:o.ZOOM_LEVEL})),o.map=o.mapCache.map,e={center:new google.maps.LatLng(0,0),zoom:o.ZOOM_LEVEL,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,scrollwheel:null!=(r=t.scroll)?r:!1,draggable:null!=(i=t.enableLocationPicker)?i:!1,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP}},o.map.setOptions(e),o._centerMap(),t.enableLocationPicker){if(!$.isFunction(o.model.setGeoCoords))throw new Error("model does not support setGeoCoords");if(google.maps.event.addListener(o.map,"click",function(t){return o._onClick(t)}),google.maps.event.addListener(o.map,"dblclick",function(){return o._onDblClick()}),null!=t.searchInputEl)return o._setupSearch(t.searchInputEl)}})},o.prototype._onClick=function(t){var e=this;return null==this.timeout?this.timeout=setTimeout(function(){return e.timeout=null,e._setLocation(t.latLng)},500):void 0},o.prototype._onDblClick=function(){return null!=this.timeout?(clearTimeout(this.timeout),this.timeout=null):void 0},o.prototype._setupSearch=function(t){var e=this;return this.mapCache.search=$(t),this.searchBox=new google.maps.places.SearchBox(t),this.map.controls[google.maps.ControlPosition.TOP_LEFT].push(t),this.searchBox.addListener("places_changed",function(){return e._searchChanged()}),this.map.addListener("bounds_changed",function(){return e.searchBox.setBounds(e.map.getBounds())}),this.autocomplete=new google.maps.places.Autocomplete(t),this.autocomplete.bindTo("bounds",this.map),this.autocomplete.addListener("place_changed",function(){return e._autocompleteChanged()}),$("body").on("mousedown",".pac-container",function(t){return t.stopPropagation()})},o.prototype._autocompleteChanged=function(){var t;return t=this.autocomplete.getPlace(),null!=t.geometry?(this._setLocation(t.geometry.location),this.map.setZoom(this.ZOOM_LEVEL)):void 0},o.prototype._searchChanged=function(){var t,e;return e=this.searchBox.getPlaces(),e.length>0?(t=e[0],this._setLocation(t.geometry.location),this.map.setZoom(this.ZOOM_LEVEL)):void 0},o.prototype.onDestroy=function(){return google.maps.event.clearInstanceListeners(this.map),$("body").off("mousedown",".pac-container"),this._removeMarker(),this._removeSearch(),this.mapCache.mapCanvas.detach()},o.prototype.refresh=function(t){var e=this;return null==t&&(t={}),window.mapScriptDfd.done(function(){var o;return null!=e.map&&(o=t.zoomLevel,google.maps.event.trigger(e.map,"resize"),null!=e.mapCache.marker?e.map.setCenter(e.mapCache.marker.position):e._moveToDefaultLocation(),null!=o)?e.map.setZoom(o):void 0})},o.prototype._removeSearch=function(){return null!=this.mapCache.search?(this.mapCache.search.detach(),delete this.mapCache.search):void 0},o.prototype._centerMap=function(){var t,e,o;return("function"==typeof(e=this.model).hasGeoCoords?e.hasGeoCoords():void 0)?(t=this.model.geoCoords(),null!=t?this._moveToGeoCoords(new google.maps.LatLng(t.latitude,t.longitude)):this._moveToDefaultLocation()):("function"==typeof(o=this.model).hasLocation?o.hasLocation():void 0)?this._moveToAddress([this.model.get("city"),this.model.get("state"),this.model.get("country")].join(",")):null!=("undefined"!=typeof App&&null!==App?App.currentUser:void 0)?this._moveToAddress([App.currentUser.get("city"),App.currentUser.get("state"),App.currentUser.get("country")].join(",")):this._moveToDefaultLocation()},o.prototype._moveToGeoCoords=function(t,e){return null==e&&(e=!0),this.map.setCenter(t),e?this._updateMarker(t):this._removeMarker()},o.prototype._moveToAddress=function(t){var e,o=this;return e=new google.maps.Geocoder,e.geocode({address:t},function(t,e){return e===google.maps.GeocoderStatus.OK?o._moveToGeoCoords(t[0].geometry.location):o._moveToDefaultLocation()})},o.prototype._moveToDefaultLocation=function(){return this._moveToGeoCoords(new google.maps.LatLng(25,-25),!1),this.map.setZoom(this.DEFAULT_LOCATION_ZOOM_LEVEL)},o.prototype._updateMarker=function(t){return this._removeMarker(),this.mapCache.marker=new google.maps.Marker({map:this.map,position:t})},o.prototype._removeMarker=function(){return null!=this.mapCache.marker?this.mapCache.marker.setMap(null):void 0},o.prototype._setLocation=function(t){return this._moveToGeoCoords(t),this.model.setGeoCoords({latitude:t.lat(),longitude:t.lng()})},o}(Marionette.ItemView)}.call(this),function(){var t,e,o,r,i={}.hasOwnProperty,n=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};e=App.module("Organizer.Views"),e.EditPrimePane=function(e){function r(){return o=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.template="photo_edit_prime_pane",r.prototype.initialize=function(t){return this.photos=t.photos,1===this.photos.length?this.model=this.photos[0]:void 0},r.prototype.behaviors={HasButtons:{".submit_to_prime":"onClickSubmitToPrime",".status a.licensing_status":"onClickSubmitToPrime"}},r.prototype.ui={submitButton:"a.button"},r.prototype.templateHelpers=function(){var t,e,o,r,i,n,s,a,l,p,u,h,c,d,g,_,f,m,y;if(o=0,s=1,p=2,n=3,r=4,u=5,t=6,l=7,e=8,i=9,a=10,!this.model){for(h=!1,y=this.photos,f=0,m=y.length;m>f;f++)if(g=y[f],4===g.get("licensing_status")){h=!0;break}return d={licensed:h,multiple:this.photos.length>1,licensing_changes_required:h}}return _=function(){switch(this.model.get("licensing_status")){case i:case p:case n:case u:case a:return"available";case t:case l:return"editorial";case e:return"declined";case r:return"changes_required";case s:return"not_submitted"}}.call(this),c=function(){switch(this.model.get("licensing_status")){case i:case p:case n:case u:case t:case l:case r:case a:return"/photo/"+this.model.id+"/licensing";case e:return"/settings/store/faq#license-states"}}.call(this),d={licensed:0!==this.model.get("licensing_status"),licensing_href:c},d["licensing_"+_]=1,d},r.prototype.onShow=function(){var t;return this.photos.length>1||8===(null!=(t=this.model)?t.get("licensing_status"):void 0)?this.disable():this.enable()},r.prototype.onClickSubmitToPrime=function(e){var o,r,i=this;if(!this.$el.hasClass("disabled"))return o=$(e.target),o.hasClass("licensing_status")&&o.hasClass("declined")?!0:(r=new t({model:this.model}),r.showModal(),App.vent.once("licensing-done",function(){var t,e;return t=null!=(e=i.model.get("licensing_status"))?e:0,r.destroyModal(),i.model.fetch().done(function(){if(2===i.model.get("licensing_status"))switch(t){case 4:App.vent.trigger("prime:changesMade",[i.model.id]);break;case 0:case 1:App.vent.trigger("prime:newSubmission",[i.model.id])}return i.render()})}))},r.prototype.enable=function(){return this.ui.submitButton.removeClass("disabled")},r.prototype.disable=function(){return this.ui.submitButton.addClass("disabled")},r}(Marionette.ItemView),t=function(t){function e(){return r=e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.behaviors={ModalDialog:{maxWidth:1200,paddingX:80,paddingY:100}},e.prototype.template="prime_submission_iframe",e}(Marionette.ItemView)}.call(this),function(){var t;t=App.module("Organizer.Models"),t.OrganizerTrash=function(){function t(){}return t.prototype["delete"]=function(t){var e=this;return this._destroyPhotos(t).done(function(o){var r,i,n;e._removeFromGrid(t),App.controller.organizer.getSource().clearSelection({silentIndividualChange:!0}),App.vent.trigger("photo:trashed",{set:"all_photos",photos:_.pluck(t,"id")}),App.vent.trigger("photo:trashed",{set:"public",photos:o.profile}),App.vent.trigger("photo:trashed",{set:"prime",removed_count:o.prime_removed,changes_required:o.prime_changes_required_removed}),n=o.sets;for(r in n)i=n[r],App.vent.trigger("photo:trashed",{set:parseInt(r,10),photos:i});return null})},t.prototype._removeFromGrid=function(t){var e,o,r,i;for(i=[],o=0,r=t.length;r>o;o++)e=t[o],i.push(e.destroy());return i},t.prototype._destroyPhotos=function(t){return $.ajax({method:"post",url:""+PxConfig.endpoints.web_bff+"/organizer/photos/delete",data:{id:_.pluck(t,"id").join(",")},dataType:"json"})},t}()}.call(this),function(){var t;t=App.module("Views.Common.Helpers"),t.measureScrollBarWidth=function(){var t,e,o,r;try{return o=$("<div />"),$("body").append(o),o.width(50).height(50).css({overflow:"scroll",visibility:"hidden",position:"absolute"}),r=$("<div />").height(1),o.append(r),t=r.width(),e=o.width(),o.remove(),e-t}catch(i){return 20}}}.call(this),function(){var t,e,o,r,i={}.hasOwnProperty,n=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};t=App.module("Organizer.Collections"),t.TagSuggestions=function(t){function o(){return e=o.__super__.constructor.apply(this,arguments)}return n(o,t),o.prototype.model=App.Organizer.Models.Tag,o.prototype.DEFAULT_SIZE=50,o.prototype.url=function(){var t,e;return t="https://webapi.500px.com/tags",e={size:this.DEFAULT_SIZE},null!=this.userId&&(t="https://webapi.500px.com/tags/user",e.user_id=this.userId),null!=this.prefix&&(e.prefix=this.prefix),""+t+"?"+$.param(e)},o.prototype.fetch=function(t){return null!=(null!=t?t.prefix:void 0)&&(this.prefix=t.prefix),o.__super__.fetch.call(this)},o.prototype.initialize=function(t,e){var o;return this.userId=null!=e?e.userId:void 0,this.numTags=Number(null!=e?e.numTags:void 0),0<(o=this.numTags)&&1e3>o?void 0:this.numTags=this.DEFAULT_SIZE},o.prototype.parse=function(t){var e,o,r,i,n;for(i=t.tags,n=[],o=0,r=i.length;r>o;o++)e=i[o],n.push(new App.Organizer.Models.Tag({name:e},{taggableModel:null}));return n},o}(Backbone.Collection),t.TagVocabulary=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.DEFAULT_TAGS=["20-24 years","25-29 years","30-34 years","abandoned","above","abstract","access","active","activity","adorable","adult","adventure","aerial","affection","africa","agriculture","air","alaska","alberta","alone","alpine","alps","alternative energy","amazing","america","animal","antique","arch","arches","architectural","architecture","arctic","area","argentina","art","asia","asian","asian ethnicity","asking","atlantic","atmosphere","attraction","attractive","aurora","aurora borealis","autumn","baby","background","backlight","bald eagle","bali","balloon","banff","bangkok","barn","bavaria","beach","beak","bear","beautiful","beauty","beauty in nature","bed","bedroom","bee","beer","beetle","belgium","bench","berlin","bicycle","big","bird","bird of prey","birds eye view","bizzare","black","black and white","blonde","bloom","blooming","blossom","blue","blur","board room","boat","boats","body","bokeh","botanical","botany","botswana","box","boy","branch","branches","brasil","brazil","breakfast","brick","bridge","bright","british","british columbia","brooklyn","brother","brown","brunette","bud","budapest","buddha","buddhism","bug","building","bush","business","business man","business meeting","business people","business woman","businessman","businesswoman","butterfly","cactus","calgary","california","calm","camping","canada","canal","candid","canine","canyon","capital","car","caribbean","cascade","castle","casual","casual clothing","cat","cathedral","caucasian","caucasian ethnicity","cave","celebration","cellphone","chart","cheerful","cheetah","cherry","chicago","child","childhood","children","chile","china","christmas","church","city","cityscape","classroom","clean","clear","cliff","climbing","close up","close-up","closeup","cloud","clouds","cloudscape","cloudy","coast","coastal","coastline","cocktail","coffee","cold","collaboration","color","color image","colorful","colors","colour","colourful","colours","communication","composition","computer","concept","connection","construction","contrast","convenience","cooking","cool","copy space","corn","country","countryside","couple","cow","creative","creature","creek","crop","cub","cubs","culture","currency","customer service","cute","cycling","d800","daisy","dancing","dandelion","danger","dark","dawn","day","daylight","daytime","decay","decoration","deer","delicate","delicious","depression","desert","design","desk","dessert","destination","detail","dew","digital ","digital manipulation","digital tablet","dock","doctor","dog","dolomites","dolomiti","dome","domestic","domestic animal","door","downtown","dragonfly","dramatic","dream","dress","drink","drinking","drop","dry","dubai","duck","dunes","dusk","eagle","early","earth","eat","eating","ecology","education","elegance","elegant","elephant","embrace","empty","endangered","energy","engineer","entertainment","environment","erosion","estonia","europe","evening","exercise","exercising","exotic","exploration","exterior","eye","eyes","face","fall","falls","family","fantasy","farm","farmer","farming","farmland","fashion","fashion model","father","fauna","feather","feeding","feline","female","fence","field","fields","film","filter","fine art","fire","fireworks","fish","fishing","five","flamingo","flight","floral","flow","flower","flowers","flowing","fluffy","fly","flying","focus","fog","foggy","foliage","food","forest","formation","forrest","four","fox","france","freedom","freeze","fresh","freshness","friends","friendship","frog","front view","frost","frozen","fruit","full length","fun","funny","fur","furniture","gal","garden","gate","geology","germany","gift","giraffe","girl","giving","glacier","glamour","glass","globe","glow","gold","golden","golden hour","gorge","grain","grand canyon","grandchild","grandfather","grandmother","grandparent","grass","grassland","gray","great","green","grey","grin","groceries","ground","group","group of objects","growth","gym","hair","hand","hands","handshake","happiness","happy","harbor","harbour","harvest","hawaii","hawk","haze","hdr","head","head and shoulders","headphones","headset","health","health club","health spa","healthy","heaven","heritage","heron","high","high angle","highlands","highway","hike","hiking","hill","himalaya","himalayas","hispanic","historic","historical","hokkaido","holding","holiday","holland","home","hong kong","horizon","horizontal","horse","horses","hot","hotel","house","hug","human","human being","hummingbird","hungary","hunter","hunting","ice","iceberg","iceland","idyllic","illuminated","indian","indoor","indoors","industrial","industry","ingredient","insect","insects","inside","instructor","interior","internet","island","isolated","israel","istanbul","italian","italy","japanese","jetty","jogging","journey","joy","jumping","jungle","juvenile","kid","kingfisher","kiss","kitchen","kitten","kitty","laboratory","lady","lagoon","lake","land","landmark","landscape","landscapes","laptop","large","laughing","lava","lavender","leaf","leaves","legs","leisure","leisure activity","lens","leopard","library","life","lifestyle","lifestyles","light","lighthouse","lightning","lights","lily","line","lines","lion","little","lizard","london","lonely","long","long exposure","looking","looking down","lotus","love","lovely","lush","macro","magic","maine","majestic","make-up","makro","male","mammal","man","manhattan","manual worker","map","mare","marina","marine","marsh","mature couple","meadow","medical exam","medieval","mediterranean","meeting","metal","mexico","mid adult","milky way","mill","mirror","mist","misty","moab","mobile","mobile phone","mobility","model","modern","monkey","mono","monochrome","montana","monument","mood","moody","moon","morning","morocco","moscow","mosque","moss","mother","motion","motorcycle","mount","mountain","mountains","movement","moving up","multi-ethnic","multi-ethnic group","multi-generation family","mushroom","music","national","national park","natural","natural light","natural world","nature","nature photograph","nature pics","negative space","nepal","nest","nevada","new york","night","nightclub","nightscape","nobody","north","north carolina","northern lights","norway","nude","nurse","nyc","ocean","office","old","on the phone","one","one person","online","orange","organic","outdoor","outdoors","outside","overcast","overhead","owl","pacific","palace","palm","panorama","panoramic","paradise","parent","paris","park","party","pasture","patagonia","path","patient","pattern","peace","peaceful","peacock","peak","peaks","pelican","people","perch","perched","person","perspective","peru","pet","petal","photo","photography","picture","pier","pine","pink","place","places","plant","plants","play","playa","plumage","pollen","pond","pool","poppy","port","portrait","posing","power","prague","predator","presentation","pretty","prey","primate","puddle","puppy","pure","purple","quiet","rain","rainbow","rainforest","range","raptor","raw","ray","reading","real people","rear view","recreation","red","red fox","reflection","reflections","relationship","relax","relaxation","religion","repairing","reptile","reserve","resort","rest","restaurant","resting","retro","rice","ridge","river","road","rock","rockies","rocks","rocky","rocky mountains","romania","romantic","rome","roof","rose","ruins","running","rural","rust","rustic","sadness","safari","san francisco","sand","sandstone","santorini","scandinavia","scene","scenery","scenic","scenics","school","sculpture","sea","seagull","seascape","seashore","seaside","season","seasons","seattle","see","seminar","senior adult","senior couple","sensual","sensuality","sepia","serene","serenity","series","sexy","shadow","shadows","sharing","sheep","shine","ship","shopping","shore","shoreline","sibling","sightseeing","silence","silhouette","singapore","single","sisters","sitting","ski","skiing","skin","sky","skyline","skyscraper","sleeping","small","small business","smart phone","smile","smiling","smoke","smooth","snail","snake","snow","soft","solitude","south","spa","space","spider","splash","sport","spring","springtime","square","squirrel","stairs","standing","star","stars","startup","statue","stem","still","still life","stone","stones","store","storm","stream","street","structure","student","studio","style","suburban","summer","summit","sun","sundown","sunflower","sunlight","sunny","sunrise","sunset","sunshine","surf","surreal","swamp","swan","sweet","sweet light","swimming","sydney","symbol","table","tablet","tail","taiwan","talking","tall","tasty","teacher","technology","teenager","telephone","television","temple","texas","text","text messaging","texture","thai","thailand","three","three quarter length","tide","tiger","time","together","togetherness","top","toronto","tour","tourism","tourist","tower","town","track","traditional","traffic","trail","train","training","tranquil","tranquility","transportation","travel","tree","trees","trekking","trip","tropical","trunk","tulip","tulips","turkey","turquoise","turtle","tuscany","twilight","two","two people","ukraine","underwater","unesco","united kingdom","university","up","urban","urbex","usa","using computer","vacation","valley","vancouver","vegetable","vegetation","vehicle","venice","vertical","veterinarian","vibrant","victoria","vietnam","view","view from above","village","vintage","violet","vista","vivid","volcanic","volcano","walk","walking","wall","wallpaper","warm","washington","water","waterfall","waterfront","wave","way","weather","web","wedding","west","wet","wheat","white","white space","wide","wide angle","wild","wild animal","wilderness","wildlife","wind","windmill","window","wine","wing","winter","wireless","wolf","wolves","woman","women","wood","wooden","woodland","woods","work","working","world","worried","yellow","yellowstone","yoga","yosemite","young","young adult","young men","young women","youth","yukon","zebra","zion","zo"],e.prototype.initialize=function(){var t,e;
return this.set(function(){var o,r;o=this.DEFAULT_TAGS,r=[];for(t in o)e=o[t],r.push(new App.Organizer.Models.Tag({name:e},{taggableModel:null}));return r}.call(this))},e}(Backbone.Collection),t.PhotoTags=function(t){function e(){return r=e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.model=App.Organizer.Models.Tag,e.prototype.MAX_NUMBER_OF_TAGS=30,e.prototype.select=function(t){var e,o;return this.selected&&t.cid!==this.selected.cid&&(o=this.selected),e=this.indexOf(t),-1===e?!1:(this.selectedIndex=e,this.selected=t,"undefined"!=typeof old_selected&&null!==old_selected&&old_selected.trigger("deselect",old_selected),t.trigger("select",t),this)},e.prototype.selectPrevious=function(){var t,e;if(0!==this.selectedIndex)return t=null!=(e=this.models[this.selectedIndex-1])?e:this.last(),t?this.select(t):void 0},e.prototype.deselect=function(){var t,e;return null!=(e=this.selected)&&e.trigger("deselect",t),t=this.selected,this.selected=this.selectedIndex=null,t},e.prototype.selectNext=function(){var t,e;if(void 0!==this.selectedIndex)return t=this.selectedIndex+1,e=this.models[t],e?this.select(e):this.deselect()},e.prototype.selectIndex=function(t){return this.select(this.models[t])},e.prototype.iWhere=function(t,e){return this.filter(function(t){return t.get("name").toLowerCase()===e.toLowerCase()})},e}(Backbone.Collection)}.call(this),function(){var t,e,o,r,i,n,s,a={}.hasOwnProperty,l=function(t,e){function o(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},p=function(t,e){return function(){return t.apply(e,arguments)}};o=App.module("Organizer.Views"),r=App.module("Organizer.Views.Tags"),e=App.Organizer,t={left:37,up:38,right:39,down:40,del:46,backspace:8,tab:9,f:102,l:108,"return":13,escape:27},o.TagsField=function(o){function r(){return i=r.__super__.constructor.apply(this,arguments)}return l(r,o),r.prototype.template="photo_details_tags",r.prototype.initialize=function(o){var r=this;if(this.collection=o.collection,!this.collection)throw new Error("Must pass in a collection to TagsField");if(this.listenTo(this.collection,"add",this.addTag),this.listenTo(this.collection,"remove",this.removeTag),this.listenTo(this.collection,"reset",this.resetTags),this.listenTo(this.collection,"select",this.updateSelectedTag),this.listenTo(this.collection,"deselect",this.updateSelectedTag),this.listenTo(this.collection,"add remove",this.toggleTagInput),this.listenTo(this.collection,"add remove change",function(){return r.trigger("tag:update")}),this.photos=o.model.photos,!this.photos)throw new Error("Must pass in a model with photos");return this.globalTagCandidates=o.globalTagCandidates,this.userTagCandidates=o.userTagCandidates,null==this.globalTagCandidates&&(this.globalTagCandidates=new e.Collections.TagVocabulary),null==this.userTagCandidates&&(this.userTagCandidates=new e.Collections.TagSuggestions([],{userId:App.currentUser.id})),this.photos.length>0&&this.userTagCandidates.fetch(),this.keyboardCallbacks={},this.keyboardCallbacks[t.left]=this.onLeftKey,this.keyboardCallbacks[t.right]=this.onRightKey,this.keyboardCallbacks[t.del]=this.onDelKey,this.keyboardCallbacks[t.backspace]=this.onBackspaceKey},r.prototype.ui=function(){return{tagField:".tag_field",input:".tag_field input"}},r.prototype.events={"focus @ui.input":"focusField","blur @ui.input":"blurField","click .tag":"applyToAll","click .tag .remove":"removeTagElement","keydown @ui.input":"handleInputKeypress",mousedown:"stopEventUnlessInput",dragstart:"stopEventUnlessInput",click:"focusInput"},r.prototype.handleInputKeypress=function(t){var e;return this.hideStartPlaceholder(),e={isCursorAtBeginningOfInput:0===t.target.selectionStart,isAtagCurrentlySelected:null!==this.collection.selectedIndex,isSomeTextSelected:t.target.selectionStart!==t.target.selectionEnd},this.keyboardCallbacks[t.which]?this.keyboardCallbacks[t.which].call(this,event,e):this.collection.selected?(this.collection.deselect(),!0):void 0},r.prototype.onLeftKey=function(t,e){return e.isCursorAtBeginningOfInput?(this.collection.selectPrevious(),t.preventDefault()):void 0},r.prototype.onRightKey=function(t,e){return e.isAtagCurrentlySelected?(this.collection.selectNext(),t.preventDefault()):void 0},r.prototype.onDelKey=function(t,e){var o;return e.isAtagCurrentlySelected?(o=this.collection.selectedIndex,this.collection.remove(this.collection.selected),this.collection.deselect(),this.collection.selectIndex(o),t.preventDefault()):void 0},r.prototype.onBackspaceKey=function(t,e){var o;return e.isAtagCurrentlySelected&&!e.isSomeTextSelected?(o=this.collection.selectedIndex,o-=1,this.collection.remove(this.collection.selected),this.collection.deselect(),o>=0&&this.collection.selectIndex(o),t.preventDefault()):e.isCursorAtBeginningOfInput&&!e.isSomeTextSelected?(this.collection.selectPrevious(),t.preventDefault()):void 0},r.prototype.selectedElement=function(){return this.$el.find("[data-cid='"+this.collection.selected.cid+"']")},r.prototype.stopEventUnlessInput=function(t){return"INPUT"!==t.target.tagName?t.preventDefault():void 0},r.prototype.focusInput=function(){return this.collection.deselect(),this.ui.input.prop("disabled",!1).focus(),this.resizeInput()},r.prototype.removeTagElement=function(t){var e,o;return t.stopPropagation(),e=$(t.target).closest(".tag").attr("data-cid"),o=this.collection.get(e),this.collection.remove(o),this.focusInput()},r.prototype.applyToAll=function(t){var e,o,r,i;return t.stopPropagation(),e=$(t.target).closest(".tag"),o=e.attr("data-cid"),r=this.collection.get(o),r.set({same:!0}),e.addClass("same"),i=this.updateTagTitle(this.photos.length,this.photos.length,e),e.attr("title",i)},r.prototype.resetTags=function(){var t=this;return this.$(".tag").remove(),null!=this.collection.findWhere({same:!1})&&(this.collection.comparator=function(t){return-t.get("same")},this.collection.sort()),this.collection.each(function(e){return t.addTag(e)})},r.prototype.removeTag=function(t){return this.$(".tag[data-cid='"+t.cid+"']").remove(),this.ui.input.width(1),this.resizeInput(),this.updatePlaceholder()},r.prototype.showStartPlaceholder=function(){return this.ui.tagField.addClass("init")},r.prototype.hideStartPlaceholder=function(){return this.ui.tagField.removeClass("init")},r.prototype.updateSelectedTag=function(){return this.$(".tag").removeClass("selected"),this.collection.selected?this.selectedElement().addClass("selected"):void 0},r.prototype.currentValue=function(){return this.trimTag(this.ui.input.val())},r.prototype.trimTag=function(t){return t=t.replace(/^[#,\s]*(.*?)\s*$/,"$1"),t.slice(0,45)},r.prototype.addCurrentValueToCollection=function(){var t,o,r,i,n,s,a,l,p=this;for(s=this.ui.input.val().split(/[,#]+/),s=s.filter(function(t){return p.trimTag(t)}),t=this.collection.where({same:!0}),o=_.isEmpty(this.model.photos_with_max_tags)?!0:!1,a=0,l=s.length;l>a&&(r=s[a],!this.keywordsFull());a++)0===this.userTagCandidates.where({name:r}).length&&(i=new e.Models.Tag({name:r},{taggableModel:null}),this.userTagCandidates.add(i,{at:0})),n=_.first(this.collection.iWhere("name",r)),null!=n?(n.set({same:o}),o&&this.$(".tag[data-cid='"+n.cid+"']").addClass("same")):this.collection.add({name:r,same:o},{at:this.collection.length});return this.ui.input.val("")},r.prototype.focusField=function(){return this.ui.input.prop("disabled",!1),this.$el.addClass("focused"),this.autoCompletion.clearSuggestions()},r.prototype.blurField=function(){return""!==this.currentValue()&&this.tagEntered(),this.$el.removeClass("focused"),this.autoCompletion.clearSuggestions(),this.updatePlaceholder()},r.prototype.resizeInput=function(){var t=this;return _.defer(function(){var e,o,r,i;return t.ui.input.val(""),r=t.$el.position().left,i=t.$el.width()-10,e=t.ui.input.position().left,o=i-(e-r)-10,100>o&&(o=i),t.ui.input.width(o)})},r.prototype.addTag=function(t){var e,o,r,i,n,s;return this.ui.input.width(1),r=t.toJSON(),r.photos=this.photos.length,e=$(Marionette.Renderer.render("photo_details_tag",t.toJSON())),e.attr("data-cid",t.cid),t.get("same")&&e.addClass("same"),this.photos.length>1&&(o=null!=(s=t.get("count"))?s:this.photos.length,n=this.photos.length,i=this.updateTagTitle(o,n,e),e.attr("title",i)),this.ui.tagField.before(e),this.updatePlaceholder(),this.resizeInput()},r.prototype.updateTagTitle=function(t,e,o){return o.find(".i18n").i18n("appears",t,e,{"return":!0})},r.prototype.toggleTagInput=function(){return this.keywordsFull()?this.ui.tagField.hide():(this.ui.tagField.show(),this.resizeInput())},r.prototype.keywordsFull=function(){var t,e,o,r,i,n,s,a,l=this;for(i=function(){var e,o,r,i;for(r=this.collection.models,i=[],e=0,o=r.length;o>e;e++)t=r[e],i.push(t.get("name"));return i}.call(this),r=[],a=this.photos,n=0,s=a.length;s>n;n++)o=a[n],r=_.union(r,o.get("tags"));return e=_.difference(i,r),_.all(this.photos,function(t){var o;return o=_.intersection(t.get("tags"),i),o.length+e.length>=l.collection.MAX_NUMBER_OF_TAGS})},r.prototype.updatePlaceholder=function(){return this.collection.models.length>0?(this.hideStartPlaceholder(),this.ui.input.attr("placeholder",this.$("input").data("i18n-placeholder-short"))):(this.showStartPlaceholder(),this.ui.input.attr("placeholder",""))},r.prototype.tagEntered=function(t){var e,o;return e=this.autoCompletion.getSelectedTag(),e&&this.ui.input.val(e),this.autoCompletion.clearSuggestions(),o=this.currentValue(),""===o||this.keywordsFull()||(this.addCurrentValueToCollection(),this.toggleTagInput()),null!=t?t.preventDefault():void 0},r.prototype.onRender=function(){var t,o,r=this;return this.autoCompletion=new e.Views.Tags.AutoCompletion({parent:this,input:this.ui.input,globalTagCandidates:this.globalTagCandidates,userTagCandidates:this.userTagCandidates,existingTags:this.collection,waitTime:200}),this.autoCompletion.bind("dropdown:show",function(){return r.$el.addClass("ac_attached")}),this.autoCompletion.bind("dropdown:hide",function(){return r.$el.removeClass("ac_attached")}),this.autoCompletion.render(),this.ui.input.on("keydown",function(t){return r.handleKeydown(t)}),this.ui.input.on("keypress",function(t){return r.handleKeypress(t)}),(null!=(t=this.photos)?t.length:void 0)>0&&this.ui.input.prop("disabled",!1),this.toggleTagInput(),this.updatePlaceholder(),(null!=(o=this.photos)?o.length:void 0)>1&&(this.$el.addClass("bulk"),this.ui.input.removeClass("init")),this.resetTags()},r.prototype.activate=function(){var t=this;return _.defer(function(){return t.resizeInput()}),this},r.prototype.handleKeypress=function(t){var e,o,r;return r=t.which,o="#".charCodeAt(0),e=",".charCodeAt(0),r!==o&&r!==e||(this.tagEntered(),r===o)?void 0:t.preventDefault()},r.prototype.handleKeydown=function(e){var o;return o=e.which,o===t["return"]||o===t.tab?(e.preventDefault(),this.tagEntered()):o===t.escape?(e.preventDefault(),this.autoCompletion.clearSuggestions(e)):o===t.up?(e.preventDefault(),this.autoCompletion.moveUp(e)):o===t.down?(e.preventDefault(),this.autoCompletion.moveDown(e)):void 0},r.prototype.val=function(){return this.collection.models},r.prototype.size=function(){return this.collection.models.length},r.prototype.max=function(){return this.collection.MAX_NUMBER_OF_TAGS},r}(Marionette.ItemView),r.AutoCompletion=function(o){function r(){return n=r.__super__.constructor.apply(this,arguments)}return l(r,o),r.prototype.TAG_SEPARATOR="-",r.prototype.className="tags_autocompletion_wrap",r.prototype.minCharacters=2,r.prototype.maxNumResultsShown=8,r.prototype.waitTime=!1,r.prototype.currentKeyword="",r.prototype.initialize=function(t){return this.$input=t.input,this.parent=t.parent,this.globalTagCandidates=t.globalTagCandidates,this.userTagCandidates=t.userTagCandidates,this.existingTags=t.existingTags,_.extend(this,_.pick(t,"minCharacters","maxNumResultsShown","waitTime")),this.waitTime?this.filter=_.debounce(this.filter,this.waitTime):void 0},r.prototype.render=function(){var t=this;return this.$input.attr("autocomplete","off"),this.$input.on("keyup",function(e){return t.keyup(e)}),this.parent.$el.after(this.$el)},r.prototype.keyup=function(e){var o,r;if(e.keyCode!==t.escape)return r=this.parent.currentValue(),o=r.toLowerCase(),this.isChanged(o)||this.$el.is(":hidden")?this.isValid(o)?this.filter(o,r):(this.$el.empty(),this.hide()):void 0},r.prototype.getDowncasedUsedTags=function(){var t,e,o,r,i;for(e={},i=this.existingTags.models,o=0,r=i.length;r>o;o++)t=i[o],e[t.get("name").toLowerCase()]=1;return e},r.prototype.filter=function(t,e){var o,r,i,n,s,a,l,p,u,h,c;for(s=this.getDowncasedUsedTags(),o=[],h=this.userTagCandidates.models,a=0,p=h.length;p>a;a++)n=h[a],r=n.get("name").toLowerCase(),0!==r.indexOf(t)||s[r]||(o.push(n),s[r]=1);for(i=[this.TAG_SEPARATOR],c=this.globalTagCandidates.models,l=0,u=c.length;u>l;l++)n=c[l],r=n.get("name").toLowerCase(),0!==r.indexOf(t)||s[r]||(i.push(n),s[r]=1);return i.length>1&&(o=o.concat(i)),this.loadSuggestions(o,t,e)},r.prototype.isValid=function(t){return t.length>=this.minCharacters},r.prototype.isChanged=function(t){return this.currentKeyword!==t},r.prototype.moveUp=function(t){return this.moveSelection(-1),t.preventDefault()},r.prototype.moveDown=function(t){return this.moveSelection(1),t.preventDefault()},r.prototype.moveSelection=function(t){var e,o,r;return o=this.$el.children(),o.length>0?(r=this.$el.children(".selected"),e=r.length>0?r.first().index():-1,e+t<o.length&&(e+=t),r.removeClass("selected"),e>=0&&o.eq(e).addClass("selected"),this.$el.find(".tag_suggestion_separator.selected").length>0?this.moveSelection(t):void 0):void 0},r.prototype.loadSuggestions=function(t,e,o){var r,i,n,s;if(this.currentKeyword=e,this.results=t.slice(0,this.maxNumResultsShown),this.$el.empty(),this.results.length>0){for(_.last(this.results)===this.TAG_SEPARATOR&&this.results.pop(),s=this.results,i=0,n=s.length;n>i;i++)r=s[i],this.addTag(r,o);return this.$el.children().first().addClass("first"),this.$el.children().last().addClass("last"),this.show()}return this.hide()},r.prototype.addTag=function(t,o){var r;return r=new e.Views.Tags.AutoCompleteItem({matched:o,tag:t,parent:this}),r.render(),this.$el.append(r.$el)},r.prototype.select=function(t){return this.$el.children(".selected").removeClass("selected"),t.$el.addClass("selected"),this.parent.tagEntered(),this.$input.focus()},r.prototype.highlight=function(t){return this.$el.children(".selected").removeClass("selected"),t.$el.addClass("selected")},r.prototype.unhighlight=function(t){return t.$el.removeClass("selected")},r.prototype.getSelectedTag=function(){var t;return t=this.$el.find(".selected"),t.length>0?t.first().text().trim():void 0},r.prototype.hide=function(){return this.$el.hide(),this.trigger("dropdown:hide")},r.prototype.show=function(){return this.$el.width(this.parent.$el.width()),this.$el.show(),this.trigger("dropdown:show")},r.prototype.clearSuggestions=function(t){return this.currentKeyword="",this.$el.empty(),this.hide(),null!=t?t.stop():void 0},r}(Backbone.View),r.AutoCompleteItem=function(t){function e(){return this.unhighlight=p(this.unhighlight,this),this.highlight=p(this.highlight,this),this.select=p(this.select,this),s=e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.className="tag_suggestion",e.prototype.template="photo_details_tag_auto_completion_item",e.prototype.separatorTemplate="photo_details_tag_suggestion_separator",e.prototype.renderSeparator=function(){var t;return t=Marionette.Renderer.render(this.separatorTemplate,{})},e.prototype.initialize=function(t){return this.matched=t.matched,this.tag=t.tag,this.parent=t.parent},e.prototype.onRender=function(){return this.tag===this.parent.TAG_SEPARATOR?this.setElement(this.renderSeparator()):void 0},e.prototype.serializeData=function(){var t,e;return e=_.isString(this.tag)?this.tag:this.tag.get("name"),t=this.matched.length,{tag_matched:this.matched,tag_remaining:e.substr(t)}},e.prototype.events={mousedown:"select",mouseover:"highlight",mouseout:"unhighlight"},e.prototype.select=function(t){return t.preventDefault(),this.tag!==this.parent.TAG_SEPARATOR?this.parent.select(this):void 0},e.prototype.highlight=function(){return this.parent.highlight(this)},e.prototype.unhighlight=function(){return this.parent.unhighlight(this)},e}(Marionette.ItemView)}.call(this),function(){var t,e,o,r,i,n,s={}.hasOwnProperty,a=function(t,e){function o(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},l=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1};o=App.module("Organizer.Views"),e=function(t){function e(){return r=e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.baseUrl=function(){return"https://api.500px.com/v1/tags/suggested"},e.prototype.url=function(){return _.result(this,"baseUrl")+"?"+$.param({tags:this.tags})},e.prototype.initialize=function(t,e){var o=this;return this.tagsCollection=e.tags,this.listenTo(this.tagsCollection,"add remove",function(){return o.fetch()})},e.prototype.fetch=function(t){var o;return null==t&&(t={}),this.tags=function(){var t,e,r,i;for(r=this.tagsCollection.models,i=[],t=0,e=r.length;e>t;t++)o=r[t],i.push(o.get("name"));return i}.call(this),this.tags.length>0?e.__super__.fetch.call(this,t):this.reset(!1)},e.prototype.parse=function(t){var e,o,r,i,n,s;for(i=t.suggested_tags,s=[],o=0,r=i.length;r>o;o++)e=i[o],n=e.name,l.call(this.tags,n)<0&&s.push(e);return s},e}(Backbone.Collection),t=function(t){function e(){return i=e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.tagName="li",e.prototype.template="suggested_tag",e.prototype.className="suggested_tag",e.prototype.triggers={click:"select"},e}(Marionette.ItemView),o.SuggestedTags=function(o){function r(){return n=r.__super__.constructor.apply(this,arguments)}return a(r,o),r.prototype.template="suggested_tags",r.prototype.childView=t,r.prototype.childViewContainer="ul",r.prototype.childEvents={select:"onSelect"},r.prototype.collectionEvents={sync:"onSync"},r.prototype.initialize=function(t){return this.tagsCollection=t.tags,this.collection=new e(!1,{tags:this.tagsCollection}),this.listenTo(this.tagsCollection,"add remove",this.toggleEl)},r.prototype.onSelect=function(t){var e;return e=t.model.get("name"),t.$el.addClass("out"),_.delay(function(){return t.$el.remove()},350),this.tagsCollection.add({name:e,id:e,same:!0})},r.prototype.onShow=function(){return this.collection.fetch(),this.toggleEl()},r.prototype.onSync=function(){return this.toggleEl()},r.prototype.toggleEl=function(){var t;return t=this.collection.length>0&&this.tagsCollection.length>0&&this.tagsCollection.length<this.tagsCollection.MAX_NUMBER_OF_TAGS,this.$el.toggle(t)},r}(Marionette.CompositeView)}.call(this),function(){var t,e;t=App.module("Lib"),t.FileReader=function(){function t(){}return t.readAsDataURL=function(t){return e(t,"dataURL")},t.readAsArrayBuffer=function(t){return e(t,"ArrayBuffer")},t}(),e=function(t,e){var o,r;if(o=$.Deferred(),r=new FileReader,r.onload=function(t){return o.resolve(t.target.result)},r.onerror=function(){return o.reject.apply(o,arguments)},"dataURL"===e)r.readAsDataURL(t);else{if("ArrayBuffer"!==e)throw new Error("Unknown format in FileReader#read");r.readAsArrayBuffer(t)}return o}}.call(this),function(){var t,e,o={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=null!=(e="undefined"!=typeof App&&null!==App?App.module("Models"):void 0)?e:PxApp,t.UploadedRelease=function(t){function e(t,o){this.type=t,e.__super__.constructor.call(this,o)}return r(e,t),e.prototype.baseUrl=function(){return""+PxConfig.endpoints.media_service_upload_url+"/licensing/release"},e.prototype.url=function(){return""+e.__super__.url.call(this)+"&"+$.param({release_id:this.get("id")})},e.prototype.computeHash=function(){var t,e=this;return t=$.Deferred(),App.Lib.FileReader.readAsDataURL(this.file).done(function(o){var r;return r=window.md5(o),e.set({hash:r}),t.resolve(r)}),t},e.prototype._createParent=function(){var t=this;return $.post("https://webapi.500px.com/licensing/releases",{type:this.type,name:this.get("name")}).done(function(e){return t.set(e)})},e}(App.Models.UploadedFile)}.call(this),function(){var t,e,o,r,i,n,s,a,l,p,u,h,c={}.hasOwnProperty,d=function(t,e){function o(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};s=App.module("Organizer.Views"),t=4,App.Uploader.releases=a={},App.Uploader.allReleases=i=null,n=null,e=function(t){function e(){return l=e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.tagName="li",e.prototype.template="release_item",e.prototype.className="uploaded_file",e.prototype.ui={check:".completed_checkmark"},e.prototype.behaviors={HasButtons:{"a.delete":"clickDelete",".progress":{confirm:"Are you sure you want to abort this upload?",fn:"clickDelete"}},HasProgressBar:!0},e.prototype.events={click:"onClick"},e.prototype.modelEvents={"change:same":"onChangeSame"},e.prototype.onClick=function(t){return $(t.target).is("a")||$(t.target).is("path")||this.model.get("same")?void 0:this.trigger("add")},e.prototype.onRender=function(){return this.onChangeSame()},e.prototype.onChangeSame=function(){return this.$el.toggleClass("same",this.model.get("same")===!0)},e.prototype.clickDelete=function(){return"in_progress"===this.model.get("upload_status")&&this.model.uploadedRelease.abort(),this.trigger("delete")},e}(Marionette.ItemView),s.ReleasesWidget=function(r){function s(){return p=s.__super__.constructor.apply(this,arguments)}return d(s,r),s.prototype.childView=e,s.prototype.childViewContainer="ul.releases",s.prototype.template="releases_widget",s.prototype.className="release_widget",s.prototype.childEvents={"delete":"onDelete",add:"onApplyToAll"},s.prototype.templateHelpers=function(){var e,o,r=this;return e=_.uniq(function(){var t,e,r,i;for(r=this.model.photos,i=[],t=0,e=r.length;e>t;t++)o=r[t],i.push(o.inMarketplace());return i}.call(this)),{attributes:this.model.editableAttributes,cid:this.model.cid,store_enabled:App.currentUser.get("store_enabled"),show_reupload:function(){return 1===r.model.photos.length?(o=r.model.photos[0],o.get("licensing_status")===t&&o.get("licensing_errors")):!1},licensing_status_same:e.length<=1,licensing_status_checked:1===e.length&&e[0]?!0:!1}},s.prototype.initialize=function(){var t,e,o,r,l;s.__super__.initialize.call(this),i||(App.Uploader.allReleases=i=new App.Uploader.Collections.Releases,n=i.fetch()),this.collection=new App.Uploader.Collections.Releases,r=this.model.editableAttributes.releases,l=[];for(o in r)t=r[o],t.record?e=new App.Uploader.Models.Release(t.record):(e=32===o.length?a[o]:i.get(o),e=e.clone()),e.set("same",t.same),l.push(this.collection.add(e));return l},s.prototype.ui={addReleaseSelect:"select.add_release_types",inputField:".release_file_field",marketCheck:".marketplace .checkbox",addModel:".add_model_release",addLocation:".add_location_release",releaseSelect:"select.release_select",subPanes:".sub_panes",reuploadFile:"#file_reupload_field",reuploadButton:".button.reupload"},s.prototype.events={"change @ui.inputField":"onPickedFiles","click @ui.marketCheck":"onMarketCheck","click @ui.addModel":"clickAddModel","click @ui.addLocation":"clickAddLocation","change @ui.releaseSelect":"changeReleaseSelect","change @ui.reuploadFile":"onReuploadFilePicked"},s.prototype.onReuploadFilePicked=function(t){var e,o,r=this;return e=new FormData,e.append("photo_id",this.model.photos[0].id),e.append("file",t.target.files[0]),o=$.ajax({url:"/upload/store",data:e,processData:!1,contentType:!1,type:"POST"}),App.router.lockNavigation(this.$(".resubmit_pane").i18n("confirm",{"return":!0})),this.ui.reuploadButton.addClass("loading"),o.done(function(t){return r.model.photos[0].set(t.photo),r.model.trigger("batchedChange")}),o.fail(function(t){return alert(t.responseText)}),o.complete(function(){var t;return App.router.unlockNavigation(),"function"==typeof(t=r.ui.reuploadButton).removeClass?t.removeClass("loading"):void 0}),o},s.prototype.onRender=function(){return this._renderReleasesDropdown()},s.prototype.onShow=function(){return this._primeChange(this.ui.marketCheck.hasClass("checked"))},s.prototype.onMarketCheck=function(t){var e,o,r,i,n,s=this;if(o=!this.ui.marketCheck.hasClass("checked"))App.currentUser.get("store_enabled")?this.ui.subPanes.slideDown():App.Uploader.Views.ContributorAgreementOverlay.showAgreement().done(function(){return s.ui.subPanes.slideDown(),App.currentUser.set("store_enabled",!0),$.post("https://api.500px.com/v1/licensing/enable_store")}).fail(function(){return s.ui.marketCheck.removeClass("checked"),s._primeChange(!1)});else{if(n=this.model.editableAttributes.licensing_status.values,e=function(){var t,e,o;for(o=[],t=0,e=n.length;e>t;t++)i=n[t],0!==i&&1!==i&&o.push(i);return o}().length,e>0&&(r=this.$(".marketplace").i18n({count:this.model.photos.length,"return":!0}),!confirm(r)))return t.stopPropagation(),!1;this.ui.subPanes.slideUp()}return this._primeChange(o)},s.prototype.onDelete=function(t){var e,o,r;return o=t.model,e=null!=(r=o.id)?r:o.get("hash"),this.model.removeRelease(e),this.collection.remove(t.model),this.trigger("change:releases")},s.prototype.clickAddModel=function(){return this.type="model"},s.prototype.clickAddLocation=function(){return this.type="location"},s.prototype.onPickedFiles=function(t){return this._uploadReleases(t.target.files)},s.prototype.onApplyToAll=function(t){var e,o;return e=t.model,this.model.addRelease(null!=(o=e.id)?o:e.get("hash")),t.model.set("same",!0),this.trigger("change:releases")},s.prototype.changeReleaseSelect=function(){var t,e;return(e=this.ui.releaseSelect.val())?(t=i.get(e),t&&this._addRelease(t),this.ui.releaseSelect.find(".placeholder").prop("selected",!0)):void 0},s.prototype._renderReleasesDropdown=function(){return null==this.releaseDropdown&&(this.releaseDropdown=new o({el:this.ui.releaseSelect,collection:i,selectedCount:this.model.photos.length})),this.releaseDropdown.render()},s.prototype._addRelease=function(t){var e,o;return e=null!=(o=t.id)?o:t.uploadedRelease.get("hash"),this.model.addRelease(e),this.collection.add(t.clone()),this.trigger("change:releases")},s.prototype._uploadReleases=function(t){var e,o,r,n,s=this;for(n=[],o=0,r=t.length;r>o;o++)e=t[o],n.push(function(t){var e;return e=new App.Models.UploadedRelease(s.type,t),e.computeHash().done(function(t){var o;return a[t]||(a[t]=new App.Uploader.Models.Release({uploadedRelease:e,type:e.type}),i.add(a[t]),e.beginUpload()),o=a[t],o.get("id")?s._addRelease(o):o.on("change:id",function(){return s._addRelease(o)})})}(e));return n},s.prototype._primeChange=function(t){return this.ui.subPanes.toggleClass("disabled",!t)},s}(Marionette.CompositeView),r=function(t){function e(){return u=e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.tagName="option",e.prototype.template="release_select_item",e.prototype.onRender=function(){return this.$el.attr("value",this.model.get("id"))},e}(Marionette.ItemView),o=function(t){function e(){return h=e.__super__.constructor.apply(this,arguments)}return d(e,t),e.prototype.childView=r,e.prototype.initialize=function(t){return this.selectedCount=t.selectedCount,this.listenTo(this.collection,"sync",this.onSync)},e.prototype.onSync=function(){return 0===this.collection.length&&this.$el.closest(".select_wrap").hide(),this.$el.prop("disabled",0===this.collection.length)},e.prototype.onAddChild=function(t){return"model"===t.model.get("type")?t.$el.appendTo(this.$el.find("optgroup.models")):t.$el.appendTo(this.$el.find("optgroup.locations")),this.$el.closest(".select_wrap").show(),this.$el.prop("disabled",!1)},e.prototype.onRender=function(){return this.$el.prop("disabled",0===this.collection.length),this.$el.find("option.placeholder").i18n({count:this.selectedCount}),this.onSync()},e}(Marionette.CollectionView)}.call(this),function(){var t,e,o,r=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,n=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};e=App.module("Organizer.Views"),t=4,Handlebars.registerHelper("nl2br",function(t){return new Handlebars.SafeString(t.replace(/\n/g,"<br>"))}),e.LicensingErrorsWidget=function(e){function i(){return this.onScroll=r(this.onScroll,this),o=i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.template="licensing_errors_widget",i.prototype.className="licensing_errors_widget",i.prototype.templateHelpers=function(){var t;return t=_.uniq(this.errors()),1===t.length?{same:!0,errors:t[0]}:{same:!1}},i.prototype.onShow=function(){var t=this;return 0===this.errors().length?(this.$el.closest("li.licensing_errors").hide(),void 0):(_.delay(function(){return $("#organizer_right_pane .scroll").on("scroll",t.onScroll)},100),this.$el.closest("li.licensing_errors").addClass("flyout"),this.$(".licensing_errors_container").hide(),this.$qtip=this.$(".flyout_target").qtip({content:this.$(".licensing_errors_container"),style:{classes:"uploader_flyout",def:!1,tip:{width:20,height:10,mimic:"right center",offset:20}},position:{my:"right bottom",at:"left center",viewport:$(window),container:function(){return $("#organizer_right_pane .scroll")},effect:!1,adjust:{scroll:!0,x:-10,y:25}},show:"click",hide:"click"}))},i.prototype.onDestroy=function(){return null!=this.$qtip?(this.$qtip.qtip("destroy",!0),$("#organizer_right_pane .scroll").off("scroll",this.onScroll)):void 0},i.prototype.onScroll=function(){return this.$qtip.qtip("hide")},i.prototype.errors=function(){var e,o,r,i,n;for(o=function(){var o,r,i,n;for(i=this.model.photos,n=[],o=0,r=i.length;r>o;o++)e=i[o],e.get("licensing_status")===t&&n.push(e);return n}.call(this),n=[],r=0,i=o.length;i>r;r++)e=o[r],e.get("licensing_errors")&&n.push(e.get("licensing_errors"));return n},i}(Marionette.ItemView)}.call(this),function(){var t,e,o={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=App.module("Models"),t.Gallery=function(t){function o(){return e=o.__super__.constructor.apply(this,arguments)}return r(o,t),o.prototype.GALLERY_KINDS={KIND_GENERAL:0,KIND_LIGHTBOX:4,KIND_LICENSING_GALLERY:4,KIND_PORTFOLIO:4,KIND_PROFILE:3},o.prototype.isEmpty=function(){return 0===this.get("items_count")},o.prototype.containsOwnerPhotosOnly=function(){var t;return(t=this.get("kind"))===this.GALLERY_KINDS.KIND_PROFILE||t===this.GALLERY_KINDS.KIND_PORTFOLIO},o.prototype.isPrivate=function(){return this.get("privacy")},o.prototype.markPhotoMembership=function(t,e){return null==e&&(e={}),null==this._memberPhotoIds&&(this._memberPhotoIds={}),this._memberPhotoIds[t]=!0,e.silent?void 0:this.trigger("change:photoMembership",t,!0)},o.prototype.containsPhoto=function(t){return null==this._memberPhotoIds&&(this._memberPhotoIds={}),t.id in this._memberPhotoIds},o.prototype.getCoverPhotoId=function(){var t;return null!=(t=this.getCoverPhoto())?t.id:void 0},o.prototype.getCoverPhoto=function(){var t;return null!=(t=this.get("cover_photo"))?t[0]:void 0},o.prototype.setCover=function(t){var e,o=this;return e={_method:"put",cover_photo_id:t,cover_size:2048},$.post("https://api.500px.com/v1/users/"+this.get("user_id")+"/galleries/"+this.get("id"),e).done(function(t){return o.set("cover_photo",t.gallery.cover_photo)})},o.prototype.addPhotos=function(t){var e,o,r=this;return o={_method:"put",add:{photos:function(){var o,r,i;for(i=[],o=0,r=t.length;r>o;o++)e=t[o],i.push(e.id);return i}()}},$.post("https://api.500px.com/v1/users/"+this.get("user_id")+"/galleries/"+this.get("id")+"/items",o).done(function(o){var i,n,s;for(i=0,n=t.length;n>i;i++)e=t[i],"added"===(null!=(s=o[e.id])?s.result:void 0)&&(null==r._memberPhotoIds&&(r._memberPhotoIds={}),r._memberPhotoIds[e.id]=!0,r.trigger("change:photoMembership",e.id,!0),r._lastAddedPhotoHistory=_.reject(r._lastAddedPhotoHistory,function(t){return t.id===e.id}),r._lastAddedPhotoHistory.push(e));return r.set("updated_at",(new Date).toISOString())})},o.prototype.removePhotos=function(t){var e,o,r=this;return o={_method:"put",remove:{photos:function(){var o,r,i;for(i=[],o=0,r=t.length;r>o;o++)e=t[o],i.push(e.id);return i}()}},$.post("https://api.500px.com/v1/users/"+this.get("user_id")+"/galleries/"+this.get("id")+"/items",o).done(function(o){var i,n,s;for(i=0,n=t.length;n>i;i++)e=t[i],"removed"===(null!=(s=o[e.id])?s.result:void 0)&&(null==r._memberPhotoIds&&(r._memberPhotoIds={}),delete r._memberPhotoIds[e.id],r.trigger("change:photoMembership",e.id,!1),r._lastAddedPhotoHistory=_.reject(r._lastAddedPhotoHistory,function(t){return t.id===e.id
}));return r.set("updated_at",(new Date).toISOString())})},o.prototype.getLastAddedPhoto=function(){var t;return null==this._lastAddedPhotoHistory&&(this._lastAddedPhotoHistory=[],t=this.get("last_added_photo"),null!=t&&this._lastAddedPhotoHistory.push(new App.Models.Photo(t))),_.last(this._lastAddedPhotoHistory)},o.prototype.getPrivateShareUrl=function(){var t=this;return null==this.privateUrlDfd&&(this.privateUrlDfd=$.Deferred(),$.get("https://api.500px.com/v1/users/"+this.get("user_id")+"/galleries/"+this.get("id")+"/share_url").done(function(e){return t.privateUrlDfd.resolve("https://500px.com/"+e.share_url)}).fail(function(){var e;return(e=t.privateUrlDfd).reject.apply(e,arguments)})),this.privateUrlDfd.promise()},o.prototype.getCanonicalPath=function(){var t,e,o,r;return this.isPrivate()?"/g/"+this.get("token"):(t=null!=(r=this.galleryPath)?r:this.get("custom_path"),null==t&&(t=this.id),e=this.get("user"),o=_.isFunction(e.get)?e.get("username"):e.username,"/"+o+"/galleries/"+t)},o.prototype.getCanonicalUrl=function(){var t;return t=this.getCanonicalPath(),"https://500px.com"+t},o.prototype.getUrl=function(){var t,e;return t=this.get("user"),e=_.isFunction(t.get)?t.get("username"):t.username,"https://500px.com/"+e+"/galleries/"+this.get("custom_path")},o.prototype.isOwnedByCurrentUser=function(){var t;return this.get("user_id")===(null!=(t=App.currentUser)?t.get("id"):void 0)},o.prototype.shouldSubmitSharelizerCounts=function(){return!1},o.prototype.share=function(t,e){return null==this.popup&&(this.popup=new App.Lib.Sharelizer({url:this.getCanonicalUrl(),category:"Gallery Page"})),this[t](e)},o.prototype.google=function(){return this.popup.google()},o.prototype.facebook=function(){return this.popup.facebook()},o.prototype._pinterestShareData=function(){var t;return{media:null!=(t=this.get("cover_photo"))?t[0].url:void 0,description:this.get("description")}},o.prototype.pinterest=function(){var t;if(t=this._pinterestShareData(),!t.media||!t.description)throw"This view doesn't know how to share with pinterest";return this.popup.pinterest(t.media,t.description)},o.prototype._twitterShareData=function(){return{text:'Gallery "'+this.get("name")+'" by '+this.get("user").fullname+" #500px"}},o.prototype.twitter=function(){var t;if(t=this._twitterShareData(),!t.text)throw"This view doesn't know how to share with twitter";return this.popup.twitter(t.text)},o.prototype._stumbleuponShareData=function(){return{title:'Gallery "'+this.get("name")+'" by '+this.get("user").fullname+" #500px"}},o.prototype.stumbleupon=function(){var t;if(t=this._stumbleuponShareData(),!t.title)throw"This view doesn't know how to share with StumbleUpon";return this.popup.stumbleupon(t)},o.prototype.isFeatured=function(){return!!this.get("editors_choice")},o.prototype.feature=function(){var t,e,o=this;if(!App.currentUser)throw new Error("feature requires current user");if(this.isFeatured())throw new Error("gallery is already featured");return e="https://api.500px.com/v1/users/"+this.userId+"/galleries/"+this.galleryPath+"/editors_choice/add",t={method:"PUT"},$.ajax(e,t).done(function(){return o.set({editors_choice:!0})})},o.prototype.unfeature=function(){var t,e,o=this;if(!App.currentUser)throw new Error("feature requires current user");if(!this.isFeatured())throw new Error("gallery is not featured");return e="https://api.500px.com/v1/users/"+this.userId+"/galleries/"+this.galleryPath+"/editors_choice/remove",t={method:"PUT"},$.ajax(e,t).done(function(){return o.set({editors_choice:!1})})},o.prototype.reportContent=function(t,e){var o,r,i=this;return null==e&&(e=""),r="https://api.500px.com/v1/users/"+this.userId+"/galleries/"+this.id+"/report",o={reason:t},0===Number(t)&&(o.reason_details=e),$.post(r,o).done(function(){return i.trigger("contentReported",t)})},o}(Backbone.Model)}.call(this),function(){var t,e,o={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=App.module("Galleries.Models"),t.Gallery=function(t){function o(){return e=o.__super__.constructor.apply(this,arguments)}return r(o,t),o.prototype.initialize=function(t){return null==t&&(t={}),this.userId=t.userId,this.galleryPath=t.galleryPath},o.prototype.url=function(){var t,e;return t={include_user:!0,include_cover:1,cover_size:2048},e="https://api.500px.com/v1/users/"+this.userId+"/galleries",null!=this.galleryPath&&(e+="/"+this.galleryPath),""+e+"?"+$.param(t)},o.prototype.parse=function(t){return t.gallery},o}(App.Models.Gallery)}.call(this),function(){var t,e,o={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=App.module("Behaviors"),t.HasButtons=function(t){function o(){return e=o.__super__.constructor.apply(this,arguments)}return r(o,t),o.prototype.initialize=function(){var t,e,o,r,i,n=this;null==(o=this.view).events&&(o.events={}),this.options=this.view.normalizeUIKeys(this.options),r=this.options,i=[];for(t in r)e=r[t],i.push(function(t,e){return n.bindClickEvent(t,e)}(t,e));return i},o.prototype.bindClickEvent=function(t,e){var o,r,i;return o=this,null!=(r=this.view.events)[i="click "+t]?(r=this.view.events)[i="click "+t]:r[i]=function(r){var i,n,s,a,l,p,u,h,c;return u=this,a=o._extractOptions(u,e),"#"!==$(r.target).attr("href")&&(r.metaKey||r.ctrlKey||r.shiftKey)?void 0:(i=u.$(t),n=null!=(h=a.disabledClass)?h:"disabled",s=null!=(c=a.loadingClass)?c:"loading",i.hasClass(n)||i.is(":disabled")?o._stopEvent(r,a):o._confirmClick(u,i,r,a)?(l=a.fn.call(u,r),l===!0?!0:(p=o._stopEvent(r,a),$.isFunction(null!=l?l.always:void 0)&&(i.addClass("disabled loading"),l.always(function(){return i.removeClass("disabled loading")})),p)):o._stopEvent(r,a))}},o.prototype._extractOptions=function(t,e){var o;if(o={},$.isPlainObject(e)){if(o=e,null!=e.trigger?o.fn=function(){return t.trigger(e.trigger)}:!$.isFunction(o.fn)&&$.isFunction(t[o.fn])&&(o.fn=t[o.fn]),!$.isFunction(o.fn))throw new Error("No callback function specified")}else if($.isFunction(e))o={fn:e};else{if(!$.isFunction(t[e]))throw console.error(e),new Error("HasButton doesn't know how to use this value: "+e);o={fn:t[e]}}return o},o.prototype._stopEvent=function(t,e){if(null==e.stopEvent&&(e.stopEvent=!0),e.stopEvent===!0)return t.preventDefault(),!1;if(t[e.stopEvent]===!1)return!0;if(t[e.stopEvent])return t[e.stopEvent]();throw new Error("Unknown HasButtons value for stopEvent: "+option.stopEvent)},o.prototype._confirmClick=function(t,e,o,r){var i,n,s;return i=null!=(s=r.confirm)?s:e.data("confirm"),null!=i&&i!==!1?$.isFunction(i)?(n=i.apply(t),_.isString(n)?window.confirm(n):n):window.confirm(i):!0},o}(Marionette.Behavior)}.call(this),function(){var t,e,o,r=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,n=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};e=App.module("Behaviors"),t=$(window),e.IsPopover=function(e){function i(){return this.dismiss=r(this.dismiss,this),this.showPopover=r(this.showPopover,this),o=i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.initialize=function(t){if(this.classPrefix=t.classPrefix,null==this.classPrefix)throw new Error("must provide classPrefix");return this.view.dismiss=this.dismiss,this.view.showPopover=this.showPopover},i.prototype.showPopover=function(e,o){var r,i,n,s,a,l=this;if(null==o&&(o={}),null==e)throw new Error("View creator must provide event");return i=$("<div></div>").addClass("popover "+this.classPrefix+"__container").hide(),r=$("<div></div>").addClass("contain "+this.classPrefix+"__composite"),i.append(r),s={overwrite:!1,style:{def:!1,classes:"px_popover "+this.classPrefix,tip:{width:20,height:10}},position:{my:"left center",at:"right center",viewport:t,effect:!1,adjust:{method:"flipinvert shift"}},show:{event:e.type,delay:0,ready:!0},hide:{delay:0,event:"click unfocus"},events:{render:function(){return l.view.setElement(r),l.view.render()},show:function(e,o){return t.one("scroll resize",function(){return o.hide()}),l.view.trigger("IsPopover:show",o)},hide:function(t,e){return l.view.trigger("IsPopover:hide",e),l.qtipApi=null,e.destroy()}}},null!=o.position&&_.extend(s.position,o.position),n=$(o.target||e.target),a=_.defaults({content:i},s),this.qtipApi=n.qtip(a,e).qtip("api")},i.prototype.dismiss=function(){var t;return null!=(t=this.qtipApi)?t.hide():void 0},i}(Marionette.Behavior)}.call(this),function(){var t,e,o,r,i,n,s={}.hasOwnProperty,a=function(t,e){function o(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};r=App.module("Views"),t=$(window),e=function(t){function e(){return i=e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.template="add_to_galleries_popover_empty",e.prototype.className="add_to_galleries_popover_empty",e}(Marionette.ItemView),o=function(t){function e(){return n=e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.template="add_to_galleries_popover_item",e.prototype.tagName="li",e.prototype.className="add_to_galleries_popover__item",e.prototype.ui={thumbnail:".add_to_galleries_popover_item__thumbnail",checkbox:".add_to_galleries_popover_item__checkmark",popoverItem:".add_to_galleries_popover_item__wrap"},e.prototype.triggers={"click @ui.popoverItem":"clicked"},e.prototype.modelEvents={"change:photoMembership":"_updateCheckmark"},e.prototype.onRender=function(){return this._updateCheckmark()},e.prototype._updateCheckmark=function(){var t,e,o,r,i,n,s;if(this.model.isNew())t=!0,e=!1;else if(this.options.photos)for(t=!0,e=!1,s=this.options.photos,i=0,n=s.length;n>i;i++)r=s[i],this.model.containsPhoto(r)?e=!0:t=!1;else this.options.batchEditablePhoto&&(o=this.options.batchEditablePhoto.checkGalleryMembership(this.model),t=o.containsAllPhotos,e=o.containsSomePhotos);return t?this.select():e?this.selectPartial():this.unselect()},e.prototype.templateHelpers=function(){var t;return{thumbUrl:null!=(t=this.model.getLastAddedPhoto())?t.getImagePath({size:1}):void 0,galleryUrl:this.model.getCanonicalUrl()}},e.prototype.toggleCheckmark=function(){return this._checked=this._partiallyChecked?!0:!this._checked,this._partiallyChecked=!1,this.ui.thumbnail.toggleClass("add_to_galleries_popover_item__thumbnail--checked",this._checked),this.ui.checkbox.toggleClass("add_to_galleries_popover_item__checkmark--checked",this._checked),this.ui.checkbox.removeClass("add_to_galleries_popover_item__checkmark--partial_checked")},e.prototype.selected=function(){return this._checked},e.prototype.select=function(){return this._checked=!0,this._partiallyChecked=!1,this.ui.thumbnail.addClass("add_to_galleries_popover_item__thumbnail--checked"),this.ui.checkbox.addClass("add_to_galleries_popover_item__checkmark--checked")},e.prototype.selectPartial=function(){return this._checked=!0,this._partiallyChecked=!0,this.ui.thumbnail.addClass("add_to_galleries_popover_item__thumbnail--checked"),this.ui.checkbox.addClass("add_to_galleries_popover_item__checkmark--partial_checked")},e.prototype.unselect=function(){return this._checked=!1,this._partiallyChecked=!1,this.ui.thumbnail.removeClass("add_to_galleries_popover_item__thumbnail--checked"),this.ui.checkbox.removeClass("add_to_galleries_popover_item__checkmark--checked"),this.ui.checkbox.removeClass("add_to_galleries_popover_item__checkmark--partial_checked")},e}(Marionette.ItemView),r.AddToGalleriesPopover=function(t){function r(t){null==t&&(t={}),null==App.myGalleries&&(App.myGalleries=new App.Collections.MyGalleries([])),App.myGalleries.sort(),t.collection=App.myGalleries,r.__super__.constructor.call(this,t)}return a(r,t),r.prototype.template="add_to_galleries_popover",r.prototype.childViewContainer="ul",r.prototype.childView=o,r.prototype.emptyView=e,r.prototype.childViewOptions=function(){return{batchEditablePhoto:this.batchEditablePhoto,photos:this.photos}},r.prototype.behaviors={InfiniteScroll:{container:function(){return this.ui.list}},HasButtons:{"@ui.createButton":"onCreateButtonClicked"},IsPopover:{classPrefix:"add_to_galleries_popover"}},r.prototype.ui={title:".add_to_galleries_popover__create_gallery__title",closeButton:".add_to_galleries_popover__close_button",createIcon:".add_to_galleries_popover__create_icon",createInput:".add_to_galleries_popover__title_input",createSection:".add_to_galleries_popover__create_section",privacyCheckbox:".add_to_galleries_popover__checkbox",createButton:".add_to_galleries_popover__create_button",list:".add_to_galleries_popover__galleries_list.scroll"},r.prototype.events={"click @ui.closeButton":"onClickClose","click @ui.createIcon":"onCreateIconClicked","click @ui.createInput":function(){return this.toggleCreateSection(!0)},"input @ui.createInput":function(){return this.toggleCreateSection(!0)},"click @ui.privacyCheckbox":function(){return this.ui.privacyCheckbox.toggleClass("checked")},keyup:"onKeyup"},r.prototype.onClickClose=function(){return this.dismiss()},r.prototype.onCreateIconClicked=function(){return this.toggleCreateSection(!0),this.ui.createInput.focus()},r.prototype.onCreateButtonClicked=function(){var t,e,o=this;return t={userId:App.currentUser.id,name:this._getNewTitle(),privacy:this.ui.privacyCheckbox.hasClass("checked"),kind:0,auto_path:!0},e=new App.Galleries.Models.Gallery(t),e.save().done(function(){return e.set({user:App.currentUser.toJSON()},{silent:!0}),o.toggleCreateSection(!1),o._toggleGalleryMembership(e,!0),App.myGalleries.add(e,{at:0})}).fail(function(){var t,e;return t=(e=App.Helpers.API).parseError.apply(e,arguments),App.Flash.error(App.Helpers.API.getErrorMessage(t)),o.ui.createInput.focus()})},r.prototype.toggleCreateSection=function(t){return this.createMode=t,this.ui.createSection.toggleClass("add_to_galleries_popover__create_section--active",t),t||this.ui.createInput.val(""),this._updateCreateButton(),this.ui.list.height(this.$(".inside").innerHeight()-this.ui.title.outerHeight()-this.ui.createInput.outerHeight()-2-(t?111:0))},r.prototype._updateCreateButton=function(){return this.ui.createButton.toggleClass("disabled",this._getNewTitle().length<1)},r.prototype._getNewTitle=function(){return $.trim(this.ui.createInput.val())},r.prototype.initialize=function(t){var e;if(this.kind=t.kind,this.batchEditablePhoto=t.batchEditablePhoto,this.photos=t.photos,"gallery"!==(e=this.kind)&&"portfolio"!==e&&"profile"!==e)throw new Error("Incorrect kind: "+this.kind);if(null!=this.batchEditablePhoto){if(null!=this.photos)throw new Error("photos should not be used in batch editing mode")}else if(!(null!=this.photos&&this.photos.length>0))throw new Error("photos are missing");return this.createMode=!1,this._checkMembership()},r.prototype._checkMembership=function(){var t,e,o,r;if(null!=this.photos)for(r=this.photos,e=0,o=r.length;o>e;e++)t=r[e],this.collection.reconcileMembershipOfPhoto(t.id);else this.batchEditablePhoto.reconcileGalleryMemberships(this.collection);return this.listenTo(this.collection,"error:reconcileMembershipOfPhoto",function(){var t,e;return t=(e=App.Helpers.API).parseError.apply(e,arguments),App.Flash.error(App.Helpers.API.getErrorMessage(t))})},r.prototype.onKeyup=function(t){var e;switch(t.which){case 27:return this.createMode?this.ui.createInput.val()?(e=this.ui.list.i18n("messages-abort-creation",{"return":!0}),confirm(e)?this.toggleCreateSection(!1):this.ui.createInput.focus()):this.toggleCreateSection(!1):this.dismiss();case 13:if(this.createMode&&!this.ui.createButton.hasClass("disabled"))return this.onCreateButtonClicked()}},r.prototype.onRender=function(){var t=this;return null==this.collection.totalPages&&this.collection.fetch(),this.ui.title.i18n("galleries",{count:1}),this.ui.createInput.attr("placeholder",this.ui.createInput.i18n(this.kind,{"return":!0})),this.ui.list.scrollLock("on",null,!0),_.defer(function(){return t.ui.createInput.focus(),t.toggleCreateSection(!1)})},r.prototype.onChildviewClicked=function(t,e){return t.toggleCheckmark(),this._toggleGalleryMembership(e.model,t.selected(),t)},r.prototype._toggleGalleryMembership=function(t,e,o){var r,i,n,s,a,l,p=this;return null!=this.batchEditablePhoto?e?this.batchEditablePhoto.addGallery(t.id):(this.batchEditablePhoto.removeGallery(t.id),null!=o&&o.render(),App.vent.trigger("addToGalleriesPopover:removePhoto",t.id,null!=(n=o.options.photos)?null!=(s=n[0])?s.id:void 0:void 0)):(e?(r=t.addPhotos,i="messages-gallery-add"):(App.vent.trigger("addToGalleriesPopover:removePhoto",t.id,null!=(a=o.options.photos)?null!=(l=a[0])?l.id:void 0:void 0),r=t.removePhotos,i="messages-gallery-remove"),r.call(t,this.photos).done(function(){var e,o;return o=$("<a>").text(p.ui.list.i18n("messages-view-gallery",{"return":!0})).attr("href",t.getCanonicalUrl()).attr("target","_blank")[0].outerHTML,e=""+p.ui.list.i18n(i,{count:p.photos.length,"return":!0})+" "+o,App.Flash.success(e),p.dismiss()}).fail(function(){var t,e;return t=(e=App.Helpers.API).parseError.apply(e,arguments),App.Flash.error(App.Helpers.API.getErrorMessage(t))})),App.vent.trigger("change:gallery_membership")},r}(Marionette.CompositeView)}.call(this),function(){var t,e,o={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i=[].slice;t=App.module("Collections"),t.MyGalleries=function(t){function o(){return e=o.__super__.constructor.apply(this,arguments)}return r(o,t),o.prototype.rpp=20,o.prototype.model=App.Models.Gallery,o.prototype.comparator=function(t){return-Date.parse(t.get("updated_at"))},o.prototype.url=function(){var t;return t={privacy:"both",include_cover:1,cover_size:3,include_last_added:!0,sort:"last_added_to_at",sort_direction:"desc",kinds:"0,1,2,4,5"},"https://api.500px.com/v1/users/"+App.currentUser.id+"/galleries?"+$.param(t)},o.prototype.initialize=function(t,e){if(null==e&&(e={}),o.__super__.initialize.apply(this,arguments),this.on("add",this.onModelAdded),null==App.currentUser)throw new Error("Cannot find currentUser")},o.prototype.reconcileMembershipOfPhoto=function(t){return this._loadMembershipOfPhoto(t)},o.prototype._loadMembershipOfPhoto=function(t,e){var o,r,n,s,a,l=this;if(null==e&&(e=1),1===e){null!=(s=this._pendingReconciliationXhr)&&s.abort(),null==this._notLoadedGalleriesInfo&&(this._notLoadedGalleriesInfo={}),a=this._notLoadedGalleriesInfo;for(o in a)r=a[o],delete r[t]}return n={sort:"updated_at",sort_direction:"desc",user_id:App.currentUser.id,rpp:1e3},this._pendingReconciliationXhr=$.get("https://api.500px.com/v1/photos/"+t+"/galleries?"+$.param(n)).done(function(o){var r,i,n,s,a,p;for(l._pendingReconciliationXhr=null,p=o.galleries,s=0,a=p.length;a>s;s++)r=p[s],i=r.id,r=l.findWhere({id:i}),null!=r?r.markPhotoMembership(t):(null==(n=l._notLoadedGalleriesInfo)[i]&&(n[i]={}),l._notLoadedGalleriesInfo[i][t]=!0);return e<o.total_pages?l._loadMembershipOfPhoto(t,e+1):void 0}).fail(function(t,e){return"abort"!==e?l.trigger.apply(l,["error:reconcileMembershipOfPhoto"].concat(i.call(arguments))):void 0})},o.prototype.onModelAdded=function(t){var e,o,r,i;if(e=null!=(i=this._notLoadedGalleriesInfo)?i[t.id]:void 0,null!=e){for(o in e)r=e[o],t.markPhotoMembership(o);return delete this._notLoadedGalleriesInfo[t.id]}},o.prototype.parse=function(t){var e,r,i,n,s;for(s=null!=(n=null!=t?t.galleries:void 0)?n:[],r=0,i=s.length;i>r;r++)e=s[r],e.user=App.currentUser.toJSON();return o.__super__.parse.call(this,t)},o}(App.Collections.InfiniteCollection)}.call(this),function(){var t,e,o,r,i,n=function(t,e){return function(){return t.apply(e,arguments)}},s={}.hasOwnProperty,a=function(t,e){function o(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},l=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1};o=App.module("Organizer.Views"),o.PhotoDetailsPanel=function(i){function s(){return this.updateBulkMaxKeywordNotice=n(this.updateBulkMaxKeywordNotice,this),this.onDestroy=n(this.onDestroy,this),this.setupFlyoutWidgets=n(this.setupFlyoutWidgets,this),this.initialize=n(this.initialize,this),r=s.__super__.constructor.apply(this,arguments)}return a(s,i),s.prototype.ui={mapToggle:".map .flyout_target",discoverabilityHint:".discoverability .hint",discoverabilityBar:".discoverability .progress_bar",discoverabilityBarProgress:".discoverability .progress_bar .progress",scrollablePanel:".scroll.edit",tagsTextarea:".tags .tags_textarea_container",deleteButton:".delete_button",nameInput:".name input",setsCheck:".sets .flyout_target .completed_checkmark",galleriesCheck:".galleries_widget__uploader_target .completed_checkmark",portfoliosCheck:".portfolios .flyout_target .completed_checkmark",addToGalleryButton:".galleries_widget__button, .galleries_widget__uploader_target"},s.prototype.fields={input:["name","camera","lens","focal_length","shutter_speed","aperture","iso","taken_at"],textarea:["description"],checkbox:["nsfw","marketplace","exclusive_use","watermark"],select:["category","license_type","licensing_usage"],object:["tags"]},s.prototype.events={"click .checkbox":"toggleCheckbox","click @ui.deleteButton":"clickDelete","click @ui.mapToggle":"clickMap"},s.prototype.behaviors={HasButtons:{"@ui.addToGalleryButton":"_openAddToGalleryPopover"}},s.prototype._openAddToGalleryPopover=function(t){var e;return e=new App.Views.AddToGalleriesPopover({kind:"gallery",batchEditablePhoto:this.model,position:{my:"right center",at:"left center"}}),e.showPopover(t),!1},s.prototype.initialize=function(t){return this.enableFlyoutWidgets=t.enableFlyoutWidgets,this.enableTooltips=t.enableTooltips,this.showGalleriesOnboarding=t.showGalleriesOnboarding,this.isUploader=t.isUploader,t},s.prototype.templateHelpers=function(){return{attributes:this.model.editableAttributes}},s.prototype.onFormChanged=function(){var t,e;if(0!==this.model.photos.length){if(this.model.setBatchedAttributes(this.readFields()),t=this.model.batchedAttributesChanged(),this.model.photos.length>1){this.$("ul.fields > li").removeClass("changed");for(e in this.model.attributes)l.call(this.model.exifFields,e)>=0?e="exif":"longitude"===e||"latitude"===e?e="map":"add_tags"===e||"remove_tags"===e?e="tags":("add_releases"===e||"remove_releases"===e)&&(e="releases"),this.$("ul.fields > li."+e).addClass("changed")}return this.updateDiscoverabilityBar(),this.trigger("formChanged",t),this.updateCompletedCheckmarks()}},s.prototype.updateCompletedCheckmarks=function(){return this.model.geoCoords()&&this.$(".map .completed_checkmark").addClass("checked"),this.model.allHaveGalleries()?this.ui.galleriesCheck.removeClass("partial_checked").addClass("checked"):this.model.hasGalleries()?this.ui.galleriesCheck.removeClass("checked").addClass("partial_checked"):this.ui.galleriesCheck.removeClass("checked").removeClass("partial_checked"),this.model.allHaveSets()?this.ui.setsCheck.removeClass("partial_checked").addClass("checked"):this.model.hasSets()?this.ui.setsCheck.removeClass("checked").addClass("partial_checked"):this.ui.setsCheck.removeClass("checked").removeClass("partial_checked"),this.model.allHavePortfolios()?this.ui.portfoliosCheck.removeClass("partial_checked").addClass("checked"):this.model.hasPortfolios()?this.ui.portfoliosCheck.removeClass("checked").addClass("partial_checked"):this.ui.portfoliosCheck.removeClass("checked").removeClass("partial_checked")},s.prototype.toggleCheckbox=function(t){var e;return e=$(t.target),e.hasClass("disabled")?void 0:(e.hasClass("checked")?e.removeClass("checked"):e.hasClass("multi_values")?e.toggleClass("multi_values checked"):e.addClass("checked"),this.onFormChanged(t))},s.prototype.onShow=function(){var t;return t=this.model.photos.length>0,t&&this._shouldShowRightGalleriesOnboarding()?$("#organizer_right_pane .scroll").animate({scrollTop:$(".galleries_widget__button").offset().top-240},{duration:400,complete:function(){return new e({target:$(".galleries_widget__button")})}}):void 0},s.prototype.onRender=function(){var t,e,r,i,n=this;return s.__super__.onRender.call(this),t=this.model.photos.length>1,this.listenTo(this.model,"updatedName",function(){return n.onNameChanged()}),e=this.model.photos.length>0,e&&(this.updateDiscoverabilityBar(),this.updateDeleteButton(),this.$("input, textarea").on("input",function(t){return n.onFormChanged(t)}),this.$el.on("change","select",function(t){return n.onFormChanged(t)}),this.$(".field_reset").click(function(t){return n.onSingleReset(t)}),this.listenTo(this.model,"change:geolocation",function(){return n.onFormChanged()})),_.defer(function(){return n.isDestroyed?void 0:n.setupFlyoutWidgets(e)}),this.tags=new App.Organizer.Views.TagsField({el:this.$(".tags_field_wrap"),collection:new App.Organizer.Collections.PhotoTags(this.model.getInitialTags()),model:this.model}),this.tags.render(),this.tags.on("tag:update",function(t){return n.onFormChanged(t),n.updateBulkMaxKeywordNotice()}),this.updateBulkMaxKeywordNotice(),t?this.$(".tags").addClass("bulk"):(this.updateKeywordsCount(),this.tags.on("tag:update",function(){return n.updateKeywordsCount()})),null!=(r=this.licensingRegion)&&r.show(new o.EditPrimePane({photos:this.model.photos})),this._renderReleases(),this._renderLicensingErrors(),this.setupTooltips(),this.enableOrDisableForm(e),e&&(this.$("li.licensing").length>0&&this.addRegion("licensingRegion","li.licensing"),null!=(i=this.licensingRegion)&&i.show(new o.EditPrimePane({photos:this.model.photos})),this.model.photos.length>0)?this.showTagSuggestions():void 0},s.prototype._shouldShowRightGalleriesOnboarding=function(){return this.showGalleriesOnboarding&&!App.Helpers.isMobileOrTablet()&&App.Behaviors.IsDismissible.shouldShow(this,"onboarding_right_organizer_galleries")},s.prototype._renderReleases=function(){var t=this;if(0!==this.$("li.releases").length)return this.addRegion("releasesRegion","li.releases"),this.releaseWidget=new o.ReleasesWidget({model:this.model,releases:this.model.get("releases")}),this.releasesRegion.show(this.releaseWidget),this.releaseWidget.on("change:releases",function(){return t.onFormChanged()})},s.prototype._renderLicensingErrors=function(){return this.$("li.licensing_errors").length>0?(this.addRegion("licensingErrorsRegion","li.licensing_errors"),this.licensingErrorsWidget=new o.LicensingErrorsWidget({model:this.model}),this.licensingErrorsRegion.show(this.licensingErrorsWidget)):void 0},s.prototype.showTagSuggestions=function(){return this.$("li.suggested_tags").length>0?(this.addRegion("suggestedTagsRegion","li.suggested_tags"),this.suggestedTags=new o.SuggestedTags({tags:this.tags.collection}),this.suggestedTagsRegion.show(this.suggestedTags)):void 0},s.prototype.onNameChanged=function(){return this.$("li.name input").is(":focus")?void 0:this.resetSingleSection(this.$("li.name"),"name")},s.prototype.setupTooltips=function(){var t,e,o,r,i;if(!this.enableTooltips)return this.$(".tooltip_target").hide();if(this.ui.discoverabilityHint.hide(),!this.$(".tooltip_target").hasClass("disabled")){for(r=this.$(".tooltip_target"),i=[],e=0,o=r.length;o>e;e++)t=r[e],i.push($(t).qtip({content:$(t).find(".tooltip_content"),style:{classes:"tooltip_container",tip:{width:14,height:8}},position:{my:"top center",at:"bottom center"},hide:{fixed:!0,delay:300}}));return i}},s.prototype.setupFlyoutWidgets=function(t){var e,o=this;return this.$("li.galleries").length>0&&this.listenTo(App.vent,"change:gallery_membership",function(){return o.onFormChanged()}),this.$(".sets_container").hide(),this.$(".portfolios_container").hide(),t&&(e={style:{classes:"uploader_flyout",def:!1,tip:{width:20,height:10,mimic:"right center",offset:20}},position:{my:"right bottom",at:"left center",viewport:$(window),effect:!1,adjust:{x:-10,y:3}},show:"click",hide:"click unfocus"},this.$(".map").addClass("flyout"),this.$("li.sets").length>0&&(this.$(".sets").addClass("flyout"),this.setsQTip=this.$(".sets .flyout_target").qtip(_.extend({content:this.$(".sets_container"),events:{visible:function(t,e){return e.tooltip.find(".flyout_title .title").i18n("sets",{count:o.model.photos.length}),o.sets.refresh()}}},e)),App.Uploader.setsXhr.done(function(){var t;return null!=(t=o.setsQTip)?t.qtip("reposition"):void 0}),this.sets=new App.Uploader.Views.SetsWidget({el:this.$(".sets_container .sets_widget_composite"),collection:App.Uploader.sets,photoModel:this.model,qTipTarget:this.$(".sets .flyout_target"),kind:"profile"}),this.sets.render(),this.listenTo(this.sets,"changed:sets",function(){return o.onFormChanged()})),this.$("li.portfolios").length>0&&(this.$(".portfolios").addClass("flyout"),this.portfoliosQTip=this.$(".portfolios .flyout_target").qtip(_.extend({content:this.$(".portfolios_container"),events:{visible:function(t,e){return e.tooltip.find(".flyout_title .title").i18n("portfolios",{count:o.model.photos.length}),o.portfolios.refresh()}}},e)),App.Uploader.portfoliosXhr.done(function(){var t;return null!=(t=o.portfoliosQTip)?t.qtip("reposition"):void 0}),this.portfolios=new App.Uploader.Views.SetsWidget({el:this.$(".portfolios_container .sets_widget_composite"),collection:App.Uploader.portfolios,photoModel:this.model,qTipTarget:this.$(".portfolios .flyout_target"),kind:"portfolio"}),this.portfolios.render(),this.listenTo(this.portfolios,"changed:sets",function(){return o.onFormChanged()}))),this.updateCompletedCheckmarks()},s.prototype.onDestroy=function(){var t,e,o,r,i;if(this._removeMap(),this.$(".sets .flyout_target").qtip("destroy",!0),this.enableTooltips){for(r=this.$(".tooltip_target"),i=[],e=0,o=r.length;o>e;e++)t=r[e],i.push($(t).qtip("destroy",!0));return i}},s.prototype._removeMap=function(){var t;return null!=(t=this.map)&&t.destroy(),$(this.ui.mapToggle).qtip("destroy",!0)},s.prototype.updateDeleteButton=function(){return this.ui.deleteButton.i18n("label",{count:this.model.photos.length})},s.prototype.updateBulkMaxKeywordNotice=function(){var t;return t=this.model.photos.length>1,_.isEmpty(this.model.photos_with_max_tags)?this.$(".tags").removeClass("some_at_max"):this.$(".tags").addClass("some_at_max")},s.prototype.updateKeywordsCount=function(){return this.$(".tags .keywords_count_container .count").text(""+this.tags.size()+"/"+this.tags.max())},s.prototype.updateDiscoverabilityBar=function(){var t,e;return e=this.model.getDiscoverability(),t=null!=e,this.ui.discoverabilityBar.toggleClass("disabled",!t),this.enableTooltips&&this.$(".discoverability .tooltip_target").toggleClass("disabled",!t),t?(this.ui.discoverabilityHint.i18n("regular"),this.ui.discoverabilityBarProgress.width(""+e+"%"),this.ui.discoverabilityBarProgress.toggleClass("almost",e>=60&&100>e),this.ui.discoverabilityBarProgress.toggleClass("full",e>=100)):1===this.model.photos.length?this.ui.discoverabilityHint.i18n("private"):void 0},s.prototype.enableOrDisableForm=function(t){return this.ui.discoverabilityBar.toggleClass("disabled",!t),this.$("input, textarea, select, .checkbox, .button, .flyout_target h4, .galleries_widget__uploader_button").toggleClass("disabled",!t).prop("disabled",!t)},s.prototype.resetSingleSection=function(t,e){return"exif"===e?this._resetExifSection(t):"map"===e?this._resetMapSection(t):"tags"===e?this._resetTagsSection(t):this._resetInputSection(t,e)},s.prototype.onSingleReset=function(t){var e,o,r,i,n;if(t.preventDefault(),e=$(t.target).closest("ul.fields > li"),e.hasClass("map"))return this.resetSingleSection(e,"map"),this.onFormChanged(t),void 0;if(e.hasClass("tags"))return this.resetSingleSection(e,"tags"),this.onFormChanged(t),void 0;for(n=this.model.editableFields,r=0,i=n.length;i>r;r++)if(o=n[r],l.call(this.model.exifFields,o)>=0){if(e.hasClass("exif"))return this.resetSingleSection(e,"exif"),this.onFormChanged(t),void 0}else if(e.hasClass(o))return this.resetSingleSection(e,o),this.onFormChanged(t),void 0},s.prototype.readFields=function(){var t,e,o,r,i,n,s,a,l,p,u,h;i={};for(e in this.fields)if(r=this.fields[e],"checkbox"===e)for(s=0,p=r.length;p>s;s++)o=r[s],t=this.$("."+o+" .checkbox"),0!==t.length&&(i[o]=t.hasClass("multi_values")?"multi_values":t.hasClass("checked"));else if("object"===e)for(a=0,u=r.length;u>a;a++)o=r[a],n=this[o],i[o]=n.val();else for(l=0,h=r.length;h>l;l++)o=r[l],t=this.$("."+o+" "+e),i[o]=t.val();return i.marketplace||(delete i.exclusive_use,delete i.licensing_usage),i},s.prototype.clickDelete=function(){var t,e,o,r=this;return o=function(){var t,o,r,i;for(r=App.organizer.photos.models,i=[],t=0,o=r.length;o>t;t++)e=r[t],e.get("selected")&&i.push(e);return i}(),t=this.ui.deleteButton.i18n("confirm",{count:o.length,"return":!0}),confirm(t)?(new App.Organizer.Models.OrganizerTrash)["delete"](o).fail(function(){var t;
return t=r.ui.deleteButton.i18n("error",{"return":!0}),new PxApp.Shared.FlashMessage({type:"error",message:t}).render()}).done(function(){return App.organizer.fetchPhotos()}):void 0},s.prototype.clickMap=function(e){var o,r,i;return o=this.model.photos.length>0,o&&(r=this.isUploader?null!=App.uploaderMapCache?App.uploaderMapCache:App.uploaderMapCache={}:null!=App.mapCache?App.mapCache:App.mapCache={},i=new t({model:this.model,mapCache:r}),i.showPopover(e)),!1},s.prototype._resetExifSection=function(t){var e,o,r,i,n,s;for(n=this.model.exifFields,s=[],r=0,i=n.length;i>r;r++)e=n[r],o=this.model.editableAttributes[e].same?this.model.editableAttributes[e].uniqueValue:"",s.push(t.find(".item."+e+" input").val(o));return s},s.prototype._resetMapSection=function(){return this.model.editableAttributes.geolocation.same?this.model.setGeoCoords(this.model.editableAttributes.geolocation.uniqueValue):this.model.setGeoCoords(null)},s.prototype._resetTagsSection=function(t){return this.tags.collection.reset(this.model.getInitialTags()),t.removeClass("changed")},s.prototype._resetInputSection=function(t,e){var o;switch(o=t.find("input, textarea, select, .checkbox").first(),o.prop("tagName")){case"INPUT":case"TEXTAREA":return this.model.editableAttributes[e]?o.val(this.model.editableAttributes[e].uniqueValue):o.val("");case"SELECT":return this.model.editableAttributes[e].same?o.val(this.model.editableAttributes[e].uniqueValue):o.val("multi_values");case"DIV":if(o.hasClass("checkbox"))return this.model.editableAttributes[e].same?o.removeClass("multi_values").toggleClass("checked",this.model.editableAttributes[e].uniqueValue):o.removeClass("checked").addClass("multi_values")}},s}(App.Views.WidgetPane),t=function(t){function e(){return i=e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.template="organizer_map_popover",e.prototype.ui={mapBox:".map_box",done:".done"},e.prototype.events={"click @ui.done":"onClickDone"},e.prototype.behaviors={IsPopover:{classPrefix:"organizer_map_popover"}},e.prototype.initialize=function(t){var e=this;return this.mapCache=t.mapCache,this.on("IsPopover:hide",function(){return e.map.onDestroy()})},e.prototype.onRender=function(){var t=this;return _.defer(function(){return t.map=new App.Views.Map({model:t.model,el:t.ui.mapBox,scroll:!0,enableLocationPicker:!0,searchInputEl:t.$(".map_input")[0],mapCache:t.mapCache}),t.map.refresh()})},e.prototype.onClickDone=function(){return this.dismiss()},e}(Marionette.ItemView),e=function(t){function e(t){if(null==t.target)throw new Error("must provide target");this.target=t.target,null==this.behaviors&&(this.behaviors={}),this.behaviors.IsModalPopover={target:this.target,classPrefix:"right_organizer_galleries_onboarding_popover",isDismissible:"onboarding_right_organizer_galleries",position:{my:"right center",at:"left center"}},e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.template="right_organizer_galleries_onboarding_popover",e.prototype.tagName="div",e.prototype.events={"click #accept_galleries_onboarding":"acceptGalleriesOnboarding"},e.prototype.acceptGalleriesOnboarding=function(){return this.dismiss(),!1},e}(Marionette.ItemView)}.call(this),function(){var t,e={}.hasOwnProperty,o=function(t,o){function r(){this.constructor=t}for(var i in o)e.call(o,i)&&(t[i]=o[i]);return r.prototype=o.prototype,t.prototype=new r,t.__super__=o.prototype,t};t=App.module("Organizer.Views"),t.EditWidget=function(e){function r(){null==this.ui&&(this.ui={}),this.ui.header="h2.header",r.__super__.constructor.apply(this,arguments)}return o(r,e),r.prototype.regions={photoDetails:".photo_details"},r.prototype.onShow=function(){return this.onSelectionChanged(),this.monitorPhotoSelection(),this.listenTo(App.vent,"navigate",this.onNavigate),this.updateHeaderAndPanel(),this.setupModelEventHandlers()},r.prototype.setupModelEventHandlers=function(){return this.listenTo(this.model,"request",this.onRequestInProgress),this.listenTo(this.model,"batchedChange",this.onComplete),this.listenTo(this.model,"error",this.onError)},r.prototype.enable=function(){return this.$el.removeClass("disabled"),this.$("a").css("cursor","").removeAttr("disabled")},r.prototype.disable=function(){return this.$el.addClass("disabled"),this.$("a").css("cursor","default").attr("disabled","disabled")},r.prototype.onRequestInProgress=function(){return this.photoDetailsPanel.enableOrDisableForm(!1)},r.prototype.onComplete=function(){return this.photoDetailsPanel.render(),App.router.unlockNavigation()},r.prototype.onNavigate=function(){return this.monitorPhotoSelection(),this.onSelectionChanged()},r.prototype.bindSelectionEvents=function(){throw new Error("Implementation missing")},r.prototype.monitorPhotoSelection=function(){var t=this;return this.bindSelectionEvents(function(){return t.onSelectionChanged()})},r.prototype.onSelectionChanged=function(){return null!=this.model&&this.stopListening(this.model),this.model=new App.Organizer.Models.BatchEditablePhoto(this.getSelectedPhotos()),this.setupModelEventHandlers(),this.updateHeaderAndPanel()},r.prototype.updateHeaderAndPanel=function(){var e;return e=0===this.model.photos.length,this.$el.toggleClass("disabled",e),e?this.ui.header.i18n("disabled"):this.ui.header.i18n("editing",{count:this.model.photos.length}),null!=this.photoDetailsPanel&&this.stopListening(this.photoDetailsPanel),this.photoDetailsPanel=new t.PhotoDetailsPanel({model:this.model,template:this.photoDetailsTemplate,enableTooltips:this.enableTooltips,showGalleriesOnboarding:this.showGalleriesOnboarding,isUploader:this.isUploader}),this.photoDetails.show(this.photoDetailsPanel),this.listenTo(this.photoDetailsPanel,"formChanged",this.onFormChange),"function"==typeof this.updateUi?this.updateUi():void 0},r.prototype.onFormChange=function(){throw new Error("Implementation missing")},r.prototype.saveModels=function(t){null==t&&(t=!0),t?this.model.save():this.model.propagateBatchedAttributes()},r}(Marionette.LayoutView)}.call(this),function(){var t,e,o,r,i={}.hasOwnProperty,n=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};e=App.module("Uploader.Views"),e.EditPane=function(e){function r(){return o=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.template="uploader_edit_pane",r.prototype.className="uploader_edit_pane",r.prototype.ui={publish:".publish"},r.prototype.regions={editRegion:".edit_section"},r.prototype.behaviors={HasButtons:{"@ui.publish":"publish"}},r.prototype.initialize=function(){return this.listenTo(this.collection,"change:upload_finished",this.onUploadFinished),this.listenTo(this.collection,"remove",this.onUploadFinished),this.listenTo(this.collection,"remove",this.onPhotoRemoved),this.listenTo(this.collection,"add",function(){return this.ui.publish.find(".text").i18n("publish",{count:this.collection.length}),this.editor.onSelectionChanged()})},r.prototype.onPhotoRemoved=function(){return this.editor.onSelectionChanged()},r.prototype.onShow=function(){return this.editor=new t({collection:this.collection}),this.editRegion.show(this.editor),this.ui.publish.find(".text").i18n("publish",{count:this.collection.length})},r.prototype.onUploadFinished=function(){return this.publishing?this.publish():void 0},r.prototype.publish=function(){var t,e,o=this;if(e=this.collection.all(function(t){return t.get("upload_finished")===!0}),this.editor.disable(),this.$(".publish").addClass("disabled loading"),e){if(t=this.collection.publish().done(function(){return App.vent.trigger("uploader:published")}).fail(function(){return o.editor.enable(),alert("Failed to publish some photos"),o.$(".publish").removeClass("disabled loading"),App.vent.trigger("uploader:publishFailed")}),!this.publishing)return App.vent.trigger("uploader:publish")}else if(!this.publishing)return this.publishing=!0,App.vent.trigger("uploader:publish")},r}(Marionette.LayoutView),t=function(t){function e(){return r=e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.template="uploader_editor",e.prototype.className="uploader_editor",e.prototype.photoDetailsTemplate="uploader_photo_details",e.prototype.enableTooltips=!0,e.prototype.showGalleriesOnboarding=!1,e.prototype.isUploader=!0,e.prototype.bindSelectionEvents=function(t){return this.stopListening(this.collection),this.listenTo(this.collection,"selection:finished",t)},e.prototype.getSelectedPhotos=function(){var t,e,o,r,i;for(r=this.collection.models,i=[],e=0,o=r.length;o>e;e++)t=r[e],t.get("selected")&&i.push(t);return i},e.prototype.onFormChange=function(){return this.saveModels(!1)},e}(App.Organizer.Views.EditWidget),e.ContributorAgreementOverlay=function(t){function e(t){this.behaviors={HasButtons:{"@ui.agree":"onClickAgree"}},t.modal&&(this.modal=!0,this.behaviors.ModalDialog={maxWidth:5e3,padding:100}),e.__super__.constructor.call(this)}return n(e,t),e.prototype.template="contributor_agreement_overlay",e.prototype.className="contributor_agreement_overlay",e.prototype.ui={agree:".button.agree",no:"a.no",checkbox:".checkbox_input"},e.prototype.events={"click @ui.no":"onClickNo","change @ui.checkbox":"onCheckChange"},e.showAgreement=function(t){var o;return null==t&&(t={}),null==t.modal&&(t.modal=0===$(".main_region").length),o=new e(t),o.modal?o.showModal():$(".main_region").append(o.render().el),o.getPromise()},e.prototype.getPromise=function(){return this.dfd=$.Deferred()},e.prototype.onCheckChange=function(){return this.ui.agree.toggleClass("disabled",!this.ui.checkbox[0].checked)},e.prototype.onBeforeDestroyModal=function(){return this.dfd.reject()},e.prototype.onClickAgree=function(){return this.dfd.resolve(),this.modal?this.destroyModal():this.destroy()},e.prototype.onClickNo=function(){return this.dfd.reject(),this.modal?this.destroyModal():this.destroy()},e}(Marionette.ItemView)}.call(this),function(){null==window.PxConfig&&(window.PxConfig={})}.call(this),function(){PxConfig.endpoints={main_500px_url:"https://500px.com",api_url:"https://api.500px.com/v1",upload_url:"https://upload.500px.com/v1",media_service_upload_url:"https://media.500px.com/upload",media_service_user_avatar_upload_url:"https://media.500px.com/upload/user/avatar",media_service_user_cover_upload_url:"https://media.500px.com/upload/user/cover",stats_url:"https://stats.500px.com",cookie_domain:".500px.com",pcdn_http_url:"https://ppcdn.500px.org",pcdn_https_url:"https://ppcdn.500px.org",prime_url:"https://marketplace.500px.com",new_era_url:"https://www.500pxart.com",resizer_url:"https://prcdn.500px.org",web_bff:"https://webapi.500px.com",resizedUrl:function(t,e,o){return null==o&&(o=e),""+this.resizer_url+"/photo/"+t+"/"+e+"/"+o}}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1};null==window.PxApp&&(window.PxApp={}),window.PxApp.api=function(){function o(){this.complete=t(this.complete,this),this.error=t(this.error,this),this.success=t(this.success,this)}return o.url=PxConfig.endpoints.api_url,o.upload_url=PxConfig.endpoints.upload_url,o.prefixed_url=function(t,e){return null==e&&(e=o.url),t.match(/^https?:\/\//)?t:""+e+t},o.use_jsonp=_.once(function(){return!("withCredentials"in new XMLHttpRequest)}),o.sync=function(t,e,o){var r,i,n,s,a,l,p;if(null==o&&(o={}),s={create:"POST",update:"PUT","delete":"DELETE",read:"GET",patch:"PUT"},o.url?(a=o.url,delete o.url):a=_.isFunction(e.url)?e.url():e.url,PxApp.api.use_jsonp()?(i=-1!==(n=a.indexOf("?")),a=i?""+a.slice(0,n)+".jsonp"+a.slice(n):""+a+".jsonp",l={url:""+PxApp.api.prefixed_url(a),type:"GET",dataType:"jsonp"},l.data={_method:s[t].toLowerCase()},p=o.success,r=o.error,l.success=function(t,i,n){var s,a;return s=299>(a=t.status)&&a>199,s?(_.isFunction(p)&&p.apply(this,[e,t,o]),e.trigger("sync",e,t,o)):(401===t.status&&PxApp.api.handle_unauthorized_access(),_.isFunction(r)?r.call(this,n,t.status,t):void 0)},delete o.success,delete o.error):(l={url:""+PxApp.api.prefixed_url(a),type:s[t],dataType:"json",xhrFields:{withCredentials:!0}},l.data={},p=o.success,l.success=function(t){return _.isFunction(p)&&p.apply(this,[e,t,o]),e.trigger("sync",e,t,o)},delete o.success,r=o.error,l.error=function(t){var e,o;if(4===t.readyState&&401===t.status&&PxApp.api.handle_unauthorized_access(),_.isFunction(r)){e=t.statusText;try{o=$.parseJSON(t.responseText),e=o}catch(i){}return r.call(this,t,t.status,e)}},delete o.error),e&&!o.data)switch(t){case"create":case"update":_.isFunction(e.saveable_attributes)?_.extend(l.data,e.saveable_attributes()):_.extend(l.data,e.toJSON());break;case"patch":_.extend(l.data,o.attrs)}return l.data.authenticity_token=PxApp.csrf_token,o.data&&(_.extend(l.data,o.data),delete o.data),_.extend(l,o),$.ajax(l)},o.prototype.to_promise=function(){return this.dfd=$.Deferred(),this.success(function(){var t;return(t=this.dfd).resolve.apply(t,arguments)}),this.error(function(){var t;return(t=this.dfd).reject.apply(t,arguments)}),this.dfd.promise()},o.request=function(t,r,i,n){var s,a,l;return null==i&&(i={}),null==n&&(n={}),"undefined"!=typeof window.FormData&&i instanceof window.FormData?i.append("authenticity_token",PxApp.csrf_token):i.authenticity_token=PxApp.csrf_token,n.api_url?(s=n.api_url,delete n.api_url):s=PxApp.api.url,l=new PxApp.api,PxApp.api.use_jsonp()?(r=e.call(r,"?")>=0?r.replace("?",".jsonp?"):""+r+".jsonp",i._method=t.toLowerCase(),a={type:"GET",dataType:"jsonp",success:function(t,e,r){var i,n;return o.xhr=null,l.aborted?void 0:void 0!==t.status&&200!==t.status?(401===t.status&&PxApp.api.handle_unauthorized_access(),r.responseText=JSON.stringify(t),"function"==typeof l.on_error&&l.on_error(r,"error",t.status),null!=(i=l.on_complete)?i.call(o,r,"error"):void 0):("function"==typeof l.on_success&&l.on_success.apply(l,arguments),null!=(n=l.on_complete)?n.call(o,r,"success"):void 0)}}):a={type:t,dataType:"json",xhrFields:{withCredentials:!0},success:function(t,e,r){var i;if(!l.aborted)return"function"==typeof l.on_success&&l.on_success.apply(l,arguments),null!=(i=l.on_complete)?i.call(o,r,"success"):void 0}},a.url=PxApp.api.prefixed_url(r,s),a.data=i,a.error=function(t,e){var r;if("abort"!==e)return 4===t.readyState&&401===t.status&&PxApp.api.handle_unauthorized_access(),"function"==typeof l.on_error&&l.on_error.apply(l,arguments),null!=(r=l.on_complete)?r.call(o,t,"error"):void 0},_.extend(a,n),l.xhr=$.ajax(a),l},o.bulk_request=function(t,e,o,r){var i,n,s=this;return null==o&&(o={}),null==r&&(r={}),"put"===t&&null==o._method&&(o._method="put"),n=$.Deferred(),i=this.request.apply(this,arguments),i.success(function(e,o,i){var a,l;return 200===i.status?n.resolve.apply(n,arguments):202===i.status?(a=e.photos.location.replace(/^\/v\d+\//,"/"),s.bulk_request_poll(a,t,null!=(l=r.interval)?l:1e3,n)):void 0}),i.error(function(){return n.reject.apply(n,arguments)}),n.promise()},o.bulk_request_poll=function(t,e,o,r){var i,n;return i=null,n={},"put"===e&&(n._method=e),function(o){return o=setInterval(function(){var i;return i=PxApp.api.request(e,t,n),i.error(function(){return clearInterval(o),r.reject()}),i.success(function(t){var e;if(null!=(e=t.photos)?!e.progress:!0)return clearInterval(o),r.resolve(t)})},1e3)}(i)},o["delete"]=function(t,e){return null==e&&(e={}),o.request("DELETE",t,e)},o.post=function(t,e,r){return null==e&&(e={}),null==r&&(r={}),o.request("POST",t,e,r)},o.get=function(t,e){return null==e&&(e={}),o.request("GET",t,e)},o.put=function(t,e){return null==e&&(e={}),o.request("PUT",t,e)},o.handle_unauthorized_access=function(){var t,e;try{if(e=new Date,null==sessionStorage.last401ReloadTimestamp||(e-new Date(sessionStorage.last401ReloadTimestamp))/1e3>=30)return sessionStorage.last401ReloadTimestamp=e.toISOString(),window.location.reload()}catch(o){t=o}},o.prototype.success=function(t){return this.on_success=t,this},o.prototype.error=function(t){return this.on_error=t,this},o.prototype.complete=function(t){return this.on_complete=t,this},o}.call(this)}.call(this),function(){var t,e,o,r=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,n=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};t=null!=(e=null!=(o="undefined"!=typeof App&&null!==App?App.module("Lib"):void 0)?o:PxApp)?e:window,t.PhotoUpload=function(t){function e(t){var e=this;this.file=t,this.updateProgress=r(this.updateProgress,this),this.uploadFile=r(this.uploadFile,this),this.promise=$.Deferred(),this.api=PxApp.api.post("/photos"),this.api.success(function(o){var r;return r=o.upload_key,e.photo=new App.Groups.Models.PhotoFileReader(o.photo,{file:t,uploader:e}),e.photo.on("photo:file:read",function(){return e.trigger("photo:created",e)}),e.uploadFile(t,r)})}return n(e,t),e.prototype.photo=null,e.prototype.api=null,e.prototype.endpoint=function(){return PxConfig.endpoints.media_service_upload_url},e.prototype.uploadFile=function(t,e){var o,r,i=this;return o=new FormData,o.append("upload_key",e),o.append("photo_id",this.photo.get("id")),o.append("file",t),r=_.isFunction(this.endpoint)?this.endpoint.call():this.endpoint,r+="?"+$.param({authenticity_token:PxApp.csrf_token,upload_key:e,photo_id:this.photo.get("id")}),this.api=PxApp.api.post(r,o,{api_url:PxApp.api.upload_url,processData:!1,contentType:!1,cache:!1,xhr:function(){var t;return t=$.ajaxSettings.xhr(),t.upload.addEventListener("progress",i.updateProgress),t}}),this.api.error(function(t){var e,o;return i.trigger("upload:progress",0),4===t.readyState?(e=JSON.parse(t.responseText),o="server_error",void 0!==e.error_key&&(o=e.error_key)):o="connection_error",i.promise.reject(),i.trigger("upload:error",o)}),this.api.success(function(){return i.promise.resolve(),i.trigger("upload:progress",100),i.trigger("upload:success",100)}),this.api},e.prototype.updateProgress=function(t){var e;return e=t.lengthComputable?t.loaded/t.total*100:50,this.trigger("upload:progress",e)},e}(Marionette.Module)}.call(this),function(){var t,e,o,r,i={}.hasOwnProperty,n=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};e=App.module("Uploader.Views"),e.FileSelectorView=function(e){function r(){return o=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.template="file_selector",r.prototype.className="file_selector",r.prototype.regions={footerRegion:".footer"},r.prototype.events={"click .source":"onClickSource"},r.prototype.onRender=function(){return this.footerRegion.show(new t)},r.prototype.onClickSource=function(t){var e,o,r,i=this;return r=$(t.currentTarget).data("open-to"),e={mimetypes:["image/jpg","image/jpeg"],container:"window",services:["DROPBOX","FLICKR","FACEBOOK","GOOGLE_DRIVE","GMAIL","INSTAGRAM","PICASA","BOX","SKYDRIVE","CLOUDDRIVE"],openTo:r},o={category:"Upload Page",action:"Import button clicked"},null!=r&&(o.label=r.toLowerCase().replace(/(?:^|\s)\w/g,function(t){return t.toUpperCase()})),PxApp.GA.event(o),filepicker.setKey($(".external_sources").data("client-id")),filepicker.pickMultiple(e,function(t){return i.trigger("filepicker_files_selected",t)})},r}(Marionette.LayoutView),t=function(t){function e(){return r=e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.template="grid_footer",e.prototype.onRender=function(){return this.$("p").i18n({count:App.currentUser.get("upload_limit"),html:!0})},e}(Marionette.LayoutView)}.call(this),function(){var t,e,o,r,i,n={}.hasOwnProperty,s=function(t,e){function o(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},a=function(t,e){return function(){return t.apply(e,arguments)}},l=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1};r=null!=(i="undefined"!=typeof App&&null!==App?App.module("Views"):void 0)?i:window,t=$(window),e=3,o=function(t){function o(){null==this.modelEvents&&(this.modelEvents={}),_.extend(this.modelEvents,{"change:selected":"changeSelected","change:images":"onRender","change:name":"onRender","change:selected":"onRender"}),null==this.events&&(this.events={}),_.extend(this.events,{click:"clickPhoto"}),o.__super__.constructor.apply(this,arguments)}return s(o,t),o.prototype.template="squared_photo_grid_item",o.prototype.tagName="li",o.prototype.className="squared_photo_grid_item",o.prototype.clickPhoto=function(t){return t.stopPropagation(),this.throttledPhotoSelection(t)},o.prototype._selectPhoto=function(t){var e;return null!=(e=this.model.collection)?e.trigger("select",this.model,t):void 0},o.prototype._getPhotoModel=function(){throw new Error("Missing implementation")},o.prototype.changeSelected=function(){return this.$el.toggleClass("ui-selected",!!this.model.get("selected"))},o.prototype.serializeData=function(){var t,e,o,r,i;for(e=this._getPhotoModel().toJSON(),i=this._getPhotoModel().get("images"),o=0,r=i.length;r>o;o++)t=i[o],3===t.size&&"jpeg"===t.format&&(e.image_url=t.https_url);return e},o.prototype.onRender=function(){var t,o,r,i,n,s,a,l,p,u=this;for(o=null!=(a=_.result(this,"defaultImageSize"))?a:e,r=new Image,l=this._getPhotoModel().get("images"),n=0,s=l.length;s>n;n++)t=l[n],t.size===o&&"jpeg"===t.format&&(i=t.https_url);return null==i&&(i=null!=(p=this._getPhotoModel().get("images")[0])?p.https_url:void 0),r.alt="name",r.onload=function(){var t;return u.changeSelected(),t=r.height>r.width,u.$("img").attr("src",r.src).toggleClass("portrait",t).toggleClass("landscape",!t),u.resizeOverlay(),u.$el.addClass("loaded")},r.onerror=function(){return u.changeSelected(),u.$el.find("img").attr("src","//assetcdn.500px.org/assets/organizer/converting_drag_handle-dcc204ea777013515f64249851e662ec.png"),u.$el.addClass("loaded")},null!=i&&(r.src=i),this.$el.data("model",this.model),null!=this.throttledPhotoSelection?this.throttledPhotoSelection:this.throttledPhotoSelection=_.throttle(this._selectPhoto,300,{trailing:!1})},o.prototype.resizeOverlay=function(){var t,e,o;return t=this.$("img"),o=2*Math.round((t.width()-1)/2),e=2*Math.round((t.height()-1)/2),0!==t.width()&&0!==t.height()?this.$(".overlay").width(o).height(e):void 0},o}(Marionette.ItemView),r.SquaredPhotoGrid=function(e){function r(t){this.onMouseClickLockedForm=a(this.onMouseClickLockedForm,this),this.onMouseDownUnlockedForm=a(this.onMouseDownUnlockedForm,this),null==this.behaviors&&(this.behaviors={}),null!=t.collection.fetching&&(this.behaviors.InfiniteScroll={container:function(){return this.$el}}),r.__super__.constructor.apply(this,arguments)}return s(r,e),r.GridItem=o,r.prototype.config={thumbMargin:20,minWidth:140},r.prototype.className="squared_photo_grid",r.prototype.tagName="ul",r.prototype.childView=o,r.prototype.childViewContainer="ul.photos",r.prototype.collectionEvents=function(){return{select:"toggleModelSelection",selectAll:"selectAll","change:selected":"onModelSelected"}},r.prototype._isClickOnScrollbar=function(t){var e,o,r;return o=null!=(r=t.offsetX)?r:t.pageX-this.$el.offset().left,e=this.$el.outerWidth()-o,null==this._scrollbarWidth&&(this._scrollbarWidth=App.Views.Common.Helpers.measureScrollBarWidth()),e<=this._scrollbarWidth},r.prototype.enable=function(){return this.$el.removeClass("disabled")},r.prototype.disable=function(){return this.$el.addClass("disabled")},r.prototype.onMouseDownUnlockedForm=function(t){var e,o,r;if(!this._isClickOnScrollbar(t)&&!t.metaKey&&!t.ctrlKey)return e=$(t.target),e.is("ul.squared_photo_grid")||e.is(".groupDivider")||e.is("h3.fixedheader")?("function"==typeof(o=this.collection).startSelection&&o.startSelection(),this._clearSelection(),"function"==typeof(r=this.collection).finishSelection?r.finishSelection():void 0):void 0},r.prototype.onMouseClickLockedForm=function(t){var e,o,r;if(!this._isClickOnScrollbar(t)&&(e=$(t.target),e.is("ul.squared_photo_grid")||e.is(".groupDivider")||e.is("h3.fixedheader")))return(e.is("ul.squared_photo_grid")||e.is(".groupDivider")||e.is("h3.fixedheader"))&&App.router.lockNavigationConfirmMessage&&confirm(App.router.lockNavigationConfirmMessage)?("function"==typeof(o=this.collection).startSelection&&o.startSelection(),this._clearSelection(),"function"==typeof(r=this.collection).finishSelection&&r.finishSelection(),App.router.unlockNavigation()):void 0},r.prototype.initialize=function(t){var e,o,r,i,n=this;return null==t&&(t={}),this._resizeDebounced=_.debounce(function(){return n.resize()}),null!=t.maxFiles&&null==t.multiselect&&(t.multiselect=1!==t.maxFiles),this.multiselect=null!=(e=t.multiselect)?e:!0,this.autoReset=null!=(o=t.autoReset)?o:!1,this.multiselect?this.maxFiles=null!=(r=t.maxFiles)?r:5:(this.autoReset=!0,this.maxFiles=1),this.groupBy=null!=(i=t.groupBy)?i:null,this.$el.on("mousedown",this.onMouseDownUnlockedForm),App.vent.on("unlock-navigation",function(){return n.$el.off("click",n.onMouseClickLockedForm),n.$el.on("mousedown",n.onMouseDownUnlockedForm)}),App.vent.on("lock-navigation",function(){return n.$el.on("click",n.onMouseClickLockedForm),n.$el.off("mousedown",n.onMouseDownUnlockedForm)})},r.prototype.onBeforeAddChild=function(t){var e,o,r;return this._thumbWidth||this._computeThumbWidth(),null!=this.groupBy&&(o=this.groupBy(t.model),e=t.model.collection,r=e.indexOf(t.model),0===r||this.groupBy(e.at(r-1))!==o)?this.$el.append(this.buildSeperatorEl(o)):void 0},r.prototype.buildSeperatorEl=function(){throw new Error("Implementation missing")},r.prototype._clearSelection=function(t){var e,o,r,i,n,s,a,p,u,h;if(null==t&&(t=null),t instanceof Array){for(s=this.collection.models,u=[],o=0,i=s.length;i>o;o++)e=s[o],!e.get("selected")||(a=e.id,l.call(t,a)>=0)||u.push(e.set("selected",!1));return u}for(p=this.collection.models,h=[],r=0,n=p.length;n>r;r++)e=p[r],e.get("selected")&&e.id!==t&&h.push(e.set("selected",!1));return h},r.prototype.selectAll=function(){var t,e,o,r,i,n;if(this.maxFiles<=0||this.collection.models.length<=this.maxFiles){for("function"==typeof(e=this.collection).startSelection&&e.startSelection(),n=this.collection.models,r=0,i=n.length;i>r;r++)t=n[r],t.get("selected")||t.set("selected",!0);return"function"==typeof(o=this.collection).finishSelection?o.finishSelection():void 0}},r.prototype.toggleModelSelection=function(t,e){var o,r;return"function"==typeof(o=this.collection).startSelection&&o.startSelection(),this.multiselect?this.autoReset?t.get("selected")?(null!=e?e.metaKey:void 0)||(null!=e?e.ctrlKey:void 0)?t.set("selected",!1):this._clearSelection(t.id):((null!=e?e.metaKey:void 0)||(null!=e?e.ctrlKey:void 0)||this._clearSelection(),this.maxFiles<=0||this._getSelected().length<this.maxFiles?t.set("selected",!0):this.collection.trigger("maximum_selection")):t.get("selected")?t.set("selected",!1):this.maxFiles<=0||this._getSelected().length<this.maxFiles?t.set("selected",!0):this.collection.trigger("maximum_selection"):(this._clearSelection(t.id),t.set("selected",!t.get("selected"))),"function"==typeof(r=this.collection).finishSelection?r.finishSelection():void 0},r.prototype.onModelSelected=function(t,e){var o,r;return e&&!this.multiselect&&("function"==typeof(o=this.collection).startSelection&&o.startSelection(),this._clearSelection(t.id),"function"==typeof(r=this.collection).finishSelection&&r.finishSelection()),this.collection.trigger("selection",this._getSelected())},r.prototype.onShow=function(){return t.on("resize",this._resizeDebounced)},r.prototype.onDestroy=function(){return t.off("resize",this._resizeDebounced)},r.prototype.resize=function(){return this.collection.length?(this._computeThumbWidth(),this._scalePhotos()):void 0},r.prototype.addChild=function(){var t;return t=r.__super__.addChild.apply(this,arguments),t.$el.width(this._thumbWidth).height(this._thumbWidth),t},r.prototype._getDefaultGridWidth=function(){},r.prototype._getSelected=function(){var t,e,o,r,i;for(r=this.collection.models,i=[],e=0,o=r.length;o>e;e++)t=r[e],t.get("selected")&&i.push(t);return i},r.prototype._computeThumbWidth=function(){var t,e;return e=(this.$el.width()||this._getDefaultGridWidth())-this._getScrollbarWidth(),e-=this.config.thumbMargin,t=Math.floor(e/(this.config.minWidth+this.config.thumbMargin)),this._thumbWidth=Math.floor(e/t)-this.config.thumbMargin},r.prototype._scalePhotos=function(){var t=this;return this.children.each(function(e){return e.$el.width(t._thumbWidth).height(t._thumbWidth),e.resizeOverlay()})},r.prototype.thumbWidth=function(){return this._thumbWidth},r.prototype._getScrollbarWidth=function(){var t,e,o,r;return null!=this._scrollbarWidth?this._scrollbarWidth:(e=document.createElement("div"),e.style.visibility="hidden",e.style.width="100px",document.body.appendChild(e),o=e.offsetWidth,e.style.overflow="scroll",t=document.createElement("div"),t.style.width="100%",e.appendChild(t),r=t.offsetWidth,e.parentNode.removeChild(e),this._scrollbarWidth=o-r)},r}(Marionette.CollectionView)}.call(this),function(){var t,e,o=function(t,e){return function(){return t.apply(e,arguments)}},r={}.hasOwnProperty,i=function(t,e){function o(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},n=[].slice;App.Behaviors.SelectableGrid=function(e){function r(){return this._onKeyDown=o(this._onKeyDown,this),t=r.__super__.constructor.apply(this,arguments)}return i(r,e),r.prototype.onShow=function(){return this._bindSelectable(),$(document).on("keydown",this._onKeyDown)},r.prototype.onDestroy=function(){return $(document).off("keydown",this._onKeyDown)},r.prototype._bindSelectable=function(){var t=this;return this.selectable=this.view.$el.selectableScroll({filter:".squared_photo_grid_item",delay:100,stop:function(){return t._onLassoSelected()}})},r.prototype._onKeyDown=function(t){var e;if("TEXTAREA"!==t.target.tagName&&("INPUT"!==t.target.tagName||"text"!==(e=$(t.target).prop("type"))&&"password"!==e)&&(t.metaKey||t.ctrlKey)&&65===t.keyCode){if(t.preventDefault(),App.router.lockNavigationConfirmMessage){if(!confirm(App.router.lockNavigationConfirmMessage))return;App.router.unlockNavigation()}return this.view.collection.trigger("selectAll")}},r.prototype._onLassoSelected=function(){if(App.router.lockNavigationConfirmMessage){if(!confirm(App.router.lockNavigationConfirmMessage))return this._restoreUISelection(),void 0;App.router.unlockNavigation()}return this.view.trigger("selectable_grid:selection")},r.prototype._restoreUISelection=function(){return this.view.trigger("selectable_grid:restore_selection")},r}(Marionette.Behavior),App.Behaviors.DragAndDropGrid=function(t){function r(){return this._onKeyDown=o(this._onKeyDown,this),e=r.__super__.constructor.apply(this,arguments)}return i(r,t),r.prototype.initialize=function(t){return this.sortable=t.sortable,this.onSort=t.onSort},r.prototype.onShow=function(){var t=this;return this.listenTo(this.view,"resize",function(){var e;return null!=(e=t.$sortable)?e.sortable("option","cursorAt",t._handleCursorPos()):void 0}),_.result(this.view,this.sortable)&&this._bindSortable(),$(document).on("keydown",this._onKeyDown)},r.prototype.onDestroy=function(){return $(document).off("keydown",this._onKeyDown)},r.prototype._onKeyDown=function(t){var e,o;if("TEXTAREA"!==t.target.tagName&&("INPUT"!==t.target.tagName||"text"!==(e=$(t.target).prop("type"))&&"password"!==e))return 27===t.keyCode?(this.view._cancelSort=!0,null!=(o=this.$sortable)?o.sortable("cancel"):void 0):void 0},r.prototype.onAddChild=function(t){var e=this;if(!this.view.$el.hasClass("ui-sortable"))return t.$el.draggable({appendTo:$("body"),delay:100,helper:function(t){return e._buildDragHandle(t)},cursorAt:this._handleCursorPos()})},r.prototype._bindSortable=function(){var t=this;return null!=this.$sortable?this.$sortable:this.$sortable=this.view.$el.sortable({placeholder:"placeholder",delay:100,tolerance:"pointer",appendTo:"body",helper:function(){var e;return e=1<=arguments.length?n.call(arguments,0):[],t._buildSortHandle.apply(t,e)},cursorAt:this._handleCursorPos(),scroll:!0,start:function(e,o){return _.delay(function(){var e,r;return t.view._cancelSort=!1,$(o.item).hasClass("ui-selected")?(t._$thumbsBeingSorted=t.$(".squared_photo_grid_item.ui-selected"),t._$thumbsBeingSorted.addClass("sorting").hide()):(t.$(".squared_photo_grid_item.ui-seleted").removeClass("ui-selectd"),$(o.item).addClass("selected"),t._$thumbsBeingSorted=$(o.item)),t._orderBefore=function(){var t,o,r,i;for(r=this.$(".squared_photo_grid_item"),i=[],t=0,o=r.length;o>t;t++)e=r[t],i.push($(e).data("model").id);return i}.call(t),r=t.view.thumbWidth(),r?t.$(".placeholder").width(r).height(r):void 0})},stop:function(e,o){var r;return t.view._cancelSort?(null!=(r=t.$sortable)&&r.sortable("cancel"),t.$(".squared_photo_grid_item.ui-selected.sorting").removeClass("sorting").show()):(t.$(".squared_photo_grid_item.ui-selected.sorting").show(),t.view[t.onSort](o,t._orderBefore,t._$thumbsBeingSorted)),t._$thumbsBeingSorted=null,t._orderBefore=null
}})},r.prototype._buildDragHandle=function(t,e){var o;return o=this._buildPhotoStackHandle(t,e),o.addClass("draggable"),o},r.prototype._handleCursorPos=function(){return{top:20,left:20}},r.prototype._buildSortHandle=function(t,e){var o;return o=this._buildPhotoStackHandle(t,e),o.addClass("sortable"),o},r.prototype._buildPhotoStackHandle=function(t){var e,o,r,i,n,s,a,l,p,u,h;if(i=$(t.target).closest("li.squared_photo_grid_item"),i.hasClass("ui-selected"))a=this.$(".ui-selected img");else{if(App.router.lockNavigationConfirmMessage){if(!confirm(App.router.lockNavigationConfirmMessage))return;App.router.unlockNavigation()}"function"==typeof(l=this.view.collection).startSelection&&l.startSelection(),this.view._clearSelection(),i.data("model").select(),"function"==typeof(p=this.view.collection).finishSelection&&p.finishSelection(),a=i.children("img")}for(o=$('<li class="ui-draggable-sortable-images-stack"/>'),e=$('<div class="photo-stack-wrapper" />'),o.append(e),n=u=0,h=a.length;h>u&&(s=a[n],3!==n);n=++u)r=$(s).clone().addClass("img-"+(n+1)),e.append(r);return a.length>1&&(o.addClass("multiple"),e.append("<span>"+a.length+"</span>")),o.appendTo(this.$el),o},r}(Marionette.Behavior)}.call(this),function(){var t,e,o,r,i,n,s,a,l={}.hasOwnProperty,p=function(t,e){function o(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};r=App.module("Uploader.Views"),o=function(t){function e(){return i=e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.className="squared_photo_grid_item uploader_photo_grid_item uploaded_file",e.prototype.template="uploader_photo_grid_item",e.prototype.selectionMode="pick",e.prototype.templateHelpers=function(){return{images:this.model.uploadedPhoto.get("images")}},e.prototype.behaviors={HasButtons:{"a.remove":"clickRemove"},HasProgressBar:!0},e.prototype.ui={nameField:".name input"},e.prototype.events={"input @ui.nameField":"onTextChange"},e.prototype.modelEvents={"change:upload_status":"changeStatus"},e.prototype.initialize=function(){return e.__super__.initialize.call(this),this.listenTo(this.model,"change:name",this.onNameChange)},e.prototype.onNameChange=function(){return this.ui.nameField.is(":focus")?void 0:this.ui.nameField.val(this.model.get("name"))},e.prototype.onTextChange=function(){return this.model.set("name",this.ui.nameField.val())},e.prototype._getPhotoModel=function(){return this.model},e.prototype.changeSelected=function(){return e.__super__.changeSelected.call(this),!this.model.get("selected")&&this.ui.nameField.is(":focus")?this.ui.nameField.blur():void 0},e.prototype.clickPhoto=function(t){return"error"!==this.model.get("upload_status")&&"a"!==t.target.tagName.toLowerCase()?e.__super__.clickPhoto.call(this,t):void 0},e.prototype.clickRemove=function(){var t=this;return this.$el.fadeOut("fast",function(){return t.model.abort(),t.model.collection.remove(t.model)})},e.prototype.changeStatus=function(t,e){return"success"===e?this.$el.addClass("uploaded"):"error"===e?(this.$el.addClass("error"),this.$el.find("input").prop("disabled",!0),this.model.set("selected",!1)):void 0},e}(App.Views.SquaredPhotoGrid.GridItem),t=function(t){function e(){return n=e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.tagName="li",e.prototype.className="uploader_photo_grid_item add_more add_more_grid_item",e.prototype.template="add_more_grid_item",e}(Marionette.LayoutView),e=function(t){function e(){return s=e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.tagName="li",e.prototype.className="footer",e.prototype.template="grid_footer",e.prototype.onRender=function(){return this.$("p").i18n({count:App.currentUser.get("upload_limit"),html:!0})},e}(Marionette.LayoutView),r.PhotoGrid=function(r){function i(){return a=i.__super__.constructor.apply(this,arguments)}return p(i,r),i.prototype.className="squared_photo_grid uploader_photo_grid",i.prototype.childView=o,i.prototype.behaviors={SelectableGrid:!0},i.prototype.config={thumbMargin:16,minWidth:204},i.prototype.initialize=function(){var o=this;return i.__super__.initialize.call(this,{maxFiles:-1,multiselect:!0,autoReset:!0}),this.on("selectable_grid:selection",function(){var t,e,r,i,n,s,a,l;for(a=o.collection.models,r=0,n=a.length;n>r;r++)e=a[r],e.set("selected",!1);for(l=o.$(".ui-selected"),i=0,s=l.length;s>i;i++)t=l[i],$(t).data("model")&&$(t).data("model").set("selected",!0);return o.collection.finishSelection()}),this.addMore=new t,this.addMore.render(),this.footer=new e,this.footer.render(),this.$clearEl=$('<li class="clear"></li>')},i.prototype.resize=function(){return i.__super__.resize.call(this),this.addMore.$el.width(this._thumbWidth).height(this._thumbWidth)},i.prototype.onRender=function(){var t=this;return _.defer(function(){return t.resize()}),this._addTrailingElements()},i.prototype.onAddChild=function(){return this._addTrailingElements()},i.prototype._addTrailingElements=function(){return this.addMore.$el.detach(),this.addMore.$el.appendTo(this.$el),this.$clearEl.detach(),this.$clearEl.appendTo(this.$el),this.footer.$el.detach(),this.footer.$el.appendTo(this.$el)},i}(App.Views.SquaredPhotoGrid)}.call(this),function(){var t,e,o,r,i={}.hasOwnProperty,n=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};e=App.module("Uploader.Views"),t=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.template="sets_widget_item",e.prototype.tagName="li",e.prototype.triggers={click:"clicked"},e.prototype.toggleSelected=function(){return this.selected=this.partial?!0:!this.selected,this.partial=!1,this.$(".completed_checkmark").toggleClass("checked",this.selected),this.$(".completed_checkmark").removeClass("partial_checked")},e.prototype.select=function(){return this.selected=!0,this.partial=!1,this.$(".completed_checkmark").addClass("checked")},e.prototype.selectPartial=function(){return this.selected=!0,this.partial=!0,this.$(".completed_checkmark").addClass("partial_checked")},e}(Marionette.ItemView),e.SetsWidget=function(e){function o(){return r=o.__super__.constructor.apply(this,arguments)}return n(o,e),o.prototype.childView=t,o.prototype.childViewContainer="ul",o.prototype.template="sets_widget_composite",o.prototype.ui={createInput:"input",done:".done"},o.prototype.events={"keyup @ui.createInput":"onCreateKeyup","blur @ui.createInput":"stopCreatingSet","mousedown @ui.done":"onClickDone"},o.prototype.initialize=function(t){return this.photoModel=t.photoModel,this.qTipTarget=t.qTipTarget,this.kind=t.kind},o.prototype.refresh=function(){var t,e,o;o=this.photoModel.editableAttributes.sets;for(t in o)e=o[t],this.children.each(function(o){return o.model.id.toString()===t?e.same?o.select():o.selectPartial():void 0});return!0},o.prototype.onRender=function(){return this.ui.done.i18n("done"),this.ui.createInput.attr("placeholder",this.ui.createInput.i18n(this.kind,{"return":!0}))},o.prototype.getSelectedSets=function(){return this.children.filter(function(t){return t.selected}).map(function(t){return t.model})},o.prototype.selectSetById=function(t){var e=this;return this.children.each(function(o){return o.model.id===t?(o.select(),e._updateSetSelection(t,!0)):void 0})},o.prototype.onClickDone=function(){return this.creatingSet?this._createSet():this.qTipTarget.qtip().hide()},o.prototype.onChildviewClicked=function(t,e){return t.toggleSelected(),this._updateSetSelection(e.model.id,t.selected)},o.prototype.onCreateKeyup=function(t){return 13===t.keyCode?this._createSet():this.ui.createInput[0].value.length>0?(this.creatingSet=!0,this.ui.done.i18n("create")):this.stopCreatingSet()},o.prototype._createSet=function(){var t,e,o=this;return e=this.ui.createInput.val(),e.length>0?(this.ui.createInput.blur(),this.collection.findWhere({title:e})?alert(this.$("input").i18n("duplicate-"+this.kind,{"return":!0})):(t=new App.Uploader.Models.Set({title:e,path:App.Uploader.Models.Set.generatePath(e),kind:this.kind}),t.save(null,{success:function(t){var e;return o.collection.add(t),o.selectSetById(t.id),e=o.$(".sets_collection")[0],e.scrollTop=e.scrollHeight,o.qTipTarget.qtip("reposition")}}))):void 0},o.prototype.stopCreatingSet=function(){return this.ui.createInput[0].value="",this.creatingSet=!1,this.ui.done.i18n("done")},o.prototype._updateSetSelection=function(t,e){return e?this.photoModel.addSet(t):this.photoModel.removeSet(t),this.trigger("changed:sets",this.getSelectedSets())},o}(Marionette.CompositeView)}.call(this),function(){var t,e,o,r={}.hasOwnProperty,i=function(t,e){function o(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},n=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1};e=App.module("Collections"),t=200,e.UploadedPhotos=function(e){function r(){return o=r.__super__.constructor.apply(this,arguments)}return i(r,e),r.prototype.model=App.Models.UploadedPhoto,r.prototype.acceptedTypes=["image/jpeg"],r.prototype.initialize=function(e,o){var r,i,n=this;return this._autoActivate=null!=(r=o.autoActivate)?r:!0,null!=o.user_limit&&(this.remainingPhotos=this.userUploadLimit=o.user_limit),this.uploadLimit=null!=(i=o.upload_limit)?i:t,this.maxConcurrentUploads=7,this.on("remove",function(){return n._checkCompletion()}),this.on("change:upload_finished",function(t,e){var o;if(e===!0)return n.uploading().length<n.maxConcurrentUploads&&null!=(o=n.notStarted()[0])&&o.beginUpload(),n._checkCompletion()})},r.prototype.beginUploads=function(){var t,e,o,r,i;for(this._uploading=!0,this.uploadsFinished=!1,r=_.first(this.notStarted(),this.maxConcurrentUploads),i=[],e=0,o=r.length;o>e;e++)t=r[e],i.push(t.beginUpload());return i},r.prototype.addFiles=function(t){var e,o,r,i,s,a,l;for(this._normalizeFiles(t),t=this._limitUploads(t),r=[],e=[],s=0,a=t.length;a>s;s++)o=t[s],l=o.type,n.call(this.acceptedTypes,l)>=0?this.containsFile(o)?e.push(o):(i=new App.Models.UploadedPhoto(o,this._autoActivate),this.push(i)):r.push(o);return r.length>0&&this.trigger("invalid",r),e.length>0&&this.trigger("duplicated",e),this.length>0&&this.trigger("accepted",this.collection),this.uploadsFinished&&this.beginUploads(),null},r.prototype.notStarted=function(){return this.filter(function(t){return"not_started"===t.get("upload_status")})},r.prototype.uploading=function(){return this.filter(function(t){return"in_progress"===t.get("upload_status")})},r.prototype.successful=function(){return this.filter(function(t){return"success"===t.get("upload_status")})},r.prototype.failed=function(){return this.filter(function(t){return"error"===t.get("upload_status")})},r.prototype.containsFile=function(t){var e,o,r,i,n;for(n=this.models,r=0,i=n.length;i>r;r++)if(o=n[r],e=o.file,e.name===t.name&&e.size===t.size)return!0},r.prototype._limitUploads=function(t){var e,o;return null!=this.userUploadLimit&&t.length>this.userUploadLimit-this.length&&(o=$(t).slice(this.userUploadLimit-this.length),t=$(t).slice(0,this.userUploadLimit-this.length),this.trigger("over_user_limit",o)),t.length>this.uploadLimit-this.length&&(e=$(t).slice(this.uploadLimit-this.length),t=$(t).slice(0,this.uploadLimit-this.length),this.trigger("over_upload_limit",e)),t},r.prototype._normalizeFiles=function(t){var e,o,r,i,n,s;for(o=0,i=t.length;i>o;o++)e=t[o],null!=e.mimetype&&(e.type=e.mimetype);for(s=[],r=0,n=t.length;n>r;r++)e=t[r],null!=e.filename&&s.push(e.name=e.filename);return s},r.prototype._checkCompletion=function(){var t,e,o,r;for(r=this.models,e=0,o=r.length;o>e;e++)if(t=r[e],t.get("upload_finished")!==!0)return!1;return this.trigger("upload_complete",this.successful(),this.failed()),this.uploadsFinished=!0},r}(Backbone.Collection)}.call(this),function(){var t,e,o={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1};t=App.module("Uploader.Views"),t.GridLayout=function(t){function o(){return e=o.__super__.constructor.apply(this,arguments)}return r(o,t),o.prototype.template="uploading_grid_layout",o.prototype.className="uploading_grid_layout",o.prototype.ui={publishOverlay:".publish_overlay"},o.prototype.regions={photoGridRegion:".photo_grid_pane",editPaneRegion:".edit_pane"},o.prototype.initialize=function(t){return this.uploadingPhotos=t.collection,this.collection=new App.Uploader.Collections.Photos(this.uploadingPhotos,t.uploadDestination,t.defaultTag),this.listenTo(App.vent,"upload:failed",function(t){var e,o,r,n,s,a;if(t instanceof App.Models.UploadedRelease){for(n=this.collection.models,a=[],o=0,r=n.length;r>o;o++)e=n[o],s=t.get("hash"),i.call(e.get("releases"),s)>=0?a.push(e.set("releases",_.without(e.get("releases"),t.get("hash")))):a.push(void 0);return a}})},o.prototype.onShow=function(){var t=this;return this.editPane=new App.Uploader.Views.EditPane({collection:this.collection}),this.photoGrid=new App.Uploader.Views.PhotoGrid({collection:this.collection}),this.listenTo(App.vent,"uploader:publish",function(){return this.showPublishOverlay()}),this.listenTo(App.vent,"uploader:publishFailed",function(){return this.hidePublishOverlay()}),this.photoGridRegion.show(this.photoGrid),this.editPaneRegion.show(this.editPane),_.delay(function(){return t.$el.addClass("in")}),this.collection.parseExif().done(function(){return t.collection.loadThumbnails(),t.uploadingPhotos.beginUploads(),t.photoGridRegion.currentView.on("add:child",function(t){return t.model.loadExifAndThumbnail()})})},o.prototype.showPublishOverlay=function(){return this.photoGrid.disable(),this.ui.publishOverlay.addClass("visible"),this.ui.publishOverlay.find("h2").i18n("uploading"),this.listenTo(this.collection,"change:upload_progress",this.onUploadProgress),this.progressBar=new ProgressBar.Circle(this.$(".publish_overlay .progress_circle")[0],{color:"#0099e5",trailColor:"#66ccff",strokeWidth:9,trailWidth:10,duration:0,from:{width:9},to:{width:10},step:function(t,e){return e.path.setAttribute("stroke-width",t.width)}}),this.onUploadProgress()},o.prototype.hidePublishOverlay=function(){return this.photoGrid.enable(),this.ui.publishOverlay.removeClass("visible")},o.prototype.onUploadProgress=function(){var t;return t=0,this.collection.each(function(e){return null!=e.get("upload_progress")?t+=e.get("upload_progress"):void 0}),t/=100*this.collection.length,1===t&&this.ui.publishOverlay.find("h2").i18n("publishing"),this.progressBar.animate(.9*t)},o}(Marionette.LayoutView)}.call(this),function(){var t,e,o=function(t,e){return function(){return t.apply(e,arguments)}},r={}.hasOwnProperty,i=function(t,e){function o(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};t=App.module("Uploader.Views"),t.Uploader=function(t){function r(){return this.confirmClose=o(this.confirmClose,this),e=r.__super__.constructor.apply(this,arguments)}return i(r,t),r.prototype.template="uploader_layout",r.prototype.className="uploader_layout",r.prototype.behaviors={ModalDialog:{maxWidth:5e3,padding:100,closeConfirm:"confirmClose"},HasButtons:{".browse.button":"onClickBrowse","li.add_more":"onClickBrowse"},FileDropArea:{onDrop:"onFilesSelected"}},r.prototype.regions={mainRegion:".main_region"},r.prototype.ui={fileForm:"#photo_upload_form"},r.prototype.events={"change @ui.fileForm input":"onPickedFiles"},r.prototype.initialize=function(t){return this.uploadDestination=t.uploadDestination,this.defaultTag=t.defaultTag,App.Uploader.sets=new App.Uploader.Collections.Sets,App.Uploader.setsXhr=App.Uploader.sets.fetch(),App.Uploader.portfolios=new App.Uploader.Collections.Portfolios,App.Uploader.portfoliosXhr=App.Uploader.portfolios.fetch()},r.prototype.onShow=function(){return this.showFileSelector(),$.fn.qtip.zindex=100100,$(window).on("beforeunload",this.confirmClose)},r.prototype.onDestroy=function(){var t;return $(window).off("beforeunload",this.confirmClose),!this.published&&(null!=(t=this.uploadedFiles)?t.length:void 0)>=1?PxApp.GA.event({category:"Uploader",action:"Photos Abandoned",value:this.uploadedFiles.length}):void 0},r.prototype.showFileSelector=function(){var t=this;return this.fileSelectorView=new App.Uploader.Views.FileSelectorView,this.listenTo(this.fileSelectorView,"filepicker_files_selected",function(e){return t.onFilesSelected(e)}),null!=this.uploadedFiles&&this.stopListening(this.uploadedFiles),this.uploadedFiles=null,App.vent.on("uploader:published",function(){var e,o;return t.published=!0,t.destroyModal(),o="/manage",null!=t.uploadDestination?(e=t.uploadDestination.get("kind"),3===e?e="portfolio":4===e&&(e="profile"),"prime"===e?o+="/all_photos":("library"!==e&&"prime"!==e&&(o+="/"+e),o+="/"+t.uploadDestination.get("path"))):o+="/public",window.location.assign(o)}),this.mainRegion.show(this.fileSelectorView)},r.prototype.onFilesSelected=function(t){return this.uploadedFiles||this._initializeUploaderGrid(),this.uploadedFiles.addFiles(t)},r.prototype.confirmClose=function(){var t;return!this.published&&(null!=(t=this.uploadedFiles)?t.length:void 0)>=1?this.$(".i18n").i18n("confirm",{count:this.uploadedFiles.length,"return":!0}):void 0},r.prototype._initializeUploaderGrid=function(){var t=this;return this.uploadedFiles=new App.Collections.UploadedPhotos(!1,{autoActivate:!1,user_limit:App.currentUser.get("upload_limit")}),this.listenTo(this.uploadedFiles,"invalid",function(e){return t._showError(e,t.$(".i18n").i18n("invalid",{"return":!0}))}),this.listenTo(this.uploadedFiles,"duplicated",function(e){return t._showError(e,t.$(".i18n").i18n("duplicated",{"return":!0}))}),this.listenTo(this.uploadedFiles,"over_user_limit",function(e){return t._showError(e,t.$(".i18n").i18n("overuserlimit",{"return":!0}))}),this.listenTo(this.uploadedFiles,"over_upload_limit",function(e){return t._showError(e,t.$(".i18n").i18n("overuploadlimit",{limit:t.uploadedFiles.uploadLimit,"return":!0}))}),this.listenToOnce(this.uploadedFiles,"accepted",function(){return t.showUploads()})},r.prototype._showError=function(t,e){var o,r;return o=function(){var e,o,i;for(i=[],e=0,o=t.length;o>e;e++)r=t[e],i.push(r.name);return i}().join("\n - "),alert(""+e+": \n - "+o)},r.prototype.showUploads=function(){var t=this;return this.listenTo(this.uploadedFiles,"remove",function(){return 0===t.uploadedFiles.length?t.showFileSelector():void 0}),this.mainRegion.show(new App.Uploader.Views.GridLayout({collection:this.uploadedFiles,uploadDestination:this.uploadDestination,defaultTag:this.defaultTag})),this.listenTo(this.uploadedFiles,"upload_complete",this.reportUploadErrors)},r.prototype.reportUploadErrors=function(t,e){var o;return e.length>0?(o=this.$(".i18n").i18n("error",{count:e.length,total_files:this.uploadedFiles.length,"return":!0}),App.Flash.error(o)):void 0},r.prototype.onPickedFiles=function(t){var e;return this.onFilesSelected(t.target.files),e=this.ui.fileForm.find("input"),e.replaceWith(e.val("").clone(!0))},r.prototype.onClickBrowse=function(){return this.ui.fileForm.find("input").click()},r}(Marionette.LayoutView)}.call(this),/*
 * qTip2 - Pretty powerful tooltips - v2.2.1
 * http://qtip2.com
 *
 * Copyright (c) 2014
 * Released under the MIT licenses
 * http://jquery.org/license
 *
 * Date: Sat Sep 6 2014 11:12 GMT+0100+0100
 * Plugins: tips modal viewport svg imagemap ie6
 * Styles: core basic css3
 */
function(t,e,o){!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):jQuery&&!jQuery.fn.qtip&&t(jQuery)}(function(r){"use strict";function i(t,e,o,i){this.id=o,this.target=t,this.tooltip=M,this.elements={target:t},this._id=V+"-"+o,this.timers={img:{}},this.options=e,this.plugins={},this.cache={event:{},target:r(),disabled:I,attr:i,onTooltip:I,lastClass:""},this.rendered=this.destroyed=this.disabled=this.waiting=this.hiddenDuringWait=this.positioning=this.triggering=I}function n(t){return t===M||"object"!==r.type(t)}function s(t){return!(r.isFunction(t)||t&&t.attr||t.length||"object"===r.type(t)&&(t.jquery||t.then))}function a(t){var e,o,i,a;return n(t)?I:(n(t.metadata)&&(t.metadata={type:t.metadata}),"content"in t&&(e=t.content,n(e)||e.jquery||e.done?e=t.content={text:o=s(e)?I:e}:o=e.text,"ajax"in e&&(i=e.ajax,a=i&&i.once!==I,delete e.ajax,e.text=function(t,e){var n=o||r(this).attr(e.options.content.attr)||"Loading...",s=r.ajax(r.extend({},i,{context:e})).then(i.success,M,i.error).then(function(t){return t&&a&&e.set("content.text",t),t},function(t,o,r){e.destroyed||0===t.status||e.set("content.text",o+": "+r)});return a?n:(e.set("content.text",n),s)}),"title"in e&&(r.isPlainObject(e.title)&&(e.button=e.title.button,e.title=e.title.text),s(e.title||I)&&(e.title=I))),"position"in t&&n(t.position)&&(t.position={my:t.position,at:t.position}),"show"in t&&n(t.show)&&(t.show=t.show.jquery?{target:t.show}:t.show===T?{ready:T}:{event:t.show}),"hide"in t&&n(t.hide)&&(t.hide=t.hide.jquery?{target:t.hide}:{event:t.hide}),"style"in t&&n(t.style)&&(t.style={classes:t.style}),r.each(H,function(){this.sanitize&&this.sanitize(t)}),t)}function l(t,e){for(var o,r=0,i=t,n=e.split(".");i=i[n[r++]];)r<n.length&&(o=i);return[o||t,n.pop()]}function p(t,e){var o,r,i;for(o in this.checks)for(r in this.checks[o])(i=new RegExp(r,"i").exec(t))&&(e.push(i),("builtin"===o||this.plugins[o])&&this.checks[o][r].apply(this.plugins[o]||this,e))}function u(t){return Y.concat("").join(t?"-"+t+" ":" ")}function h(t,e){return e>0?setTimeout(r.proxy(t,this),e):(t.call(this),void 0)}function c(t){this.tooltip.hasClass(te)||(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this.timers.show=h.call(this,function(){this.toggle(T,t)},this.options.show.delay))}function d(t){if(!this.tooltip.hasClass(te)&&!this.destroyed){var e=r(t.relatedTarget),o=e.closest(j)[0]===this.tooltip[0],i=e[0]===this.options.show.target[0];if(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this!==e[0]&&"mouse"===this.options.position.target&&o||this.options.hide.fixed&&/mouse(out|leave|move)/.test(t.type)&&(o||i))try{t.preventDefault(),t.stopImmediatePropagation()}catch(n){}else this.timers.hide=h.call(this,function(){this.toggle(I,t)},this.options.hide.delay,this)}}function g(t){!this.tooltip.hasClass(te)&&this.options.hide.inactive&&(clearTimeout(this.timers.inactive),this.timers.inactive=h.call(this,function(){this.hide(t)},this.options.hide.inactive))}function _(t){this.rendered&&this.tooltip[0].offsetWidth>0&&this.reposition(t)}function f(t,o,i){r(e.body).delegate(t,(o.split?o:o.join("."+V+" "))+"."+V,function(){var t=A.api[r.attr(this,W)];t&&!t.disabled&&i.apply(t,arguments)})}function m(t,o,n){var s,l,p,u,h,c=r(e.body),d=t[0]===e?c:t,g=t.metadata?t.metadata(n.metadata):M,_="html5"===n.metadata.type&&g?g[n.metadata.name]:M,f=t.data(n.metadata.name||"qtipopts");try{f="string"==typeof f?r.parseJSON(f):f}catch(m){}if(u=r.extend(T,{},A.defaults,n,"object"==typeof f?a(f):M,a(_||g)),l=u.position,u.id=o,"boolean"==typeof u.content.text){if(p=t.attr(u.content.attr),u.content.attr===I||!p)return I;u.content.text=p}if(l.container.length||(l.container=c),l.target===I&&(l.target=d),u.show.target===I&&(u.show.target=d),u.show.solo===T&&(u.show.solo=l.container.closest("body")),u.hide.target===I&&(u.hide.target=d),u.position.viewport===T&&(u.position.viewport=l.container),l.container=l.container.eq(0),l.at=new k(l.at,T),l.my=new k(l.my),t.data(V))if(u.overwrite)t.qtip("destroy",!0);else if(u.overwrite===I)return I;return t.attr(q,o),u.suppress&&(h=t.attr("title"))&&t.removeAttr("title").attr(oe,h).attr("title",""),s=new i(t,u,o,!!p),t.data(V,s),s}function y(t){return t.charAt(0).toUpperCase()+t.slice(1)}function v(t,e){var r,i,n=e.charAt(0).toUpperCase()+e.slice(1),s=(e+" "+me.join(n+" ")+n).split(" "),a=0;if(fe[e])return t.css(fe[e]);for(;r=s[a++];)if((i=t.css(r))!==o)return fe[e]=r,i}function w(t,e){return Math.ceil(parseFloat(v(t,e)))}function b(t,e){this._ns="tip",this.options=e,this.offset=e.offset,this.size=[e.width,e.height],this.init(this.qtip=t)}function P(t,e){this.options=e,this._ns="-modal",this.init(this.qtip=t)}function C(t){this._ns="ie6",this.init(this.qtip=t)}var A,S,k,x,E,T=!0,I=!1,M=null,L="x",U="y",F="width",D="height",N="top",R="left",O="bottom",$="right",B="center",z="flipinvert",G="shift",H={},V="qtip",q="data-hasqtip",W="data-qtip-id",Y=["ui-widget","ui-tooltip"],j="."+V,K="click dblclick mousedown mouseup mousemove mouseleave mouseenter".split(" "),X=V+"-fixed",J=V+"-default",Q=V+"-focus",Z=V+"-hover",te=V+"-disabled",ee="_replacedByqTip",oe="oldtitle",re={ie:function(){for(var t=4,o=e.createElement("div");(o.innerHTML="<!--[if gt IE "+t+"]><i></i><![endif]-->")&&o.getElementsByTagName("i")[0];t+=1);return t>4?t:0/0}(),iOS:parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||I};S=i.prototype,S._when=function(t){return r.when.apply(r,t)},S.render=function(t){if(this.rendered||this.destroyed)return this;var e,o=this,i=this.options,n=this.cache,s=this.elements,a=i.content.text,l=i.content.title,p=i.content.button,u=i.position,h=("."+this._id+" ",[]);return r.attr(this.target[0],"aria-describedby",this._id),n.posClass=this._createPosClass((this.position={my:u.my,at:u.at}).my),this.tooltip=s.tooltip=e=r("<div/>",{id:this._id,"class":[V,J,i.style.classes,n.posClass].join(" "),width:i.style.width||"",height:i.style.height||"",tracking:"mouse"===u.target&&u.adjust.mouse,role:"alert","aria-live":"polite","aria-atomic":I,"aria-describedby":this._id+"-content","aria-hidden":T}).toggleClass(te,this.disabled).attr(W,this.id).data(V,this).appendTo(u.container).append(s.content=r("<div />",{"class":V+"-content",id:this._id+"-content","aria-atomic":T})),this.rendered=-1,this.positioning=T,l&&(this._createTitle(),r.isFunction(l)||h.push(this._updateTitle(l,I))),p&&this._createButton(),r.isFunction(a)||h.push(this._updateContent(a,I)),this.rendered=T,this._setWidget(),r.each(H,function(t){var e;"render"===this.initialize&&(e=this(o))&&(o.plugins[t]=e)}),this._unassignEvents(),this._assignEvents(),this._when(h).then(function(){o._trigger("render"),o.positioning=I,o.hiddenDuringWait||!i.show.ready&&!t||o.toggle(T,n.event,I),o.hiddenDuringWait=I}),A.api[this.id]=this,this},S.destroy=function(t){function e(){if(!this.destroyed){this.destroyed=T;var t,e=this.target,o=e.attr(oe);this.rendered&&this.tooltip.stop(1,0).find("*").remove().end().remove(),r.each(this.plugins,function(){this.destroy&&this.destroy()});for(t in this.timers)clearTimeout(this.timers[t]);e.removeData(V).removeAttr(W).removeAttr(q).removeAttr("aria-describedby"),this.options.suppress&&o&&e.attr("title",o).removeAttr(oe),this._unassignEvents(),this.options=this.elements=this.cache=this.timers=this.plugins=this.mouse=M,delete A.api[this.id]}}return this.destroyed?this.target:(t===T&&"hide"!==this.triggering||!this.rendered?e.call(this):(this.tooltip.one("tooltiphidden",r.proxy(e,this)),!this.triggering&&this.hide()),this.target)},x=S.checks={builtin:{"^id$":function(t,e,o,i){var n=o===T?A.nextid:o,s=V+"-"+n;n!==I&&n.length>0&&!r("#"+s).length?(this._id=s,this.rendered&&(this.tooltip[0].id=this._id,this.elements.content[0].id=this._id+"-content",this.elements.title[0].id=this._id+"-title")):t[e]=i},"^prerender":function(t,e,o){o&&!this.rendered&&this.render(this.options.show.ready)},"^content.text$":function(t,e,o){this._updateContent(o)},"^content.attr$":function(t,e,o,r){this.options.content.text===this.target.attr(r)&&this._updateContent(this.target.attr(o))},"^content.title$":function(t,e,o){return o?(o&&!this.elements.title&&this._createTitle(),this._updateTitle(o),void 0):this._removeTitle()},"^content.button$":function(t,e,o){this._updateButton(o)},"^content.title.(text|button)$":function(t,e,o){this.set("content."+e,o)},"^position.(my|at)$":function(t,e,o){"string"==typeof o&&(this.position[e]=t[e]=new k(o,"at"===e))},"^position.container$":function(t,e,o){this.rendered&&this.tooltip.appendTo(o)},"^show.ready$":function(t,e,o){o&&(!this.rendered&&this.render(T)||this.toggle(T))},"^style.classes$":function(t,e,o,r){this.rendered&&this.tooltip.removeClass(r).addClass(o)},"^style.(width|height)":function(t,e,o){this.rendered&&this.tooltip.css(e,o)},"^style.widget|content.title":function(){this.rendered&&this._setWidget()},"^style.def":function(t,e,o){this.rendered&&this.tooltip.toggleClass(J,!!o)},"^events.(render|show|move|hide|focus|blur)$":function(t,e,o){this.rendered&&this.tooltip[(r.isFunction(o)?"":"un")+"bind"]("tooltip"+e,o)},"^(show|hide|position).(event|target|fixed|inactive|leave|distance|viewport|adjust)":function(){if(this.rendered){var t=this.options.position;this.tooltip.attr("tracking","mouse"===t.target&&t.adjust.mouse),this._unassignEvents(),this._assignEvents()}}}},S.get=function(t){if(this.destroyed)return this;var e=l(this.options,t.toLowerCase()),o=e[0][e[1]];return o.precedance?o.string():o};var ie=/^position\.(my|at|adjust|target|container|viewport)|style|content|show\.ready/i,ne=/^prerender|show\.ready/i;S.set=function(t,e){if(this.destroyed)return this;{var o,i=this.rendered,n=I,s=this.options;this.checks}return"string"==typeof t?(o=t,t={},t[o]=e):t=r.extend({},t),r.each(t,function(e,o){if(i&&ne.test(e))return delete t[e],void 0;var a,p=l(s,e.toLowerCase());a=p[0][p[1]],p[0][p[1]]=o&&o.nodeType?r(o):o,n=ie.test(e)||n,t[e]=[p[0],p[1],o,a]}),a(s),this.positioning=T,r.each(t,r.proxy(p,this)),this.positioning=I,this.rendered&&this.tooltip[0].offsetWidth>0&&n&&this.reposition("mouse"===s.position.target?M:this.cache.event),this},S._update=function(t,e){var o=this,i=this.cache;return this.rendered&&t?(r.isFunction(t)&&(t=t.call(this.elements.target,i.event,this)||""),r.isFunction(t.then)?(i.waiting=T,t.then(function(t){return i.waiting=I,o._update(t,e)},M,function(t){return o._update(t,e)})):t===I||!t&&""!==t?I:(t.jquery&&t.length>0?e.empty().append(t.css({display:"block",visibility:"visible"})):e.html(t),this._waitForContent(e).then(function(t){o.rendered&&o.tooltip[0].offsetWidth>0&&o.reposition(i.event,!t.length)}))):I},S._waitForContent=function(t){var e=this.cache;return e.waiting=T,(r.fn.imagesLoaded?t.imagesLoaded():r.Deferred().resolve([])).done(function(){e.waiting=I}).promise()},S._updateContent=function(t,e){this._update(t,this.elements.content,e)},S._updateTitle=function(t,e){this._update(t,this.elements.title,e)===I&&this._removeTitle(I)},S._createTitle=function(){var t=this.elements,e=this._id+"-title";t.titlebar&&this._removeTitle(),t.titlebar=r("<div />",{"class":V+"-titlebar "+(this.options.style.widget?u("header"):"")}).append(t.title=r("<div />",{id:e,"class":V+"-title","aria-atomic":T})).insertBefore(t.content).delegate(".qtip-close","mousedown keydown mouseup keyup mouseout",function(t){r(this).toggleClass("ui-state-active ui-state-focus","down"===t.type.substr(-4))}).delegate(".qtip-close","mouseover mouseout",function(t){r(this).toggleClass("ui-state-hover","mouseover"===t.type)}),this.options.content.button&&this._createButton()},S._removeTitle=function(t){var e=this.elements;e.title&&(e.titlebar.remove(),e.titlebar=e.title=e.button=M,t!==I&&this.reposition())},S._createPosClass=function(t){return V+"-pos-"+(t||this.options.position.my).abbrev()},S.reposition=function(o,i){if(!this.rendered||this.positioning||this.destroyed)return this;this.positioning=T;var n,s,a,l,p=this.cache,u=this.tooltip,h=this.options.position,c=h.target,d=h.my,g=h.at,_=h.viewport,f=h.container,m=h.adjust,y=m.method.split(" "),v=u.outerWidth(I),w=u.outerHeight(I),b=0,P=0,C=u.css("position"),A={left:0,top:0},S=u[0].offsetWidth>0,k=o&&"scroll"===o.type,x=r(t),E=f[0].ownerDocument,M=this.mouse;if(r.isArray(c)&&2===c.length)g={x:R,y:N},A={left:c[0],top:c[1]};else if("mouse"===c)g={x:R,y:N},(!m.mouse||this.options.hide.distance)&&p.origin&&p.origin.pageX?o=p.origin:!o||o&&("resize"===o.type||"scroll"===o.type)?o=p.event:M&&M.pageX&&(o=M),"static"!==C&&(A=f.offset()),E.body.offsetWidth!==(t.innerWidth||E.documentElement.clientWidth)&&(s=r(e.body).offset()),A={left:o.pageX-A.left+(s&&s.left||0),top:o.pageY-A.top+(s&&s.top||0)},m.mouse&&k&&M&&(A.left-=(M.scrollX||0)-x.scrollLeft(),A.top-=(M.scrollY||0)-x.scrollTop());else{if("event"===c?o&&o.target&&"scroll"!==o.type&&"resize"!==o.type?p.target=r(o.target):o.target||(p.target=this.elements.target):"event"!==c&&(p.target=r(c.jquery?c:this.elements.target)),c=p.target,c=r(c).eq(0),0===c.length)return this;c[0]===e||c[0]===t?(b=re.iOS?t.innerWidth:c.width(),P=re.iOS?t.innerHeight:c.height(),c[0]===t&&(A={top:(_||c).scrollTop(),left:(_||c).scrollLeft()})):H.imagemap&&c.is("area")?n=H.imagemap(this,c,g,H.viewport?y:I):H.svg&&c&&c[0].ownerSVGElement?n=H.svg(this,c,g,H.viewport?y:I):(b=c.outerWidth(I),P=c.outerHeight(I),A=c.offset()),n&&(b=n.width,P=n.height,s=n.offset,A=n.position),A=this.reposition.offset(c,A,f),(re.iOS>3.1&&re.iOS<4.1||re.iOS>=4.3&&re.iOS<4.33||!re.iOS&&"fixed"===C)&&(A.left-=x.scrollLeft(),A.top-=x.scrollTop()),(!n||n&&n.adjustable!==I)&&(A.left+=g.x===$?b:g.x===B?b/2:0,A.top+=g.y===O?P:g.y===B?P/2:0)}return A.left+=m.x+(d.x===$?-v:d.x===B?-v/2:0),A.top+=m.y+(d.y===O?-w:d.y===B?-w/2:0),H.viewport?(a=A.adjusted=H.viewport(this,A,h,b,P,v,w),s&&a.left&&(A.left+=s.left),s&&a.top&&(A.top+=s.top),a.my&&(this.position.my=a.my)):A.adjusted={left:0,top:0},p.posClass!==(l=this._createPosClass(this.position.my))&&u.removeClass(p.posClass).addClass(p.posClass=l),this._trigger("move",[A,_.elem||_],o)?(delete A.adjusted,i===I||!S||isNaN(A.left)||isNaN(A.top)||"mouse"===c||!r.isFunction(h.effect)?u.css(A):r.isFunction(h.effect)&&(h.effect.call(u,this,r.extend({},A)),u.queue(function(t){r(this).css({opacity:"",height:""}),re.ie&&this.style.removeAttribute("filter"),t()})),this.positioning=I,this):this},S.reposition.offset=function(t,o,i){function n(t,e){o.left+=e*t.scrollLeft(),o.top+=e*t.scrollTop()}if(!i[0])return o;var s,a,l,p,u=r(t[0].ownerDocument),h=!!re.ie&&"CSS1Compat"!==e.compatMode,c=i[0];do"static"!==(a=r.css(c,"position"))&&("fixed"===a?(l=c.getBoundingClientRect(),n(u,-1)):(l=r(c).position(),l.left+=parseFloat(r.css(c,"borderLeftWidth"))||0,l.top+=parseFloat(r.css(c,"borderTopWidth"))||0),o.left-=l.left+(parseFloat(r.css(c,"marginLeft"))||0),o.top-=l.top+(parseFloat(r.css(c,"marginTop"))||0),s||"hidden"===(p=r.css(c,"overflow"))||"visible"===p||(s=r(c)));while(c=c.offsetParent);return s&&(s[0]!==u[0]||h)&&n(s,1),o};var se=(k=S.reposition.Corner=function(t,e){t=(""+t).replace(/([A-Z])/," $1").replace(/middle/gi,B).toLowerCase(),this.x=(t.match(/left|right/i)||t.match(/center/)||["inherit"])[0].toLowerCase(),this.y=(t.match(/top|bottom|center/i)||["inherit"])[0].toLowerCase(),this.forceY=!!e;var o=t.charAt(0);this.precedance="t"===o||"b"===o?U:L}).prototype;se.invert=function(t,e){this[t]=this[t]===R?$:this[t]===$?R:e||this[t]},se.string=function(t){var e=this.x,o=this.y,r=e!==o?"center"===e||"center"!==o&&(this.precedance===U||this.forceY)?[o,e]:[e,o]:[e];return t!==!1?r.join(" "):r},se.abbrev=function(){var t=this.string(!1);return t[0].charAt(0)+(t[1]&&t[1].charAt(0)||"")},se.clone=function(){return new k(this.string(),this.forceY)},S.toggle=function(t,o){var i=this.cache,n=this.options,s=this.tooltip;if(o){if(/over|enter/.test(o.type)&&i.event&&/out|leave/.test(i.event.type)&&n.show.target.add(o.target).length===n.show.target.length&&s.has(o.relatedTarget).length)return this;i.event=r.event.fix(o)}if(this.waiting&&!t&&(this.hiddenDuringWait=T),!this.rendered)return t?this.render(1):this;if(this.destroyed||this.disabled)return this;var a,l,p,u=t?"show":"hide",h=this.options[u],c=(this.options[t?"hide":"show"],this.options.position),d=this.options.content,g=this.tooltip.css("width"),_=this.tooltip.is(":visible"),f=t||1===h.target.length,m=!o||h.target.length<2||i.target[0]===o.target;return(typeof t).search("boolean|number")&&(t=!_),a=!s.is(":animated")&&_===t&&m,l=a?M:!!this._trigger(u,[90]),this.destroyed?this:(l!==I&&t&&this.focus(o),!l||a?this:(r.attr(s[0],"aria-hidden",!t),t?(this.mouse&&(i.origin=r.event.fix(this.mouse)),r.isFunction(d.text)&&this._updateContent(d.text,I),r.isFunction(d.title)&&this._updateTitle(d.title,I),!E&&"mouse"===c.target&&c.adjust.mouse&&(r(e).bind("mousemove."+V,this._storeMouse),E=T),g||s.css("width",s.outerWidth(I)),this.reposition(o,arguments[2]),g||s.css("width",""),h.solo&&("string"==typeof h.solo?r(h.solo):r(j,h.solo)).not(s).not(h.target).qtip("hide",r.Event("tooltipsolo"))):(clearTimeout(this.timers.show),delete i.origin,E&&!r(j+'[tracking="true"]:visible',h.solo).not(s).length&&(r(e).unbind("mousemove."+V),E=I),this.blur(o)),p=r.proxy(function(){t?(re.ie&&s[0].style.removeAttribute("filter"),s.css("overflow",""),"string"==typeof h.autofocus&&r(this.options.show.autofocus,s).focus(),this.options.show.target.trigger("qtip-"+this.id+"-inactive")):s.css({display:"",visibility:"",opacity:"",left:"",top:""}),this._trigger(t?"visible":"hidden")},this),h.effect===I||f===I?(s[u](),p()):r.isFunction(h.effect)?(s.stop(1,1),h.effect.call(s,this),s.queue("fx",function(t){p(),t()})):s.fadeTo(90,t?1:0,p),t&&h.target.trigger("qtip-"+this.id+"-inactive"),this))},S.show=function(t){return this.toggle(T,t)},S.hide=function(t){return this.toggle(I,t)},S.focus=function(t){if(!this.rendered||this.destroyed)return this;var e=r(j),o=this.tooltip,i=parseInt(o[0].style.zIndex,10),n=A.zindex+e.length;return o.hasClass(Q)||this._trigger("focus",[n],t)&&(i!==n&&(e.each(function(){this.style.zIndex>i&&(this.style.zIndex=this.style.zIndex-1)}),e.filter("."+Q).qtip("blur",t)),o.addClass(Q)[0].style.zIndex=n),this},S.blur=function(t){return!this.rendered||this.destroyed?this:(this.tooltip.removeClass(Q),this._trigger("blur",[this.tooltip.css("zIndex")],t),this)},S.disable=function(t){return this.destroyed?this:("toggle"===t?t=!(this.rendered?this.tooltip.hasClass(te):this.disabled):"boolean"!=typeof t&&(t=T),this.rendered&&this.tooltip.toggleClass(te,t).attr("aria-disabled",t),this.disabled=!!t,this)},S.enable=function(){return this.disable(I)},S._createButton=function(){var t=this,e=this.elements,o=e.tooltip,i=this.options.content.button,n="string"==typeof i,s=n?i:"Close tooltip";e.button&&e.button.remove(),e.button=i.jquery?i:r("<a />",{"class":"qtip-close "+(this.options.style.widget?"":V+"-icon"),title:s,"aria-label":s}).prepend(r("<span />",{"class":"ui-icon ui-icon-close",html:"&times;"})),e.button.appendTo(e.titlebar||o).attr("role","button").click(function(e){return o.hasClass(te)||t.hide(e),I})},S._updateButton=function(t){if(!this.rendered)return I;var e=this.elements.button;t?this._createButton():e.remove()},S._setWidget=function(){var t=this.options.style.widget,e=this.elements,o=e.tooltip,r=o.hasClass(te);o.removeClass(te),te=t?"ui-state-disabled":"qtip-disabled",o.toggleClass(te,r),o.toggleClass("ui-helper-reset "+u(),t).toggleClass(J,this.options.style.def&&!t),e.content&&e.content.toggleClass(u("content"),t),e.titlebar&&e.titlebar.toggleClass(u("header"),t),e.button&&e.button.toggleClass(V+"-icon",!t)},S._storeMouse=function(t){return(this.mouse=r.event.fix(t)).type="mousemove",this},S._bind=function(t,e,o,i,n){if(t&&o&&e.length){var s="."+this._id+(i?"-"+i:"");return r(t).bind((e.split?e:e.join(s+" "))+s,r.proxy(o,n||this)),this}},S._unbind=function(t,e){return t&&r(t).unbind("."+this._id+(e?"-"+e:"")),this},S._trigger=function(t,e,o){var i=r.Event("tooltip"+t);return i.originalEvent=o&&r.extend({},o)||this.cache.event||M,this.triggering=t,this.tooltip.trigger(i,[this].concat(e||[])),this.triggering=I,!i.isDefaultPrevented()},S._bindEvents=function(t,e,o,i,n,s){var a=o.filter(i).add(i.filter(o)),l=[];a.length&&(r.each(e,function(e,o){var i=r.inArray(o,t);i>-1&&l.push(t.splice(i,1)[0])}),l.length&&(this._bind(a,l,function(t){var e=this.rendered?this.tooltip[0].offsetWidth>0:!1;(e?s:n).call(this,t)}),o=o.not(a),i=i.not(a))),this._bind(o,t,n),this._bind(i,e,s)},S._assignInitialEvents=function(t){function e(t){return this.disabled||this.destroyed?I:(this.cache.event=t&&r.event.fix(t),this.cache.target=t&&r(t.target),clearTimeout(this.timers.show),this.timers.show=h.call(this,function(){this.render("object"==typeof t||o.show.ready)},o.prerender?0:o.show.delay),void 0)}var o=this.options,i=o.show.target,n=o.hide.target,s=o.show.event?r.trim(""+o.show.event).split(" "):[],a=o.hide.event?r.trim(""+o.hide.event).split(" "):[];this._bind(this.elements.target,["remove","removeqtip"],function(){this.destroy(!0)},"destroy"),/mouse(over|enter)/i.test(o.show.event)&&!/mouse(out|leave)/i.test(o.hide.event)&&a.push("mouseleave"),this._bind(i,"mousemove",function(t){this._storeMouse(t),this.cache.onTarget=T}),this._bindEvents(s,a,i,n,e,function(){return this.timers?(clearTimeout(this.timers.show),void 0):I}),(o.show.ready||o.prerender)&&e.call(this,t)},S._assignEvents=function(){var o=this,i=this.options,n=i.position,s=this.tooltip,a=i.show.target,l=i.hide.target,p=n.container,u=n.viewport,h=r(e),f=(r(e.body),r(t)),m=i.show.event?r.trim(""+i.show.event).split(" "):[],y=i.hide.event?r.trim(""+i.hide.event).split(" "):[];r.each(i.events,function(t,e){o._bind(s,"toggle"===t?["tooltipshow","tooltiphide"]:["tooltip"+t],e,null,s)}),/mouse(out|leave)/i.test(i.hide.event)&&"window"===i.hide.leave&&this._bind(h,["mouseout","blur"],function(t){/select|option/.test(t.target.nodeName)||t.relatedTarget||this.hide(t)}),i.hide.fixed?l=l.add(s.addClass(X)):/mouse(over|enter)/i.test(i.show.event)&&this._bind(l,"mouseleave",function(){clearTimeout(this.timers.show)}),(""+i.hide.event).indexOf("unfocus")>-1&&this._bind(p.closest("html"),["mousedown","touchstart"],function(t){var e=r(t.target),o=this.rendered&&!this.tooltip.hasClass(te)&&this.tooltip[0].offsetWidth>0,i=e.parents(j).filter(this.tooltip[0]).length>0;e[0]===this.target[0]||e[0]===this.tooltip[0]||i||this.target.has(e[0]).length||!o||this.hide(t)}),"number"==typeof i.hide.inactive&&(this._bind(a,"qtip-"+this.id+"-inactive",g,"inactive"),this._bind(l.add(s),A.inactiveEvents,g)),this._bindEvents(m,y,a,l,c,d),this._bind(a.add(s),"mousemove",function(t){if("number"==typeof i.hide.distance){var e=this.cache.origin||{},o=this.options.hide.distance,r=Math.abs;(r(t.pageX-e.pageX)>=o||r(t.pageY-e.pageY)>=o)&&this.hide(t)}this._storeMouse(t)}),"mouse"===n.target&&n.adjust.mouse&&(i.hide.event&&this._bind(a,["mouseenter","mouseleave"],function(t){return this.cache?(this.cache.onTarget="mouseenter"===t.type,void 0):I}),this._bind(h,"mousemove",function(t){this.rendered&&this.cache.onTarget&&!this.tooltip.hasClass(te)&&this.tooltip[0].offsetWidth>0&&this.reposition(t)})),(n.adjust.resize||u.length)&&this._bind(r.event.special.resize?u:f,"resize",_),n.adjust.scroll&&this._bind(f.add(n.container),"scroll",_)},S._unassignEvents=function(){var o=this.options,i=o.show.target,n=o.hide.target,s=r.grep([this.elements.target[0],this.rendered&&this.tooltip[0],o.position.container[0],o.position.viewport[0],o.position.container.closest("html")[0],t,e],function(t){return"object"==typeof t});i&&i.toArray&&(s=s.concat(i.toArray())),n&&n.toArray&&(s=s.concat(n.toArray())),this._unbind(s)._unbind(s,"destroy")._unbind(s,"inactive")},r(function(){f(j,["mouseenter","mouseleave"],function(t){var e="mouseenter"===t.type,o=r(t.currentTarget),i=r(t.relatedTarget||t.target),n=this.options;e?(this.focus(t),o.hasClass(X)&&!o.hasClass(te)&&clearTimeout(this.timers.hide)):"mouse"===n.position.target&&n.position.adjust.mouse&&n.hide.event&&n.show.target&&!i.closest(n.show.target[0]).length&&this.hide(t),o.toggleClass(Z,e)}),f("["+W+"]",K,g)}),A=r.fn.qtip=function(t,e,i){var n=(""+t).toLowerCase(),s=M,l=r.makeArray(arguments).slice(1),p=l[l.length-1],u=this[0]?r.data(this[0],V):M;return!arguments.length&&u||"api"===n?u:"string"==typeof t?(this.each(function(){var t=r.data(this,V);if(!t)return T;if(p&&p.timeStamp&&(t.cache.event=p),!e||"option"!==n&&"options"!==n)t[n]&&t[n].apply(t,l);else{if(i===o&&!r.isPlainObject(e))return s=t.get(e),I;t.set(e,i)}}),s!==M?s:this):"object"!=typeof t&&arguments.length?void 0:(u=a(r.extend(T,{},t)),this.each(function(t){var e,o;return o=r.isArray(u.id)?u.id[t]:u.id,o=!o||o===I||o.length<1||A.api[o]?A.nextid++:o,e=m(r(this),o,u),e===I?T:(A.api[o]=e,r.each(H,function(){"initialize"===this.initialize&&this(e)}),e._assignInitialEvents(p),void 0)}))},r.qtip=i,A.api={},r.each({attr:function(t,e){if(this.length){var o=this[0],i="title",n=r.data(o,"qtip");if(t===i&&n&&"object"==typeof n&&n.options.suppress)return arguments.length<2?r.attr(o,oe):(n&&n.options.content.attr===i&&n.cache.attr&&n.set("content.text",e),this.attr(oe,e))}return r.fn["attr"+ee].apply(this,arguments)},clone:function(t){var e=(r([]),r.fn["clone"+ee].apply(this,arguments));return t||e.filter("["+oe+"]").attr("title",function(){return r.attr(this,oe)}).removeAttr(oe),e}},function(t,e){if(!e||r.fn[t+ee])return T;var o=r.fn[t+ee]=r.fn[t];r.fn[t]=function(){return e.apply(this,arguments)||o.apply(this,arguments)}}),r.ui||(r["cleanData"+ee]=r.cleanData,r.cleanData=function(t){for(var e,o=0;(e=r(t[o])).length;o++)if(e.attr(q))try{e.triggerHandler("removeqtip")}catch(i){}r["cleanData"+ee].apply(this,arguments)}),A.version="2.2.1",A.nextid=0,A.inactiveEvents=K,A.zindex=15e3,A.defaults={prerender:I,id:I,overwrite:T,suppress:T,content:{text:T,attr:"title",title:I,button:I},position:{my:"top left",at:"bottom right",target:I,container:I,viewport:I,adjust:{x:0,y:0,mouse:T,scroll:T,resize:T,method:"flipinvert flipinvert"},effect:function(t,e){r(this).animate(e,{duration:200,queue:I})}},show:{target:I,event:"mouseenter",effect:T,delay:90,solo:I,ready:I,autofocus:I},hide:{target:I,event:"mouseleave",effect:T,delay:0,fixed:I,inactive:I,leave:"window",distance:I},style:{classes:"",widget:I,width:I,height:I,def:T},events:{render:M,move:M,show:M,hide:M,toggle:M,visible:M,hidden:M,focus:M,blur:M}};var ae,le="margin",pe="border",ue="color",he="background-color",ce="transparent",de=" !important",ge=!!e.createElement("canvas").getContext,_e=/rgba?\(0, 0, 0(, 0)?\)|transparent|#123456/i,fe={},me=["Webkit","O","Moz","ms"];if(ge)var ye=t.devicePixelRatio||1,ve=function(){var t=e.createElement("canvas").getContext("2d");return t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||1}(),we=ye/ve;else var be=function(t,e,o){return"<qtipvml:"+t+' xmlns="urn:schemas-microsoft.com:vml" class="qtip-vml" '+(e||"")+' style="behavior: url(#default#VML); '+(o||"")+'" />'};r.extend(b.prototype,{init:function(t){var e,o;o=this.element=t.elements.tip=r("<div />",{"class":V+"-tip"}).prependTo(t.tooltip),ge?(e=r("<canvas />").appendTo(this.element)[0].getContext("2d"),e.lineJoin="miter",e.miterLimit=1e5,e.save()):(e=be("shape",'coordorigin="0,0"',"position:absolute;"),this.element.html(e+e),t._bind(r("*",o).add(o),["click","mousedown"],function(t){t.stopPropagation()},this._ns)),t._bind(t.tooltip,"tooltipmove",this.reposition,this._ns,this),this.create()},_swapDimensions:function(){this.size[0]=this.options.height,this.size[1]=this.options.width},_resetDimensions:function(){this.size[0]=this.options.width,this.size[1]=this.options.height},_useTitle:function(t){var e=this.qtip.elements.titlebar;return e&&(t.y===N||t.y===B&&this.element.position().top+this.size[1]/2+this.options.offset<e.outerHeight(T))},_parseCorner:function(t){var e=this.qtip.options.position.my;return t===I||e===I?t=I:t===T?t=new k(e.string()):t.string||(t=new k(t),t.fixed=T),t},_parseWidth:function(t,e,o){var r=this.qtip.elements,i=pe+y(e)+"Width";return(o?w(o,i):w(r.content,i)||w(this._useTitle(t)&&r.titlebar||r.content,i)||w(r.tooltip,i))||0},_parseRadius:function(t){var e=this.qtip.elements,o=pe+y(t.y)+y(t.x)+"Radius";return re.ie<9?0:w(this._useTitle(t)&&e.titlebar||e.content,o)||w(e.tooltip,o)||0},_invalidColour:function(t,e,o){var r=t.css(e);return!r||o&&r===t.css(o)||_e.test(r)?I:r},_parseColours:function(t){var e=this.qtip.elements,o=this.element.css("cssText",""),i=pe+y(t[t.precedance])+y(ue),n=this._useTitle(t)&&e.titlebar||e.content,s=this._invalidColour,a=[];return a[0]=s(o,he)||s(n,he)||s(e.content,he)||s(e.tooltip,he)||o.css(he),a[1]=s(o,i,ue)||s(n,i,ue)||s(e.content,i,ue)||s(e.tooltip,i,ue)||e.tooltip.css(i),r("*",o).add(o).css("cssText",he+":"+ce+de+";"+pe+":0"+de+";"),a},_calculateSize:function(t){var e,o,r,i=t.precedance===U,n=this.options.width,s=this.options.height,a="c"===t.abbrev(),l=(i?n:s)*(a?.5:1),p=Math.pow,u=Math.round,h=Math.sqrt(p(l,2)+p(s,2)),c=[this.border/l*h,this.border/s*h];return c[2]=Math.sqrt(p(c[0],2)-p(this.border,2)),c[3]=Math.sqrt(p(c[1],2)-p(this.border,2)),e=h+c[2]+c[3]+(a?0:c[0]),o=e/h,r=[u(o*n),u(o*s)],i?r:r.reverse()},_calculateTip:function(t,e,o){o=o||1,e=e||this.size;var r=e[0]*o,i=e[1]*o,n=Math.ceil(r/2),s=Math.ceil(i/2),a={br:[0,0,r,i,r,0],bl:[0,0,r,0,0,i],tr:[0,i,r,0,r,i],tl:[0,0,0,i,r,i],tc:[0,i,n,0,r,i],bc:[0,0,r,0,n,i],rc:[0,0,r,s,0,i],lc:[r,0,r,i,0,s]};return a.lt=a.br,a.rt=a.bl,a.lb=a.tr,a.rb=a.tl,a[t.abbrev()]},_drawCoords:function(t,e){t.beginPath(),t.moveTo(e[0],e[1]),t.lineTo(e[2],e[3]),t.lineTo(e[4],e[5]),t.closePath()},create:function(){var t=this.corner=(ge||re.ie)&&this._parseCorner(this.options.corner);return(this.enabled=!!this.corner&&"c"!==this.corner.abbrev())&&(this.qtip.cache.corner=t.clone(),this.update()),this.element.toggle(this.enabled),this.corner},update:function(e,o){if(!this.enabled)return this;var i,n,s,a,l,p,u,h,c=this.qtip.elements,d=this.element,g=d.children(),_=this.options,f=this.size,m=_.mimic,y=Math.round;e||(e=this.qtip.cache.corner||this.corner),m===I?m=e:(m=new k(m),m.precedance=e.precedance,"inherit"===m.x?m.x=e.x:"inherit"===m.y?m.y=e.y:m.x===m.y&&(m[e.precedance]=e[e.precedance])),n=m.precedance,e.precedance===L?this._swapDimensions():this._resetDimensions(),i=this.color=this._parseColours(e),i[1]!==ce?(h=this.border=this._parseWidth(e,e[e.precedance]),_.border&&1>h&&!_e.test(i[1])&&(i[0]=i[1]),this.border=h=_.border!==T?_.border:h):this.border=h=0,u=this.size=this._calculateSize(e),d.css({width:u[0],height:u[1],lineHeight:u[1]+"px"}),p=e.precedance===U?[y(m.x===R?h:m.x===$?u[0]-f[0]-h:(u[0]-f[0])/2),y(m.y===N?u[1]-f[1]:0)]:[y(m.x===R?u[0]-f[0]:0),y(m.y===N?h:m.y===O?u[1]-f[1]-h:(u[1]-f[1])/2)],ge?(s=g[0].getContext("2d"),s.restore(),s.save(),s.clearRect(0,0,6e3,6e3),a=this._calculateTip(m,f,we),l=this._calculateTip(m,this.size,we),g.attr(F,u[0]*we).attr(D,u[1]*we),g.css(F,u[0]).css(D,u[1]),this._drawCoords(s,l),s.fillStyle=i[1],s.fill(),s.translate(p[0]*we,p[1]*we),this._drawCoords(s,a),s.fillStyle=i[0],s.fill()):(a=this._calculateTip(m),a="m"+a[0]+","+a[1]+" l"+a[2]+","+a[3]+" "+a[4]+","+a[5]+" xe",p[2]=h&&/^(r|b)/i.test(e.string())?8===re.ie?2:1:0,g.css({coordsize:u[0]+h+" "+(u[1]+h),antialias:""+(m.string().indexOf(B)>-1),left:p[0]-p[2]*Number(n===L),top:p[1]-p[2]*Number(n===U),width:u[0]+h,height:u[1]+h}).each(function(t){var e=r(this);e[e.prop?"prop":"attr"]({coordsize:u[0]+h+" "+(u[1]+h),path:a,fillcolor:i[0],filled:!!t,stroked:!t}).toggle(!(!h&&!t)),!t&&e.html(be("stroke",'weight="'+2*h+'px" color="'+i[1]+'" miterlimit="1000" joinstyle="miter"'))})),t.opera&&setTimeout(function(){c.tip.css({display:"inline-block",visibility:"visible"})},1),o!==I&&this.calculate(e,u)},calculate:function(t,e){if(!this.enabled)return I;var o,i,n=this,s=this.qtip.elements,a=this.element,l=this.options.offset,p=(s.tooltip.hasClass("ui-widget"),{});return t=t||this.corner,o=t.precedance,e=e||this._calculateSize(t),i=[t.x,t.y],o===L&&i.reverse(),r.each(i,function(r,i){var a,u,h;i===B?(a=o===U?R:N,p[a]="50%",p[le+"-"+a]=-Math.round(e[o===U?0:1]/2)+l):(a=n._parseWidth(t,i,s.tooltip),u=n._parseWidth(t,i,s.content),h=n._parseRadius(t),p[i]=Math.max(-n.border,r?u:l+(h>a?h:-a)))}),p[t[o]]-=e[o===L?0:1],a.css({margin:"",top:"",bottom:"",left:"",right:""}).css(p),p},reposition:function(t,e,r){function i(t,e,o,r,i){t===G&&p.precedance===e&&u[r]&&p[o]!==B?p.precedance=p.precedance===L?U:L:t!==G&&u[r]&&(p[e]=p[e]===B?u[r]>0?r:i:p[e]===r?i:r)}function n(t,e,i){p[t]===B?_[le+"-"+e]=g[t]=s[le+"-"+e]-u[e]:(a=s[i]!==o?[u[e],-s[e]]:[-u[e],s[e]],(g[t]=Math.max(a[0],a[1]))>a[0]&&(r[e]-=u[e],g[e]=I),_[s[i]!==o?i:e]=g[t])
}if(this.enabled){var s,a,l=e.cache,p=this.corner.clone(),u=r.adjusted,h=e.options.position.adjust.method.split(" "),c=h[0],d=h[1]||h[0],g={left:I,top:I,x:0,y:0},_={};this.corner.fixed!==T&&(i(c,L,U,R,$),i(d,U,L,N,O),(p.string()!==l.corner.string()||l.cornerTop!==u.top||l.cornerLeft!==u.left)&&this.update(p,I)),s=this.calculate(p),s.right!==o&&(s.left=-s.right),s.bottom!==o&&(s.top=-s.bottom),s.user=this.offset,(g.left=c===G&&!!u.left)&&n(L,R,$),(g.top=d===G&&!!u.top)&&n(U,N,O),this.element.css(_).toggle(!(g.x&&g.y||p.x===B&&g.y||p.y===B&&g.x)),r.left-=s.left.charAt?s.user:c!==G||g.top||!g.left&&!g.top?s.left+this.border:0,r.top-=s.top.charAt?s.user:d!==G||g.left||!g.left&&!g.top?s.top+this.border:0,l.cornerLeft=u.left,l.cornerTop=u.top,l.corner=p.clone()}},destroy:function(){this.qtip._unbind(this.qtip.tooltip,this._ns),this.qtip.elements.tip&&this.qtip.elements.tip.find("*").remove().end().remove()}}),ae=H.tip=function(t){return new b(t,t.options.style.tip)},ae.initialize="render",ae.sanitize=function(t){if(t.style&&"tip"in t.style){var e=t.style.tip;"object"!=typeof e&&(e=t.style.tip={corner:e}),/string|boolean/i.test(typeof e.corner)||(e.corner=T)}},x.tip={"^position.my|style.tip.(corner|mimic|border)$":function(){this.create(),this.qtip.reposition()},"^style.tip.(height|width)$":function(t){this.size=[t.width,t.height],this.update(),this.qtip.reposition()},"^content.title|style.(classes|widget)$":function(){this.update()}},r.extend(T,A.defaults,{style:{tip:{corner:T,mimic:I,width:6,height:6,border:T,offset:0}}});var Pe,Ce,Ae="qtip-modal",Se="."+Ae;Ce=function(){function t(t){if(r.expr[":"].focusable)return r.expr[":"].focusable;var e,o,i,n=!isNaN(r.attr(t,"tabindex")),s=t.nodeName&&t.nodeName.toLowerCase();return"area"===s?(e=t.parentNode,o=e.name,t.href&&o&&"map"===e.nodeName.toLowerCase()?(i=r("img[usemap=#"+o+"]")[0],!!i&&i.is(":visible")):!1):/input|select|textarea|button|object/.test(s)?!t.disabled:"a"===s?t.href||n:n}function o(t){u.length<1&&t.length?t.not("body").blur():u.first().focus()}function i(t){if(l.is(":visible")){var e,i=r(t.target),a=n.tooltip,p=i.closest(j);e=p.length<1?I:parseInt(p[0].style.zIndex,10)>parseInt(a[0].style.zIndex,10),e||i.closest(j)[0]===a[0]||o(i),s=t.target===u[u.length-1]}}var n,s,a,l,p=this,u={};r.extend(p,{init:function(){return l=p.elem=r("<div />",{id:"qtip-overlay",html:"<div></div>",mousedown:function(){return I}}).hide(),r(e.body).bind("focusin"+Se,i),r(e).bind("keydown"+Se,function(t){n&&n.options.show.modal.escape&&27===t.keyCode&&n.hide(t)}),l.bind("click"+Se,function(t){n&&n.options.show.modal.blur&&n.hide(t)}),p},update:function(e){n=e,u=e.options.show.modal.stealfocus!==I?e.tooltip.find("*").filter(function(){return t(this)}):[]},toggle:function(t,i,s){var u=(r(e.body),t.tooltip),h=t.options.show.modal,c=h.effect,d=i?"show":"hide",g=l.is(":visible"),_=r(Se).filter(":visible:not(:animated)").not(u);return p.update(t),i&&h.stealfocus!==I&&o(r(":focus")),l.toggleClass("blurs",h.blur),i&&l.appendTo(e.body),l.is(":animated")&&g===i&&a!==I||!i&&_.length?p:(l.stop(T,I),r.isFunction(c)?c.call(l,i):c===I?l[d]():l.fadeTo(parseInt(s,10)||90,i?1:0,function(){i||l.hide()}),i||l.queue(function(t){l.css({left:"",top:""}),r(Se).length||l.detach(),t()}),a=i,n.destroyed&&(n=M),p)}}),p.init()},Ce=new Ce,r.extend(P.prototype,{init:function(t){var e=t.tooltip;return this.options.on?(t.elements.overlay=Ce.elem,e.addClass(Ae).css("z-index",A.modal_zindex+r(Se).length),t._bind(e,["tooltipshow","tooltiphide"],function(t,o,i){var n=t.originalEvent;if(t.target===e[0])if(n&&"tooltiphide"===t.type&&/mouse(leave|enter)/.test(n.type)&&r(n.relatedTarget).closest(Ce.elem[0]).length)try{t.preventDefault()}catch(s){}else(!n||n&&"tooltipsolo"!==n.type)&&this.toggle(t,"tooltipshow"===t.type,i)},this._ns,this),t._bind(e,"tooltipfocus",function(t,o){if(!t.isDefaultPrevented()&&t.target===e[0]){var i=r(Se),n=A.modal_zindex+i.length,s=parseInt(e[0].style.zIndex,10);Ce.elem[0].style.zIndex=n-1,i.each(function(){this.style.zIndex>s&&(this.style.zIndex-=1)}),i.filter("."+Q).qtip("blur",t.originalEvent),e.addClass(Q)[0].style.zIndex=n,Ce.update(o);try{t.preventDefault()}catch(a){}}},this._ns,this),t._bind(e,"tooltiphide",function(t){t.target===e[0]&&r(Se).filter(":visible").not(e).last().qtip("focus",t)},this._ns,this),void 0):this},toggle:function(t,e,o){return t&&t.isDefaultPrevented()?this:(Ce.toggle(this.qtip,!!e,o),void 0)},destroy:function(){this.qtip.tooltip.removeClass(Ae),this.qtip._unbind(this.qtip.tooltip,this._ns),Ce.toggle(this.qtip,I),delete this.qtip.elements.overlay}}),Pe=H.modal=function(t){return new P(t,t.options.show.modal)},Pe.sanitize=function(t){t.show&&("object"!=typeof t.show.modal?t.show.modal={on:!!t.show.modal}:"undefined"==typeof t.show.modal.on&&(t.show.modal.on=T))},A.modal_zindex=A.zindex-200,Pe.initialize="render",x.modal={"^show.modal.(on|blur)$":function(){this.destroy(),this.init(),this.qtip.elems.overlay.toggle(this.qtip.tooltip[0].offsetWidth>0)}},r.extend(T,A.defaults,{show:{modal:{on:I,effect:T,blur:T,stealfocus:T,escape:T}}}),H.viewport=function(o,r,i,n,s,a,l){function p(t,e,o,i,n,s,a,l,p){var u=r[n],y=w[t],v=b[t],P=o===G,C=y===n?p:y===s?-p:-p/2,A=v===n?l:v===s?-l:-l/2,S=f[n]+m[n]-(d?0:c[n]),k=S-u,x=u+p-(a===F?g:_)-S,E=C-(w.precedance===t||y===w[e]?A:0)-(v===B?l/2:0);return P?(E=(y===n?1:-1)*C,r[n]+=k>0?k:x>0?-x:0,r[n]=Math.max(-c[n]+m[n],u-E,Math.min(Math.max(-c[n]+m[n]+(a===F?g:_),u+E),r[n],"center"===y?u-C:1e9))):(i*=o===z?2:0,k>0&&(y!==n||x>0)?(r[n]-=E+i,h.invert(t,n)):x>0&&(y!==s||k>0)&&(r[n]-=(y===B?-E:E)+i,h.invert(t,s)),r[n]<f&&-r[n]>x&&(r[n]=u,h=w.clone())),r[n]-u}var u,h,c,d,g,_,f,m,y=i.target,v=o.elements.tooltip,w=i.my,b=i.at,P=i.adjust,C=P.method.split(" "),A=C[0],S=C[1]||C[0],k=i.viewport,x=i.container,E=(o.cache,{left:0,top:0});return k.jquery&&y[0]!==t&&y[0]!==e.body&&"none"!==P.method?(c=x.offset()||E,d="static"===x.css("position"),u="fixed"===v.css("position"),g=k[0]===t?k.width():k.outerWidth(I),_=k[0]===t?k.height():k.outerHeight(I),f={left:u?0:k.scrollLeft(),top:u?0:k.scrollTop()},m=k.offset()||E,("shift"!==A||"shift"!==S)&&(h=w.clone()),E={left:"none"!==A?p(L,U,A,P.x,R,$,F,n,a):0,top:"none"!==S?p(U,L,S,P.y,N,O,D,s,l):0,my:h}):E},H.polys={polygon:function(t,e){var o,r,i,n={width:0,height:0,position:{top:1e10,right:0,bottom:0,left:1e10},adjustable:I},s=0,a=[],l=1,p=1,u=0,h=0;for(s=t.length;s--;)o=[parseInt(t[--s],10),parseInt(t[s+1],10)],o[0]>n.position.right&&(n.position.right=o[0]),o[0]<n.position.left&&(n.position.left=o[0]),o[1]>n.position.bottom&&(n.position.bottom=o[1]),o[1]<n.position.top&&(n.position.top=o[1]),a.push(o);if(r=n.width=Math.abs(n.position.right-n.position.left),i=n.height=Math.abs(n.position.bottom-n.position.top),"c"===e.abbrev())n.position={left:n.position.left+n.width/2,top:n.position.top+n.height/2};else{for(;r>0&&i>0&&l>0&&p>0;)for(r=Math.floor(r/2),i=Math.floor(i/2),e.x===R?l=r:e.x===$?l=n.width-r:l+=Math.floor(r/2),e.y===N?p=i:e.y===O?p=n.height-i:p+=Math.floor(i/2),s=a.length;s--&&!(a.length<2);)u=a[s][0]-n.position.left,h=a[s][1]-n.position.top,(e.x===R&&u>=l||e.x===$&&l>=u||e.x===B&&(l>u||u>n.width-l)||e.y===N&&h>=p||e.y===O&&p>=h||e.y===B&&(p>h||h>n.height-p))&&a.splice(s,1);n.position={left:a[0][0],top:a[0][1]}}return n},rect:function(t,e,o,r){return{width:Math.abs(o-t),height:Math.abs(r-e),position:{left:Math.min(t,o),top:Math.min(e,r)}}},_angles:{tc:1.5,tr:7/4,tl:5/4,bc:.5,br:.25,bl:.75,rc:2,lc:1,c:0},ellipse:function(t,e,o,r,i){var n=H.polys._angles[i.abbrev()],s=0===n?0:o*Math.cos(n*Math.PI),a=r*Math.sin(n*Math.PI);return{width:2*o-Math.abs(s),height:2*r-Math.abs(a),position:{left:t+s,top:e+a},adjustable:I}},circle:function(t,e,o,r){return H.polys.ellipse(t,e,o,o,r)}},H.svg=function(t,o,i){for(var n,s,a,l,p,u,h,c,d,g=(r(e),o[0]),_=r(g.ownerSVGElement),f=g.ownerDocument,m=(parseInt(o.css("stroke-width"),10)||0)/2;!g.getBBox;)g=g.parentNode;if(!g.getBBox||!g.parentNode)return I;switch(g.nodeName){case"ellipse":case"circle":c=H.polys.ellipse(g.cx.baseVal.value,g.cy.baseVal.value,(g.rx||g.r).baseVal.value+m,(g.ry||g.r).baseVal.value+m,i);break;case"line":case"polygon":case"polyline":for(h=g.points||[{x:g.x1.baseVal.value,y:g.y1.baseVal.value},{x:g.x2.baseVal.value,y:g.y2.baseVal.value}],c=[],u=-1,l=h.numberOfItems||h.length;++u<l;)p=h.getItem?h.getItem(u):h[u],c.push.apply(c,[p.x,p.y]);c=H.polys.polygon(c,i);break;default:c=g.getBBox(),c={width:c.width,height:c.height,position:{left:c.x,top:c.y}}}return d=c.position,_=_[0],_.createSVGPoint&&(s=g.getScreenCTM(),h=_.createSVGPoint(),h.x=d.left,h.y=d.top,a=h.matrixTransform(s),d.left=a.x,d.top=a.y),f!==e&&"mouse"!==t.position.target&&(n=r((f.defaultView||f.parentWindow).frameElement).offset(),n&&(d.left+=n.left,d.top+=n.top)),f=r(f),d.left+=f.scrollLeft(),d.top+=f.scrollTop(),c},H.imagemap=function(t,e,o){e.jquery||(e=r(e));var i,n,s,a,l,p=(e.attr("shape")||"rect").toLowerCase().replace("poly","polygon"),u=r('img[usemap="#'+e.parent("map").attr("name")+'"]'),h=r.trim(e.attr("coords")),c=h.replace(/,$/,"").split(",");if(!u.length)return I;if("polygon"===p)a=H.polys.polygon(c,o);else{if(!H.polys[p])return I;for(s=-1,l=c.length,n=[];++s<l;)n.push(parseInt(c[s],10));a=H.polys[p].apply(this,n.concat(o))}return i=u.offset(),i.left+=Math.ceil((u.outerWidth(I)-u.width())/2),i.top+=Math.ceil((u.outerHeight(I)-u.height())/2),a.position.left+=i.left,a.position.top+=i.top,a};var ke,xe='<iframe class="qtip-bgiframe" frameborder="0" tabindex="-1" src="javascript:\'\';"  style="display:block; position:absolute; z-index:-1; filter:alpha(opacity=0); -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";"></iframe>';r.extend(C.prototype,{_scroll:function(){var e=this.qtip.elements.overlay;e&&(e[0].style.top=r(t).scrollTop()+"px")},init:function(o){var i=o.tooltip;r("select, object").length<1&&(this.bgiframe=o.elements.bgiframe=r(xe).appendTo(i),o._bind(i,"tooltipmove",this.adjustBGIFrame,this._ns,this)),this.redrawContainer=r("<div/>",{id:V+"-rcontainer"}).appendTo(e.body),o.elements.overlay&&o.elements.overlay.addClass("qtipmodal-ie6fix")&&(o._bind(t,["scroll","resize"],this._scroll,this._ns,this),o._bind(i,["tooltipshow"],this._scroll,this._ns,this)),this.redraw()},adjustBGIFrame:function(){var t,e,o=this.qtip.tooltip,r={height:o.outerHeight(I),width:o.outerWidth(I)},i=this.qtip.plugins.tip,n=this.qtip.elements.tip;e=parseInt(o.css("borderLeftWidth"),10)||0,e={left:-e,top:-e},i&&n&&(t="x"===i.corner.precedance?[F,R]:[D,N],e[t[1]]-=n[t[0]]()),this.bgiframe.css(e).css(r)},redraw:function(){if(this.qtip.rendered<1||this.drawing)return this;var t,e,o,r,i=this.qtip.tooltip,n=this.qtip.options.style,s=this.qtip.options.position.container;return this.qtip.drawing=1,n.height&&i.css(D,n.height),n.width?i.css(F,n.width):(i.css(F,"").appendTo(this.redrawContainer),e=i.width(),1>e%2&&(e+=1),o=i.css("maxWidth")||"",r=i.css("minWidth")||"",t=(o+r).indexOf("%")>-1?s.width()/100:0,o=(o.indexOf("%")>-1?t:1)*parseInt(o,10)||e,r=(r.indexOf("%")>-1?t:1)*parseInt(r,10)||0,e=o+r?Math.min(Math.max(e,r),o):e,i.css(F,Math.round(e)).appendTo(s)),this.drawing=0,this},destroy:function(){this.bgiframe&&this.bgiframe.remove(),this.qtip._unbind([t,this.qtip.tooltip],this._ns)}}),ke=H.ie6=function(t){return 6===re.ie?new C(t):I},ke.initialize="render",x.ie6={"^content|style$":function(){this.redraw()}}})}(window,document),function(){var t,e,o,r,i=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,s=function(t,e){function o(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};o=App.module("Behaviors"),t=$(window),e=[],o.FileDropArea=function(o){function n(){return this.droppedFile=i(this.droppedFile,this),this.dragLeave=i(this.dragLeave,this),this.dragOver=i(this.dragOver,this),r=n.__super__.constructor.apply(this,arguments)}return s(n,o),n.prototype.initialize=function(t){return this.onDrop=t.onDrop,this.$dropOverlay=$('<div class="dropzone_overlay"></div>'),this.dropTimeout=null},n.prototype.disable=function(){return this.enabled=!1},n.prototype.enable=function(){return this.enabled=!0},n.prototype.onShow=function(){var o;return $("body").append(this.$dropOverlay),window.FileReader&&App.Helpers.BrowserSupport.draganddrop()&&(t.on("dragover",this.dragOver),t.on("drop",this.droppedFile),this.$dropOverlay.on("dragleave",this.dragLeave)),null!=(o=_.last(e))&&o.disable(),e.push(this),this.enable()},n.prototype.onDestroy=function(){var o,r;if(t.off("dragover",this.dragover),t.off("drop",this.droppedFile),this.$dropOverlay.off("dragleave",this.dragleave),o=e.pop(),o!==this)throw new Error("Order of drop-areas has become corrupted");return null!=(r=_.last(e))?r.enable():void 0},n.prototype.dragOver=function(t){return this.enabled?(clearTimeout(this.dropTimeout),t.stopPropagation(),t.preventDefault(),$(this.$dropOverlay).show()):void 0},n.prototype.dragLeave=function(t){var e=this;if(this.enabled)return this.dropTimeout=_.delay(function(){return t.stopPropagation(),$(e.$dropOverlay).hide()},300)},n.prototype.droppedFile=function(t){var e;if(this.enabled){if(t.preventDefault(),this.$dropOverlay.hide(),e=t.originalEvent.dataTransfer.files,_.isFunction(this.onDrop))return this.onDrop.call(this.view,e);if(_.isString(this.onDrop)&&_.isFunction(this.view[this.onDrop]))return this.view[this.onDrop](e);throw new Error("Unable to use this onDrop handler:",this.onDrop)}},n}(Marionette.Behavior)}.call(this),function(){var t;t=App.module("Helpers"),t.BrowserSupport=function(){function t(){}return t.draganddrop=function(){var t;return t=document.createElement("div"),"draggable"in t||"ondragstart"in t&&"ondrop"in t},t}()}.call(this),/*! jQuery UI - v1.11.2 - 2014-10-25
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, draggable.js, droppable.js, selectable.js, sortable.js
* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */
function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){function e(e,r){var i,n,s,a=e.nodeName.toLowerCase();return"area"===a?(i=e.parentNode,n=i.name,e.href&&n&&"map"===i.nodeName.toLowerCase()?(s=t("img[usemap='#"+n+"']")[0],!!s&&o(s)):!1):(/input|select|textarea|button|object/.test(a)?!e.disabled:"a"===a?e.href||r:r)&&o(e)}function o(e){return t.expr.filters.visible(e)&&!t(e).parents().addBack().filter(function(){return"hidden"===t.css(this,"visibility")}).length}/*!
 * jQuery UI Core 1.11.2
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/category/ui-core/
 */
t.ui=t.ui||{},t.extend(t.ui,{version:"1.11.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),t.fn.extend({scrollParent:function(e){var o=this.css("position"),r="absolute"===o,i=e?/(auto|scroll|hidden)/:/(auto|scroll)/,n=this.parents().filter(function(){var e=t(this);return r&&"static"===e.css("position")?!1:i.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==o&&n.length?n:t(this[0].ownerDocument||document)},uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(o){return!!t.data(o,e)}}):function(e,o,r){return!!t.data(e,r[3])},focusable:function(o){return e(o,!isNaN(t.attr(o,"tabindex")))},tabbable:function(o){var r=t.attr(o,"tabindex"),i=isNaN(r);return(i||r>=0)&&e(o,!i)}}),t("<a>").outerWidth(1).jquery||t.each(["Width","Height"],function(e,o){function r(e,o,r,n){return t.each(i,function(){o-=parseFloat(t.css(e,"padding"+this))||0,r&&(o-=parseFloat(t.css(e,"border"+this+"Width"))||0),n&&(o-=parseFloat(t.css(e,"margin"+this))||0)}),o}var i="Width"===o?["Left","Right"]:["Top","Bottom"],n=o.toLowerCase(),s={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+o]=function(e){return void 0===e?s["inner"+o].call(this):this.each(function(){t(this).css(n,r(this,e)+"px")})},t.fn["outer"+o]=function(e,i){return"number"!=typeof e?s["outer"+o].call(this,e):this.each(function(){t(this).css(n,r(this,e,!0,i)+"px")})}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(t.fn.removeData=function(e){return function(o){return arguments.length?e.call(this,t.camelCase(o)):e.call(this)}}(t.fn.removeData)),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),t.fn.extend({focus:function(e){return function(o,r){return"number"==typeof o?this.each(function(){var e=this;setTimeout(function(){t(e).focus(),r&&r.call(e)},o)}):e.apply(this,arguments)}}(t.fn.focus),disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(e){if(void 0!==e)return this.css("zIndex",e);if(this.length)for(var o,r,i=t(this[0]);i.length&&i[0]!==document;){if(o=i.css("position"),("absolute"===o||"relative"===o||"fixed"===o)&&(r=parseInt(i.css("zIndex"),10),!isNaN(r)&&0!==r))return r;i=i.parent()}return 0}}),t.ui.plugin={add:function(e,o,r){var i,n=t.ui[e].prototype;for(i in r)n.plugins[i]=n.plugins[i]||[],n.plugins[i].push([o,r[i]])},call:function(t,e,o,r){var i,n=t.plugins[e];if(n&&(r||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(i=0;i<n.length;i++)t.options[n[i][0]]&&n[i][1].apply(t.element,o)}};/*!
 * jQuery UI Widget 1.11.2
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/jQuery.widget/
 */
var r=0,i=Array.prototype.slice;t.cleanData=function(e){return function(o){var r,i,n;for(n=0;null!=(i=o[n]);n++)try{r=t._data(i,"events"),r&&r.remove&&t(i).triggerHandler("remove")}catch(s){}e(o)}}(t.cleanData),t.widget=function(e,o,r){var i,n,s,a,l={},p=e.split(".")[0];return e=e.split(".")[1],i=p+"-"+e,r||(r=o,o=t.Widget),t.expr[":"][i.toLowerCase()]=function(e){return!!t.data(e,i)},t[p]=t[p]||{},n=t[p][e],s=t[p][e]=function(t,e){return this._createWidget?(arguments.length&&this._createWidget(t,e),void 0):new s(t,e)},t.extend(s,n,{version:r.version,_proto:t.extend({},r),_childConstructors:[]}),a=new o,a.options=t.widget.extend({},a.options),t.each(r,function(e,r){return t.isFunction(r)?(l[e]=function(){var t=function(){return o.prototype[e].apply(this,arguments)},i=function(t){return o.prototype[e].apply(this,t)};return function(){var e,o=this._super,n=this._superApply;return this._super=t,this._superApply=i,e=r.apply(this,arguments),this._super=o,this._superApply=n,e}}(),void 0):(l[e]=r,void 0)}),s.prototype=t.widget.extend(a,{widgetEventPrefix:n?a.widgetEventPrefix||e:e},l,{constructor:s,namespace:p,widgetName:e,widgetFullName:i}),n?(t.each(n._childConstructors,function(e,o){var r=o.prototype;t.widget(r.namespace+"."+r.widgetName,s,o._proto)}),delete n._childConstructors):o._childConstructors.push(s),t.widget.bridge(e,s),s},t.widget.extend=function(e){for(var o,r,n=i.call(arguments,1),s=0,a=n.length;a>s;s++)for(o in n[s])r=n[s][o],n[s].hasOwnProperty(o)&&void 0!==r&&(e[o]=t.isPlainObject(r)?t.isPlainObject(e[o])?t.widget.extend({},e[o],r):t.widget.extend({},r):r);return e},t.widget.bridge=function(e,o){var r=o.prototype.widgetFullName||e;t.fn[e]=function(n){var s="string"==typeof n,a=i.call(arguments,1),l=this;return n=!s&&a.length?t.widget.extend.apply(null,[n].concat(a)):n,s?this.each(function(){var o,i=t.data(this,r);return"instance"===n?(l=i,!1):i?t.isFunction(i[n])&&"_"!==n.charAt(0)?(o=i[n].apply(i,a),o!==i&&void 0!==o?(l=o&&o.jquery?l.pushStack(o.get()):o,!1):void 0):t.error("no such method '"+n+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+n+"'")}):this.each(function(){var e=t.data(this,r);e?(e.option(n||{}),e._init&&e._init()):t.data(this,r,new o(n,this))}),l}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,o){o=t(o||this.defaultElement||this)[0],this.element=t(o),this.uuid=r++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),o!==this&&(t.data(o,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===o&&this.destroy()}}),this.document=t(o.style?o.ownerDocument:o.document||o),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(e,o){var r,i,n,s=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(s={},r=e.split("."),e=r.shift(),r.length){for(i=s[e]=t.widget.extend({},this.options[e]),n=0;n<r.length-1;n++)i[r[n]]=i[r[n]]||{},i=i[r[n]];if(e=r.pop(),1===arguments.length)return void 0===i[e]?null:i[e];i[e]=o}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];s[e]=o}return this._setOptions(s),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!e),e&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(e,o,r){var i,n=this;"boolean"!=typeof e&&(r=o,o=e,e=!1),r?(o=i=t(o),this.bindings=this.bindings.add(o)):(r=o,o=this.element,i=this.widget()),t.each(r,function(r,s){function a(){return e||n.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof s?n[s]:s).apply(n,arguments):void 0}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||t.guid++);var l=r.match(/^([\w:-]*)\s*(.*)$/),p=l[1]+n.eventNamespace,u=l[2];u?i.delegate(u,p,a):o.bind(p,a)})},_off:function(e,o){o=(o||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(o).undelegate(o),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function o(){return("string"==typeof t?r[t]:t).apply(r,arguments)}var r=this;return setTimeout(o,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,o,r){var i,n,s=this.options[e];if(r=r||{},o=t.Event(o),o.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),o.target=this.element[0],n=o.originalEvent)for(i in n)i in o||(o[i]=n[i]);return this.element.trigger(o,r),!(t.isFunction(s)&&s.apply(this.element[0],[o].concat(r))===!1||o.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,o){t.Widget.prototype["_"+e]=function(r,i,n){"string"==typeof i&&(i={effect:i});var s,a=i?i===!0||"number"==typeof i?o:i.effect||o:e;i=i||{},"number"==typeof i&&(i={duration:i}),s=!t.isEmptyObject(i),i.complete=n,i.delay&&r.delay(i.delay),s&&t.effects&&t.effects.effect[a]?r[e](i):a!==e&&r[a]?r[a](i.duration,i.easing,n):r.queue(function(o){t(this)[e](),n&&n.call(r[0]),o()})}});var n=(t.widget,!1);t(document).mouseup(function(){n=!1});t.widget("ui.mouse",{version:"1.11.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(o){return!0===t.data(o.target,e.widgetName+".preventClickEvent")?(t.removeData(o.target,e.widgetName+".preventClickEvent"),o.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!n){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var o=this,r=1===e.which,i="string"==typeof this.options.cancel&&e.target.nodeName?t(e.target).closest(this.options.cancel).length:!1;return r&&!i&&this._mouseCapture(e)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){o.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return o._mouseMove(t)},this._mouseUpDelegate=function(t){return o._mouseUp(t)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),n=!0,!0)):!0}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||document.documentMode<9)&&!e.button)return this._mouseUp(e);if(!e.which)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),n=!1,!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}});/*!
 * jQuery UI Draggable 1.11.2
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/draggable/
 */
t.widget("ui.draggable",t.ui.mouse,{version:"1.11.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(e){var o=this.options;return this._blurActiveElement(e),this.helper||o.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(this._blockFrames(o.iframeFix===!0?"iframe":o.iframeFix),!0):!1)},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var o=this.document[0];if(this.handleElement.is(e.target))try{o.activeElement&&"body"!==o.activeElement.nodeName.toLowerCase()&&t(o.activeElement).blur()}catch(r){}},_mouseStart:function(e){var o=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!o.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._normalizeRightBottom(),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function(e,o){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!o){var r=this._uiHash();if(this._trigger("drag",e,r)===!1)return this._mouseUp({}),!1;this.position=r.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var o=this,r=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(r=t.ui.ddmanager.drop(this,e)),this.dropped&&(r=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!r||"valid"===this.options.revert&&r||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,r)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){o._trigger("stop",e)!==!1&&o._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.focus(),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(e){var o=this.options,r=t.isFunction(o.helper),i=r?t(o.helper.apply(this.element[0],[e])):"clone"===o.helper?this.element.clone().removeAttr("id"):this.element;return i.parents("body").length||i.appendTo("parent"===o.appendTo?this.element[0].parentNode:o.appendTo),r&&i[0]===this.element[0]&&this._setPositionRelative(),i[0]===this.element[0]||/(fixed|absolute)/.test(i.css("position"))||i.css("position","absolute"),i},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),o=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==o&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,o,r,i=this.options,n=this.document[0];return this.relativeContainer=null,i.containment?"window"===i.containment?(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||n.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===i.containment?(this.containment=[0,0,t(n).width()-this.helperProportions.width-this.margins.left,(t(n).height()||n.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):i.containment.constructor===Array?(this.containment=i.containment,void 0):("parent"===i.containment&&(i.containment=this.helper[0].parentNode),o=t(i.containment),r=o[0],r&&(e=/(scroll|auto)/.test(o.css("overflow")),this.containment=[(parseInt(o.css("borderLeftWidth"),10)||0)+(parseInt(o.css("paddingLeft"),10)||0),(parseInt(o.css("borderTopWidth"),10)||0)+(parseInt(o.css("paddingTop"),10)||0),(e?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(o.css("borderRightWidth"),10)||0)-(parseInt(o.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(o.css("borderBottomWidth"),10)||0)-(parseInt(o.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=o),void 0):(this.containment=null,void 0)},_convertPositionTo:function(t,e){e||(e=this.position);var o="absolute"===t?1:-1,r=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*o+this.offset.parent.top*o-("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top)*o,left:e.left+this.offset.relative.left*o+this.offset.parent.left*o-("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)*o}},_generatePosition:function(t,e){var o,r,i,n,s=this.options,a=this._isRootNode(this.scrollParent[0]),l=t.pageX,p=t.pageY;return a&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(r=this.relativeContainer.offset(),o=[this.containment[0]+r.left,this.containment[1]+r.top,this.containment[2]+r.left,this.containment[3]+r.top]):o=this.containment,t.pageX-this.offset.click.left<o[0]&&(l=o[0]+this.offset.click.left),t.pageY-this.offset.click.top<o[1]&&(p=o[1]+this.offset.click.top),t.pageX-this.offset.click.left>o[2]&&(l=o[2]+this.offset.click.left),t.pageY-this.offset.click.top>o[3]&&(p=o[3]+this.offset.click.top)),s.grid&&(i=s.grid[1]?this.originalPageY+Math.round((p-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY,p=o?i-this.offset.click.top>=o[1]||i-this.offset.click.top>o[3]?i:i-this.offset.click.top>=o[1]?i-s.grid[1]:i+s.grid[1]:i,n=s.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX,l=o?n-this.offset.click.left>=o[0]||n-this.offset.click.left>o[2]?n:n-this.offset.click.left>=o[0]?n-s.grid[0]:n+s.grid[0]:n),"y"===s.axis&&(l=this.originalPageX),"x"===s.axis&&(p=this.originalPageY)),{top:p-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:a?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:a?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(e,o,r){return r=r||this._uiHash(),t.ui.plugin.call(this,e,[o,r,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),r.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,o,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,o,r){var i=t.extend({},o,{item:r.element});r.sortables=[],t(r.options.connectToSortable).each(function(){var o=t(this).sortable("instance");o&&!o.options.disabled&&(r.sortables.push(o),o.refreshPositions(),o._trigger("activate",e,i))})},stop:function(e,o,r){var i=t.extend({},o,{item:r.element});r.cancelHelperRemoval=!1,t.each(r.sortables,function(){var t=this;t.isOver?(t.isOver=0,r.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,i))})},drag:function(e,o,r){t.each(r.sortables,function(){var i=!1,n=this;n.positionAbs=r.positionAbs,n.helperProportions=r.helperProportions,n.offset.click=r.offset.click,n._intersectsWith(n.containerCache)&&(i=!0,t.each(r.sortables,function(){return this.positionAbs=r.positionAbs,this.helperProportions=r.helperProportions,this.offset.click=r.offset.click,this!==n&&this._intersectsWith(this.containerCache)&&t.contains(n.element[0],this.element[0])&&(i=!1),i})),i?(n.isOver||(n.isOver=1,n.currentItem=o.helper.appendTo(n.element).data("ui-sortable-item",!0),n.options._helper=n.options.helper,n.options.helper=function(){return o.helper[0]},e.target=n.currentItem[0],n._mouseCapture(e,!0),n._mouseStart(e,!0,!0),n.offset.click.top=r.offset.click.top,n.offset.click.left=r.offset.click.left,n.offset.parent.left-=r.offset.parent.left-n.offset.parent.left,n.offset.parent.top-=r.offset.parent.top-n.offset.parent.top,r._trigger("toSortable",e),r.dropped=n.element,t.each(r.sortables,function(){this.refreshPositions()}),r.currentItem=r.element,n.fromOutside=r),n.currentItem&&(n._mouseDrag(e),o.position=n.position)):n.isOver&&(n.isOver=0,n.cancelHelperRemoval=!0,n.options._revert=n.options.revert,n.options.revert=!1,n._trigger("out",e,n._uiHash(n)),n._mouseStop(e,!0),n.options.revert=n.options._revert,n.options.helper=n.options._helper,n.placeholder&&n.placeholder.remove(),r._refreshOffsets(e),o.position=r._generatePosition(e,!0),r._trigger("fromSortable",e),r.dropped=!1,t.each(r.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function(e,o,r){var i=t("body"),n=r.options;i.css("cursor")&&(n._cursor=i.css("cursor")),i.css("cursor",n.cursor)},stop:function(e,o,r){var i=r.options;i._cursor&&t("body").css("cursor",i._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,o,r){var i=t(o.helper),n=r.options;i.css("opacity")&&(n._opacity=i.css("opacity")),i.css("opacity",n.opacity)},stop:function(e,o,r){var i=r.options;i._opacity&&t(o.helper).css("opacity",i._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,o){o.scrollParentNotHidden||(o.scrollParentNotHidden=o.helper.scrollParent(!1)),o.scrollParentNotHidden[0]!==o.document[0]&&"HTML"!==o.scrollParentNotHidden[0].tagName&&(o.overflowOffset=o.scrollParentNotHidden.offset())},drag:function(e,o,r){var i=r.options,n=!1,s=r.scrollParentNotHidden[0],a=r.document[0];s!==a&&"HTML"!==s.tagName?(i.axis&&"x"===i.axis||(r.overflowOffset.top+s.offsetHeight-e.pageY<i.scrollSensitivity?s.scrollTop=n=s.scrollTop+i.scrollSpeed:e.pageY-r.overflowOffset.top<i.scrollSensitivity&&(s.scrollTop=n=s.scrollTop-i.scrollSpeed)),i.axis&&"y"===i.axis||(r.overflowOffset.left+s.offsetWidth-e.pageX<i.scrollSensitivity?s.scrollLeft=n=s.scrollLeft+i.scrollSpeed:e.pageX-r.overflowOffset.left<i.scrollSensitivity&&(s.scrollLeft=n=s.scrollLeft-i.scrollSpeed))):(i.axis&&"x"===i.axis||(e.pageY-t(a).scrollTop()<i.scrollSensitivity?n=t(a).scrollTop(t(a).scrollTop()-i.scrollSpeed):t(window).height()-(e.pageY-t(a).scrollTop())<i.scrollSensitivity&&(n=t(a).scrollTop(t(a).scrollTop()+i.scrollSpeed))),i.axis&&"y"===i.axis||(e.pageX-t(a).scrollLeft()<i.scrollSensitivity?n=t(a).scrollLeft(t(a).scrollLeft()-i.scrollSpeed):t(window).width()-(e.pageX-t(a).scrollLeft())<i.scrollSensitivity&&(n=t(a).scrollLeft(t(a).scrollLeft()+i.scrollSpeed)))),n!==!1&&t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(r,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,o,r){var i=r.options;r.snapElements=[],t(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each(function(){var e=t(this),o=e.offset();this!==r.element[0]&&r.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:o.top,left:o.left})})},drag:function(e,o,r){var i,n,s,a,l,p,u,h,c,d,g=r.options,_=g.snapTolerance,f=o.offset.left,m=f+r.helperProportions.width,y=o.offset.top,v=y+r.helperProportions.height;for(c=r.snapElements.length-1;c>=0;c--)l=r.snapElements[c].left-r.margins.left,p=l+r.snapElements[c].width,u=r.snapElements[c].top-r.margins.top,h=u+r.snapElements[c].height,l-_>m||f>p+_||u-_>v||y>h+_||!t.contains(r.snapElements[c].item.ownerDocument,r.snapElements[c].item)?(r.snapElements[c].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,e,t.extend(r._uiHash(),{snapItem:r.snapElements[c].item})),r.snapElements[c].snapping=!1):("inner"!==g.snapMode&&(i=Math.abs(u-v)<=_,n=Math.abs(h-y)<=_,s=Math.abs(l-m)<=_,a=Math.abs(p-f)<=_,i&&(o.position.top=r._convertPositionTo("relative",{top:u-r.helperProportions.height,left:0}).top),n&&(o.position.top=r._convertPositionTo("relative",{top:h,left:0}).top),s&&(o.position.left=r._convertPositionTo("relative",{top:0,left:l-r.helperProportions.width}).left),a&&(o.position.left=r._convertPositionTo("relative",{top:0,left:p}).left)),d=i||n||s||a,"outer"!==g.snapMode&&(i=Math.abs(u-y)<=_,n=Math.abs(h-v)<=_,s=Math.abs(l-f)<=_,a=Math.abs(p-m)<=_,i&&(o.position.top=r._convertPositionTo("relative",{top:u,left:0}).top),n&&(o.position.top=r._convertPositionTo("relative",{top:h-r.helperProportions.height,left:0}).top),s&&(o.position.left=r._convertPositionTo("relative",{top:0,left:l}).left),a&&(o.position.left=r._convertPositionTo("relative",{top:0,left:p-r.helperProportions.width}).left)),!r.snapElements[c].snapping&&(i||n||s||a||d)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,e,t.extend(r._uiHash(),{snapItem:r.snapElements[c].item})),r.snapElements[c].snapping=i||n||s||a||d)}}),t.ui.plugin.add("draggable","stack",{start:function(e,o,r){var i,n=r.options,s=t.makeArray(t(n.stack)).sort(function(e,o){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(o).css("zIndex"),10)||0)});s.length&&(i=parseInt(t(s[0]).css("zIndex"),10)||0,t(s).each(function(e){t(this).css("zIndex",i+e)}),this.css("zIndex",i+s.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,o,r){var i=t(o.helper),n=r.options;i.css("zIndex")&&(n._zIndex=i.css("zIndex")),i.css("zIndex",n.zIndex)},stop:function(e,o,r){var i=r.options;i._zIndex&&t(o.helper).css("zIndex",i._zIndex)}});t.ui.draggable;/*!
 * jQuery UI Droppable 1.11.2
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/droppable/
 */
t.widget("ui.droppable",{version:"1.11.2",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,o=this.options,r=o.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(r)?r:function(t){return t.is(r)},this.proportions=function(){return arguments.length?(e=arguments[0],void 0):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(o.scope),o.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function(t){for(var e=0;e<t.length;e++)t[e]===this&&t.splice(e,1)},_destroy:function(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,o){if("accept"===e)this.accept=t.isFunction(o)?o:function(t){return t.is(o)};else if("scope"===e){var r=t.ui.ddmanager.droppables[this.options.scope];this._splice(r),this._addToManager(o)}this._super(e,o)},_activate:function(e){var o=t.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),o&&this._trigger("activate",e,this.ui(o))},_deactivate:function(e){var o=t.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),o&&this._trigger("deactivate",e,this.ui(o))},_over:function(e){var o=t.ui.ddmanager.current;o&&(o.currentItem||o.element)[0]!==this.element[0]&&this.accept.call(this.element[0],o.currentItem||o.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(o)))},_out:function(e){var o=t.ui.ddmanager.current;o&&(o.currentItem||o.element)[0]!==this.element[0]&&this.accept.call(this.element[0],o.currentItem||o.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(o)))},_drop:function(e,o){var r=o||t.ui.ddmanager.current,i=!1;return r&&(r.currentItem||r.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var o=t(this).droppable("instance");return o.options.greedy&&!o.options.disabled&&o.options.scope===r.options.scope&&o.accept.call(o.element[0],r.currentItem||r.element)&&t.ui.intersect(r,t.extend(o,{offset:o.element.offset()}),o.options.tolerance,e)?(i=!0,!1):void 0}),i?!1:this.accept.call(this.element[0],r.currentItem||r.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(r)),this.element):!1):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}}}),t.ui.intersect=function(){function t(t,e,o){return t>=e&&e+o>t}return function(e,o,r,i){if(!o.offset)return!1;var n=(e.positionAbs||e.position.absolute).left+e.margins.left,s=(e.positionAbs||e.position.absolute).top+e.margins.top,a=n+e.helperProportions.width,l=s+e.helperProportions.height,p=o.offset.left,u=o.offset.top,h=p+o.proportions().width,c=u+o.proportions().height;switch(r){case"fit":return n>=p&&h>=a&&s>=u&&c>=l;case"intersect":return p<n+e.helperProportions.width/2&&a-e.helperProportions.width/2<h&&u<s+e.helperProportions.height/2&&l-e.helperProportions.height/2<c;case"pointer":return t(i.pageY,u,o.proportions().height)&&t(i.pageX,p,o.proportions().width);case"touch":return(s>=u&&c>=s||l>=u&&c>=l||u>s&&l>c)&&(n>=p&&h>=n||a>=p&&h>=a||p>n&&a>h);default:return!1}}}(),t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,o){var r,i,n=t.ui.ddmanager.droppables[e.options.scope]||[],s=o?o.type:null,a=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(r=0;r<n.length;r++)if(!(n[r].options.disabled||e&&!n[r].accept.call(n[r].element[0],e.currentItem||e.element))){for(i=0;i<a.length;i++)if(a[i]===n[r].element[0]){n[r].proportions().height=0;continue t}n[r].visible="none"!==n[r].element.css("display"),n[r].visible&&("mousedown"===s&&n[r]._activate.call(n[r],o),n[r].offset=n[r].element.offset(),n[r].proportions({width:n[r].element[0].offsetWidth,height:n[r].element[0].offsetHeight}))}},drop:function(e,o){var r=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&t.ui.intersect(e,this,this.options.tolerance,o)&&(r=this._drop.call(this,o)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,o)))}),r},dragStart:function(e,o){e.element.parentsUntil("body").bind("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,o)})},drag:function(e,o){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,o),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var r,i,n,s=t.ui.intersect(e,this,this.options.tolerance,o),a=!s&&this.isover?"isout":s&&!this.isover?"isover":null;a&&(this.options.greedy&&(i=this.options.scope,n=this.element.parents(":data(ui-droppable)").filter(function(){return t(this).droppable("instance").options.scope===i}),n.length&&(r=t(n[0]).droppable("instance"),r.greedyChild="isover"===a)),r&&"isover"===a&&(r.isover=!1,r.isout=!0,r._out.call(r,o)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,o),r&&"isout"===a&&(r.isout=!1,r.isover=!0,r._over.call(r,o)))}})},dragStop:function(e,o){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,o)}};t.ui.droppable,t.widget("ui.selectable",t.ui.mouse,{version:"1.11.2",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e,o=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e=t(o.options.filter,o.element[0]),e.addClass("ui-selectee"),e.each(function(){var e=t(this),o=e.offset();t.data(this,"selectable-item",{element:this,$element:e,left:o.left,top:o.top,right:o.left+e.outerWidth(),bottom:o.top+e.outerHeight(),startselected:!1,selected:e.hasClass("ui-selected"),selecting:e.hasClass("ui-selecting"),unselecting:e.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=e.addClass("ui-selectee"),this._mouseInit(),this.helper=t("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(e){var o=this,r=this.options;this.opos=[e.pageX,e.pageY],this.options.disabled||(this.selectees=t(r.filter,this.element[0]),this._trigger("start",e),t(r.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),r.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var r=t.data(this,"selectable-item");r.startselected=!0,e.metaKey||e.ctrlKey||(r.$element.removeClass("ui-selected"),r.selected=!1,r.$element.addClass("ui-unselecting"),r.unselecting=!0,o._trigger("unselecting",e,{unselecting:r.element}))}),t(e.target).parents().addBack().each(function(){var r,i=t.data(this,"selectable-item");return i?(r=!e.metaKey&&!e.ctrlKey||!i.$element.hasClass("ui-selected"),i.$element.removeClass(r?"ui-unselecting":"ui-selected").addClass(r?"ui-selecting":"ui-unselecting"),i.unselecting=!r,i.selecting=r,i.selected=r,r?o._trigger("selecting",e,{selecting:i.element}):o._trigger("unselecting",e,{unselecting:i.element}),!1):void 0}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var o,r=this,i=this.options,n=this.opos[0],s=this.opos[1],a=e.pageX,l=e.pageY;return n>a&&(o=a,a=n,n=o),s>l&&(o=l,l=s,s=o),this.helper.css({left:n,top:s,width:a-n,height:l-s}),this.selectees.each(function(){var o=t.data(this,"selectable-item"),p=!1;o&&o.element!==r.element[0]&&("touch"===i.tolerance?p=!(o.left>a||o.right<n||o.top>l||o.bottom<s):"fit"===i.tolerance&&(p=o.left>n&&o.right<a&&o.top>s&&o.bottom<l),p?(o.selected&&(o.$element.removeClass("ui-selected"),o.selected=!1),o.unselecting&&(o.$element.removeClass("ui-unselecting"),o.unselecting=!1),o.selecting||(o.$element.addClass("ui-selecting"),o.selecting=!0,r._trigger("selecting",e,{selecting:o.element}))):(o.selecting&&((e.metaKey||e.ctrlKey)&&o.startselected?(o.$element.removeClass("ui-selecting"),o.selecting=!1,o.$element.addClass("ui-selected"),o.selected=!0):(o.$element.removeClass("ui-selecting"),o.selecting=!1,o.startselected&&(o.$element.addClass("ui-unselecting"),o.unselecting=!0),r._trigger("unselecting",e,{unselecting:o.element}))),o.selected&&(e.metaKey||e.ctrlKey||o.startselected||(o.$element.removeClass("ui-selected"),o.selected=!1,o.$element.addClass("ui-unselecting"),o.unselecting=!0,r._trigger("unselecting",e,{unselecting:o.element})))))}),!1}},_mouseStop:function(e){var o=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var r=t.data(this,"selectable-item");r.$element.removeClass("ui-unselecting"),r.unselecting=!1,r.startselected=!1,o._trigger("unselected",e,{unselected:r.element})}),t(".ui-selecting",this.element[0]).each(function(){var r=t.data(this,"selectable-item");r.$element.removeClass("ui-selecting").addClass("ui-selected"),r.selecting=!1,r.selected=!0,r.startselected=!0,o._trigger("selected",e,{selected:r.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.11.2",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,o){return t>=e&&e+o>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){var t=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===t.axis||this._isFloating(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),t.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,o){var r=null,i=!1,n=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,n.widgetName+"-item")===n?(r=t(this),!1):void 0}),t.data(e.target,n.widgetName+"-item")===n&&(r=t(e.target)),r?!this.options.handle||o||(t(this.options.handle,r).find("*").addBack().each(function(){this===e.target&&(i=!0)}),i)?(this.currentItem=r,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(e,o,r){var i,n,s=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&"auto"!==s.cursor&&(n=this.document.find("body"),this.storedCursor=n.css("cursor"),n.css("cursor",s.cursor),this.storedStylesheet=t("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(n)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var o,r,i,n,s=this.options,a=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<s.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+s.scrollSpeed:e.pageY-this.overflowOffset.top<s.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-s.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<s.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+s.scrollSpeed:e.pageX-this.overflowOffset.left<s.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-s.scrollSpeed)):(e.pageY-t(document).scrollTop()<s.scrollSensitivity?a=t(document).scrollTop(t(document).scrollTop()-s.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<s.scrollSensitivity&&(a=t(document).scrollTop(t(document).scrollTop()+s.scrollSpeed)),e.pageX-t(document).scrollLeft()<s.scrollSensitivity?a=t(document).scrollLeft(t(document).scrollLeft()-s.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<s.scrollSensitivity&&(a=t(document).scrollLeft(t(document).scrollLeft()+s.scrollSpeed))),a!==!1&&t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),o=this.items.length-1;o>=0;o--)if(r=this.items[o],i=r.item[0],n=this._intersectsWithPointer(r),n&&r.instance===this.currentContainer&&i!==this.currentItem[0]&&this.placeholder[1===n?"next":"prev"]()[0]!==i&&!t.contains(this.placeholder[0],i)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],i):!0)){if(this.direction=1===n?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(e,r),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,o){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var r=this,i=this.placeholder.offset(),n=this.options.axis,s={};n&&"x"!==n||(s.left=i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),n&&"y"!==n||(s.top=i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(s,parseInt(this.options.revert,10)||500,function(){r._clear(e)})}else this._clear(e,o);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var o=this._getItemsAsjQuery(e&&e.connected),r=[];return e=e||{},t(o).each(function(){var o=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);o&&r.push((e.key||o[1]+"[]")+"="+(e.key&&e.expression?o[1]:o[2]))}),!r.length&&e.key&&r.push(e.key+"="),r.join("&")},toArray:function(e){var o=this._getItemsAsjQuery(e&&e.connected),r=[];return e=e||{},o.each(function(){r.push(t(e.item||this).attr(e.attribute||"id")||"")}),r},_intersectsWith:function(t){var e=this.positionAbs.left,o=e+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,n=t.left,s=n+t.width,a=t.top,l=a+t.height,p=this.offset.click.top,u=this.offset.click.left,h="x"===this.options.axis||r+p>a&&l>r+p,c="y"===this.options.axis||e+u>n&&s>e+u,d=h&&c;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?d:n<e+this.helperProportions.width/2&&o-this.helperProportions.width/2<s&&a<r+this.helperProportions.height/2&&i-this.helperProportions.height/2<l},_intersectsWithPointer:function(t){var e="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),o="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),r=e&&o,i=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return r?this.floating?n&&"right"===n||"down"===i?2:1:i&&("down"===i?2:1):!1},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),o=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),r=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection();return this.floating&&i?"right"===i&&o||"left"===i&&!o:r&&("down"===r&&e||"up"===r&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function o(){a.push(this)}var r,i,n,s,a=[],l=[],p=this._connectWith();if(p&&e)for(r=p.length-1;r>=0;r--)for(n=t(p[r]),i=n.length-1;i>=0;i--)s=t.data(n[i],this.widgetFullName),s&&s!==this&&!s.options.disabled&&l.push([t.isFunction(s.options.items)?s.options.items.call(s.element):t(s.options.items,s.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),s]);for(l.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),r=l.length-1;r>=0;r--)l[r][0].each(o);return t(a)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var o=0;o<e.length;o++)if(e[o]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var o,r,i,n,s,a,l,p,u=this.items,h=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],c=this._connectWith();if(c&&this.ready)for(o=c.length-1;o>=0;o--)for(i=t(c[o]),r=i.length-1;r>=0;r--)n=t.data(i[r],this.widgetFullName),n&&n!==this&&!n.options.disabled&&(h.push([t.isFunction(n.options.items)?n.options.items.call(n.element[0],e,{item:this.currentItem}):t(n.options.items,n.element),n]),this.containers.push(n));for(o=h.length-1;o>=0;o--)for(s=h[o][1],a=h[o][0],r=0,p=a.length;p>r;r++)l=t(a[r]),l.data(this.widgetName+"-item",s),u.push({item:l,instance:s,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var o,r,i,n;for(o=this.items.length-1;o>=0;o--)r=this.items[o],r.instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0]||(i=this.options.toleranceElement?t(this.options.toleranceElement,r.item):r.item,e||(r.width=i.outerWidth(),r.height=i.outerHeight()),n=i.offset(),r.left=n.left,r.top=n.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(o=this.containers.length-1;o>=0;o--)n=this.containers[o].element.offset(),this.containers[o].containerCache.left=n.left,this.containers[o].containerCache.top=n.top,this.containers[o].containerCache.width=this.containers[o].element.outerWidth(),this.containers[o].containerCache.height=this.containers[o].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var o,r=e.options;r.placeholder&&r.placeholder.constructor!==String||(o=r.placeholder,r.placeholder={element:function(){var r=e.currentItem[0].nodeName.toLowerCase(),i=t("<"+r+">",e.document[0]).addClass(o||e.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===r?e.currentItem.children().each(function(){t("<td>&#160;</td>",e.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)}):"img"===r&&i.attr("src",e.currentItem.attr("src")),o||i.css("visibility","hidden"),i},update:function(t,i){(!o||r.forcePlaceholderSize)&&(i.height()||i.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),i.width()||i.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(r.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),r.placeholder.update(e,e.placeholder)},_contactContainers:function(e){var o,r,i,n,s,a,l,p,u,h,c=null,d=null;for(o=this.containers.length-1;o>=0;o--)if(!t.contains(this.currentItem[0],this.containers[o].element[0]))if(this._intersectsWith(this.containers[o].containerCache)){if(c&&t.contains(this.containers[o].element[0],c.element[0]))continue;c=this.containers[o],d=o}else this.containers[o].containerCache.over&&(this.containers[o]._trigger("out",e,this._uiHash(this)),this.containers[o].containerCache.over=0);if(c)if(1===this.containers.length)this.containers[d].containerCache.over||(this.containers[d]._trigger("over",e,this._uiHash(this)),this.containers[d].containerCache.over=1);else{for(i=1e4,n=null,u=c.floating||this._isFloating(this.currentItem),s=u?"left":"top",a=u?"width":"height",h=u?"clientX":"clientY",r=this.items.length-1;r>=0;r--)t.contains(this.containers[d].element[0],this.items[r].item[0])&&this.items[r].item[0]!==this.currentItem[0]&&(l=this.items[r].item.offset()[s],p=!1,e[h]-l>this.items[r][a]/2&&(p=!0),Math.abs(e[h]-l)<i&&(i=Math.abs(e[h]-l),n=this.items[r],this.direction=p?"up":"down"));if(!n&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[d])return this.currentContainer.containerCache.over||(this.containers[d]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;n?this._rearrange(e,n,null,!0):this._rearrange(e,null,this.containers[d].element,!0),this._trigger("change",e,this._uiHash()),this.containers[d]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[d],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[d]._trigger("over",e,this._uiHash(this)),this.containers[d].containerCache.over=1}},_createHelper:function(e){var o=this.options,r=t.isFunction(o.helper)?t(o.helper.apply(this.element[0],[e,this.currentItem])):"clone"===o.helper?this.currentItem.clone():this.currentItem;return r.parents("body").length||t("parent"!==o.appendTo?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!r[0].style.width||o.forceHelperSize)&&r.width(this.currentItem.width()),(!r[0].style.height||o.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,o,r,i=this.options;"parent"===i.containment&&(i.containment=this.helper[0].parentNode),("document"===i.containment||"window"===i.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,t("document"===i.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"===i.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(i.containment)||(e=t(i.containment)[0],o=t(i.containment).offset(),r="hidden"!==t(e).css("overflow"),this.containment=[o.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,o.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,o.left+(r?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,o.top+(r?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,o){o||(o=this.position);var r="absolute"===e?1:-1,i="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(i[0].tagName);return{top:o.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():n?0:i.scrollTop())*r,left:o.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():n?0:i.scrollLeft())*r}},_generatePosition:function(e){var o,r,i=this.options,n=e.pageX,s=e.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(n=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(n=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),i.grid&&(o=this.originalPageY+Math.round((s-this.originalPageY)/i.grid[1])*i.grid[1],s=this.containment?o-this.offset.click.top>=this.containment[1]&&o-this.offset.click.top<=this.containment[3]?o:o-this.offset.click.top>=this.containment[1]?o-i.grid[1]:o+i.grid[1]:o,r=this.originalPageX+Math.round((n-this.originalPageX)/i.grid[0])*i.grid[0],n=this.containment?r-this.offset.click.left>=this.containment[0]&&r-this.offset.click.left<=this.containment[2]?r:r-this.offset.click.left>=this.containment[0]?r-i.grid[0]:r+i.grid[0]:r)),{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:a.scrollTop()),left:n-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:a.scrollLeft())}},_rearrange:function(t,e,o,r){o?o[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var i=this.counter;this._delay(function(){i===this.counter&&this.refreshPositions(!r)})},_clear:function(t,e){function o(t,e,o){return function(r){o._trigger(t,r,e._uiHash(e))}}this.reverting=!1;var r,i=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(r in this._storedCSS)("auto"===this._storedCSS[r]||"static"===this._storedCSS[r])&&(this._storedCSS[r]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&i.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||i.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(i.push(function(t){this._trigger("remove",t,this._uiHash())}),i.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),i.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))
}}.call(this,this.currentContainer)))),r=this.containers.length-1;r>=0;r--)e||i.push(o("deactivate",this,this.containers[r])),this.containers[r].containerCache.over&&(i.push(o("out",this,this.containers[r])),this.containers[r].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(r=0;r<i.length;r++)i[r].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var o=e||this;return{helper:o.helper,placeholder:o.placeholder||t([]),position:o.position,originalPosition:o.originalPosition,offset:o.positionAbs,item:o.currentItem,sender:e?e.element:null}}})}),function(t){"use strict";t.widget("ui.selectableScroll",t.ui.selectable,{options:{scrollElement:null,scrollSnapX:5,scrollSnapY:5,scrollAmount:25,scrollIntervalTime:100},_create:function(){this.element.addClass("ui-selectable"),this.dragged=!1,this.helperClasses=["no-top","no-right","no-bottom","no-left"],this.scrollElement=this.options.scrollElement||this.element,this.refresh(),this._mouseInit(),this.helper=t('<div class="ui-selectable-helper"></div>')},refresh:function(){var e=this.scrollElement.offset(),o=this.scrollElement.prop("scrollLeft"),r=this.scrollElement.prop("scrollTop");this.selectees=t(this.options.filter,this.scrollElement[0]),this.selectees.addClass("ui-selectee"),this.selectees.each(function(){var i=t(this),n=i.offset();t.data(this,"selectable-item",{element:this,$element:i,left:n.left,top:n.top,right:n.left+i.outerWidth(),bottom:n.top+i.outerHeight(),relative:{left:n.left-e.left+o,top:n.top-e.top+r,right:n.left-e.left+o+i.outerWidth(),bottom:n.top-e.top+r+i.outerHeight()},startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},_mouseStart:function(e){var o=this.scrollElement.offset();if(e.pageX>this.scrollElement.prop("clientWidth")+o.left||e.pageY>this.scrollElement.prop("clientHeight")+o.top)return!1;var r=t.ui.selectable.prototype._mouseStart.call(this,e);return this.lastDragEvent=null,this.scrollInfo={elementOffset:this.scrollElement.offset(),scrollWidth:this.scrollElement.prop("scrollWidth"),scrollHeight:this.scrollElement.prop("scrollHeight"),elementWidth:this.scrollElement.prop("clientWidth"),elementHeight:this.scrollElement.prop("clientHeight")},this.scrollInfo.dragStartXPos=e.pageX-this.scrollInfo.elementOffset.left+this.scrollElement.prop("scrollLeft"),this.scrollInfo.dragStartYPos=e.pageY-this.scrollInfo.elementOffset.top+this.scrollElement.prop("scrollTop"),this.scrollIntervalId=null,r},_updateHelper:function(e){var o,r,i,n,s=[];e.x1-e.scrollLeft<0?(s.push("no-left"),o=this.scrollInfo.elementOffset.left):o=this.scrollInfo.elementOffset.left+e.x1-e.scrollLeft,e.y1-e.scrollTop<0?(s.push("no-top"),r=this.scrollInfo.elementOffset.top):r=this.scrollInfo.elementOffset.top+e.y1-e.scrollTop,e.x2-e.scrollLeft>this.scrollInfo.elementWidth?(s.push("no-right"),i=this.scrollInfo.elementOffset.left+this.scrollInfo.elementWidth):i=this.scrollInfo.elementOffset.left+e.x2-e.scrollLeft,e.y2-e.scrollTop>this.scrollInfo.elementHeight?(s.push("no-bottom"),n=this.scrollInfo.elementOffset.top+this.scrollInfo.elementHeight):n=this.scrollInfo.elementOffset.top+e.y2-e.scrollTop;for(var a=0;a<this.helperClasses.length;a++){var l=this.helperClasses[a];-1!==t.inArray(l,s)?this.helper.addClass(l):this.helper.removeClass(l)}this.helper.css({left:o,top:r,width:i-o,height:n-r})},_scrollIfNeeded:function(){var t=this.scrollElement.prop("scrollLeft"),e=this.scrollElement.prop("scrollTop"),o=!1;return this.lastDragEvent.pageX-this.scrollInfo.elementOffset.left<this.options.scrollSnapX&&t>0&&(t=t<this.options.scrollAmount?0:t-this.options.scrollAmount,this.scrollElement.prop("scrollLeft",t),o=!0),this.lastDragEvent.pageY-this.scrollInfo.elementOffset.top<this.options.scrollSnapY&&e>0&&(e=e<this.options.scrollAmount?0:e-this.options.scrollAmount,this.scrollElement.prop("scrollTop",e),o=!0),this.lastDragEvent.pageX-this.scrollInfo.elementOffset.left>this.scrollInfo.elementWidth-this.options.scrollSnapX&&this.scrollInfo.scrollWidth>t+this.scrollInfo.elementWidth&&(t=t+this.options.scrollAmount>this.scrollInfo.scrollWidth-this.scrollInfo.elementWidth?this.scrollInfo.scrollWidth-this.scrollInfo.elementWidth:t+this.options.scrollAmount,this.scrollElement.prop("scrollLeft",t),o=!0),this.lastDragEvent.pageY-this.scrollInfo.elementOffset.top>this.scrollInfo.elementHeight-this.options.scrollSnapY&&this.scrollInfo.scrollHeight>t+this.scrollInfo.elementHeight&&(e=e+this.options.scrollAmount>this.scrollInfo.scrollHeight-this.scrollInfo.elementHeight?this.scrollInfo.scrollHeight-this.scrollInfo.elementHeight:e+this.options.scrollAmount,this.scrollElement.prop("scrollTop",e),o=!0),{scrollLeft:t,scrollTop:e,keepScrolling:o}},_calcRelativePosition:function(t){var e=t.x-this.scrollInfo.elementOffset.left+t.scrollLeft,o=t.y-this.scrollInfo.elementOffset.top+t.scrollTop;return{x:e,y:o}},_calcRelativeArea:function(t){var e=t.xPos<this.scrollInfo.dragStartXPos?t.xPos:this.scrollInfo.dragStartXPos,o=t.yPos<this.scrollInfo.dragStartYPos?t.yPos:this.scrollInfo.dragStartYPos,r=t.xPos>this.scrollInfo.dragStartXPos?t.xPos:this.scrollInfo.dragStartXPos,i=t.yPos>this.scrollInfo.dragStartYPos?t.yPos:this.scrollInfo.dragStartYPos;return{x1:e,y1:o,x2:r,y2:i}},_updateSelectees:function(e){var o=this;this.selectees.each(function(){var r=t.data(this,"selectable-item"),i=!1;r&&r.element!==o.element[0]&&("touch"===o.options.tolerance?i=!(r.relative.left>e.x2||r.relative.right<e.x1||r.relative.top>e.y2||r.relative.bottom<e.y1):"fit"===o.options.tolerance&&(i=r.relative.left>e.x1&&r.relative.right<e.x2&&r.relative.top>e.y1&&r.relative.bottom<e.y2),i?(r.selected&&(r.$element.removeClass("ui-selected"),r.selected=!1),r.unselecting&&(r.$element.removeClass("ui-unselecting"),r.unselecting=!1),r.selecting||(r.$element.addClass("ui-selecting"),r.selecting=!0,o._trigger("selecting",o.lastDragEvent,{selecting:r.element}))):(r.selecting&&((o.lastDragEvent.metaKey||o.lastDragEvent.ctrlKey)&&r.startselected?(r.$element.removeClass("ui-selecting"),r.selecting=!1,r.$element.addClass("ui-selected"),r.selected=!0):(r.$element.removeClass("ui-selecting"),r.selecting=!1,r.startselected&&(r.$element.addClass("ui-unselecting"),r.unselecting=!0),o._trigger("unselecting",o.lastDragEvent,{unselecting:r.element}))),r.selected&&(o.lastDragEvent.metaKey||o.lastDragEvent.ctrlKey||r.startselected||(r.$element.removeClass("ui-selected"),r.selected=!1,r.$element.addClass("ui-unselecting"),r.unselecting=!0,o._trigger("unselecting",o.lastDragEvent,{unselecting:r.element})))))})},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){this.lastDragEvent=t;var e=this._scrollIfNeeded();return this._updateIntervals({keepScrolling:e.keepScrolling}),this._updateUi({doUpdateHelper:!0}),!1}},_updateUi:function(t){var e=this._scrollIfNeeded({pageX:this.lastDragEvent.pageX,pageY:this.lastDragEvent.pageY}),o=this._calcRelativePosition({x:this.lastDragEvent.pageX,y:this.lastDragEvent.pageY,scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}),r=this._calcRelativeArea({xPos:o.x,yPos:o.y});t.doUpdateHelper&&this._updateHelper({scrollLeft:e.scrollLeft,scrollTop:e.scrollTop,x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2}),this._updateSelectees({x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2})},_updateIntervals:function(t){var e=this;t.keepScrolling&&!this.scrollIntervalId&&(this.scrollIntervalId=setInterval(function(){e._updateUi({doUpdateHelper:!1})},this.options.scrollIntervalTime)),!t.keepScrolling&&this.scrollIntervalId&&this._clearIntervals()},_clearIntervals:function(){this.scrollIntervalId&&clearInterval(this.scrollIntervalId),this.scrollIntervalId=null},_mouseStop:function(e){this._clearIntervals();var o=t.ui.selectable.prototype._mouseStop.call(this,e);return o}})}(jQuery),function(){var t,e,o,r,i,n;for(t=App.module("Flash"),n=["info","error","success"],o=function(t){return App.Flash[t]=function(e,o){return null==o&&(o={}),o.type=t,o.message=e,new PxApp.Shared.FlashMessage(o).render()}},r=0,i=n.length;i>r;r++)e=n[r],o(e)}.call(this),function(){var t;t=App.module("Uploader"),t.show=function(t){var e;return e=new App.Uploader.Views.Uploader(t),!App.currentUser.is_free()||App.currentUser.get("upload_limit")>0?e.showModal():window.location.href="/upgrade?limit_reached=true"},$(function(){return $("a.upload[data-new-uploader-enabled]").click(function(t){return t.preventDefault(),App.Uploader.show()})})}.call(this);